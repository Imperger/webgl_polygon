{"version":3,"file":"js/collision.c8f9dda8.js","mappings":"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","sources":["webpack://webgl_polygon/./src/apps/collision/View.vue","webpack://webgl_polygon/./src/lib/misc/Algorithm.ts","webpack://webgl_polygon/./src/lib/math/Real.ts","webpack://webgl_polygon/./src/lib/math/Vector.ts","webpack://webgl_polygon/./src/lib/math/Point.ts","webpack://webgl_polygon/./src/lib/math/Intersection.ts","webpack://webgl_polygon/./src/apps/collision/bodies/Collision.ts","webpack://webgl_polygon/./src/apps/collision/bodies/kinds/circle/CircleCollider.ts","webpack://webgl_polygon/./src/apps/collision/bodies/kinds/circle/VisualCircle.ts","webpack://webgl_polygon/./src/apps/collision/bodies/kinds/circle/CircleBody.ts","webpack://webgl_polygon/./src/apps/collision/bodies/kinds/rectangle/StaticRectangleCollider.ts","webpack://webgl_polygon/./src/apps/collision/bodies/kinds/rectangle/VisualRectangle.ts","webpack://webgl_polygon/./src/apps/collision/bodies/kinds/rectangle/StaticRectangleBody.ts","webpack://webgl_polygon/./src/apps/collision/border/border.frag","webpack://webgl_polygon/./src/apps/collision/border/border.vert","webpack://webgl_polygon/./src/lib/misc/EnumSize.ts","webpack://webgl_polygon/./src/lib/render/PrimitiveBuilder.ts","webpack://webgl_polygon/./src/lib/render/TypeSizeResolver.ts","webpack://webgl_polygon/./src/lib/misc/NotNull.ts","webpack://webgl_polygon/./src/apps/collision/border/BorderRenderer.ts","webpack://webgl_polygon/./src/lib/render/PrimitivesRenderer.ts","webpack://webgl_polygon/./src/apps/collision/collision_engines/BruteForceCollisionEngine.ts","webpack://webgl_polygon/./src/apps/collision/collision_engines/QuadTreeCollisionEngine.ts","webpack://webgl_polygon/./src/apps/collision/collision_engines/CollisionEngineFactory.ts","webpack://webgl_polygon/./src/apps/collision/collision_engines/renderers/QuadTreeNode.frag","webpack://webgl_polygon/./src/apps/collision/Events.ts","webpack://webgl_polygon/./src/apps/collision/tools/InteractionTool.ts","webpack://webgl_polygon/./src/lib/Dom/TouchDoubleTap.ts","webpack://webgl_polygon/./src/lib/Dom/TouchPan.ts","webpack://webgl_polygon/./src/lib/Dom/TouchZoom.ts","webpack://webgl_polygon/./src/lib/misc/Dom.ts","webpack://webgl_polygon/./src/apps/collision/collision_engines/renderers/QuadTreeNode.vert","webpack://webgl_polygon/./src/apps/collision/collision_engines/renderers/QuadTreeRenderer.ts","webpack://webgl_polygon/./src/apps/collision/collision_engines/CollisionEngine.ts","webpack://webgl_polygon/./src/lib/math/MathUtil.ts","webpack://webgl_polygon/./src/apps/collision/tools/artifacts/ZoomDefault.ts","webpack://webgl_polygon/./src/lib/misc/EventBus.ts","webpack://webgl_polygon/./src/apps/collision/tools/PanTool.ts","webpack://webgl_polygon/./src/apps/collision/tools/SelectionTool/SelectionRectangle.frag","webpack://webgl_polygon/./src/lib/misc/Primitives.ts","webpack://webgl_polygon/./src/lib/render/Camera.ts","webpack://webgl_polygon/./src/lib/render/Primitives.ts","webpack://webgl_polygon/./src/apps/collision/tools/SelectionTool/SelectionRectangle.vert","webpack://webgl_polygon/./src/apps/collision/tools/SelectionTool/SelectionTool.ts","webpack://webgl_polygon/./src/lib/misc/RandomFloat.ts","webpack://webgl_polygon/./src/lib/render/circle/circle.frag","webpack://webgl_polygon/./src/lib/render/circle/CircleRenderer.ts","webpack://webgl_polygon/./src/lib/render/circle/circle.vert","webpack://webgl_polygon/./src/lib/render/rectangle/rectangle.frag","webpack://webgl_polygon/./src/lib/render/rectangle/RectangleRenderer.ts","webpack://webgl_polygon/./src/apps/collision/App.ts","webpack://webgl_polygon/./src/lib/render/rectangle/rectangle.vert","webpack://webgl_polygon/./src/apps/collision/MyAsidePanel.vue","webpack://webgl_polygon/./src/apps/collision/MyBodiesSettings.vue","webpack://webgl_polygon/./src/apps/collision/MyBodiesSettings.vue?49a3","webpack://webgl_polygon/./src/apps/collision/MyBodiesSettings.vue?45b1","webpack://webgl_polygon/./src/apps/collision/MyBodiesSettings.vue?631b","webpack://webgl_polygon/./src/apps/collision/MyBoundarySettings.vue","webpack://webgl_polygon/./src/apps/collision/MyBoundarySettings.vue?cd7f","webpack://webgl_polygon/./src/apps/collision/MyBoundarySettings.vue?bd5b","webpack://webgl_polygon/./src/apps/collision/MyBoundarySettings.vue?b82d","webpack://webgl_polygon/./src/apps/collision/MyHelpPopup.vue","webpack://webgl_polygon/./src/apps/collision/MyHelpPopup.vue?a322","webpack://webgl_polygon/./src/apps/collision/MyHelpPopup.vue?efd5","webpack://webgl_polygon/./src/apps/collision/MyHelpPopup.vue?a527","webpack://webgl_polygon/./src/components/Tabs/MyTab.vue","webpack://webgl_polygon/./src/components/Tabs/MyTab.vue?76a1","webpack://webgl_polygon/./src/components/Tabs/MyTab.vue?0217","webpack://webgl_polygon/./src/components/Tabs/MyTab.vue?8c94","webpack://webgl_polygon/./src/components/Tabs/MyTabs.vue","webpack://webgl_polygon/./src/components/Tabs/MyTabs.vue?5d36","webpack://webgl_polygon/./src/apps/collision/MyAsidePanel.vue?cc77","webpack://webgl_polygon/./src/components/Tabs/MyTabs.vue?03a2","webpack://webgl_polygon/./src/components/Tabs/MyTabs.vue?fe9e","webpack://webgl_polygon/./src/apps/collision/MyAsidePanel.vue?1c86","webpack://webgl_polygon/./src/apps/collision/MyAsidePanel.vue?b844","webpack://webgl_polygon/./src/apps/collision/View.vue?28fe","webpack://webgl_polygon/./src/apps/collision/View.vue?dfd2","webpack://webgl_polygon/./src/apps/collision/View.vue?1fdf","webpack://webgl_polygon/./src/components/Viewport.vue","webpack://webgl_polygon/./src/components/Viewport.vue?76f1","webpack://webgl_polygon/./src/components/Viewport.vue?a713","webpack://webgl_polygon/./src/components/Viewport.vue?3ed8","webpack://webgl_polygon/./src/lib/misc/Throw.ts","webpack://webgl_polygon/./src/lib/render/ShaderProgram.ts"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',{staticClass:\"flex\"},[_c('Viewport',{staticClass:\"outline-none\",attrs:{\"tabindex\":\"0\",\"width\":_vm.width,\"height\":_vm.height,\"preserveDrawingBuffer\":\"true\"},on:{\"context-ready\":_vm.OnContextReady},nativeOn:{\"wheel\":function($event){$event.preventDefault();return _vm.OnWheel.apply(null, arguments)},\"mousemove\":function($event){return _vm.OnMouseMove.apply(null, arguments)},\"mousedown\":function($event){return _vm.OnMouseDown.apply(null, arguments)},\"mouseup\":function($event){return _vm.OnMouseUp.apply(null, arguments)},\"keydown\":function($event){return _vm.OnKeyDown.apply(null, arguments)},\"touchmove\":function($event){return _vm.OnTouchMove.apply(null, arguments)},\"touchstart\":function($event){return _vm.OnTouchStart.apply(null, arguments)},\"touchend\":function($event){return _vm.OnTouchEnd.apply(null, arguments)}}}),(_vm.isAppInitialized)?_c('my-aside-panel',{attrs:{\"app\":_vm.app},model:{value:(_vm.state),callback:function ($$v) {_vm.state=$$v},expression:\"state\"}}):_vm._e()],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export class Algorithm {\n  public static IsEqualValues<T>(...values: T[]): boolean {\n    for (let n = 1; n < values.length; ++n) {\n      if (values[0] !== values[n]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  public static MaxElement<T>(\n    iterable: Iterable<T>,\n    comp: (a: T, b: T) => boolean = (a, b) => a < b\n  ): T | null {\n    let max: T | null = null;\n\n    for (const value of iterable) {\n      if (max === null) {\n        max = value;\n      } else if (comp(max, value)) {\n        max = value;\n      }\n    }\n\n    return max;\n  }\n\n  public static MinElement<T>(\n    iterable: Iterable<T>,\n    comp: (a: T, b: T) => boolean = (a, b) => a < b\n  ): T | null {\n    return Algorithm.MaxElement(iterable, (a, b) => comp(b, a));\n  }\n}\n","export class Real {\n  public static IsEqual(a: number, b: number): boolean {\n    return Math.abs(a - b) < Number.EPSILON;\n  }\n}\n","import { Vec2 } from '../misc/Primitives';\n\nimport { Point } from './Point';\n\nexport class Vector2 {\n  public static Add(a: Vec2, b: Vec2): Vec2 {\n    return { X: a.X + b.X, Y: a.Y + b.Y };\n  }\n\n  public static Subtract(a: Vec2, b: Vec2): Vec2 {\n    return { X: a.X - b.X, Y: a.Y - b.Y };\n  }\n\n  public static Multiply(vector: Vec2, scalar: number): Vec2 {\n    return { X: vector.X * scalar, Y: vector.Y * scalar };\n  }\n\n  public static Divide(vector: Vec2, scalar: number): Vec2 {\n    return { X: vector.X / scalar, Y: vector.Y / scalar };\n  }\n\n  public static CrossProduct(a: Vec2, b: Vec2): number {\n    return a.X * b.Y - a.Y * b.X;\n  }\n\n  public static DotProduct(a: Vec2, b: Vec2): number {\n    return a.X * b.X + a.Y * b.Y;\n  }\n\n  public static Normalize(vec: Vec2): Vec2 {\n    return Vector2.Divide(vec, Point.Distance({ X: 0, Y: 0 }, vec));\n  }\n\n  public static Normal(vec: Vec2): Vec2 {\n    return { X: vec.Y, Y: -vec.X };\n  }\n\n  public static Reflect(ray: Vec2, surface: Vec2): Vec2 {\n    const normalizedSurface = Vector2.Normalize(surface);\n    const dot = Vector2.DotProduct(ray, normalizedSurface);\n    return Vector2.Subtract(Vector2.Multiply(normalizedSurface, 2 * dot), ray);\n  }\n\n  public static Angle(a: Vec2, b: Vec2): number {\n    return Math.atan2(a.Y, b.X) - Math.atan2(b.Y, b.X);\n  }\n}\n","import { AABBRectangle, Line, Rectangle, Vec2 } from '../misc/Primitives';\n\nimport { Real } from './Real';\nimport { Vector2 } from './Vector';\n\ninterface ExtremumResult<TPoint> {\n  min: TPoint;\n  max: TPoint;\n}\n\nexport type RotatedRectangleVertices = [Vec2, Vec2, Vec2, Vec2];\n\nexport class Point {\n  public static Distance(p0: Vec2, p1: Vec2): number {\n    return Math.sqrt(Point.SqrDistance(p0, p1));\n  }\n\n  public static SqrDistance(p0: Vec2, p1: Vec2): number {\n    return Math.pow(p0.X - p1.X, 2) + Math.pow(p0.Y - p1.Y, 2);\n  }\n\n  public static Extremum2(points: Vec2[]): ExtremumResult<Vec2> {\n    const min: Vec2 = {\n      X: Number.POSITIVE_INFINITY,\n      Y: Number.POSITIVE_INFINITY\n    };\n    const max: Vec2 = {\n      X: Number.NEGATIVE_INFINITY,\n      Y: Number.NEGATIVE_INFINITY\n    };\n\n    points.forEach(p => {\n      if (p.X < min.X) min.X = p.X;\n      if (p.X > max.X) max.X = p.X;\n      if (p.Y < min.Y) min.Y = p.Y;\n      if (p.Y > max.Y) max.Y = p.Y;\n    });\n\n    return { min, max };\n  }\n\n  /**\n   * Counterclockwise rotation around origin\n   */\n  public static Rotate(p: Vec2, angle: number): Vec2 {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n\n    return {\n      X: p.X * c - p.Y * s,\n      Y: p.X * s + p.Y * c\n    };\n  }\n\n  /**\n   * Counterclockwise rotation around another point\n   */\n  public static RotateAroundPoint(p: Vec2, origin: Vec2, angle: number): Vec2 {\n    const rotated = Point.Rotate(\n      { X: p.X - origin.X, Y: p.Y - origin.Y },\n      angle\n    );\n\n    rotated.X += origin.X;\n    rotated.Y += origin.Y;\n\n    return rotated;\n  }\n\n  /**\n   * Calculate vertices of a rotated rectangle\n   * @param rect rectangle\n   * @returns Array of vertices: [left bottom, right bottom, right top, left top]\n   */\n  public static RectangleVertices(rect: Rectangle): RotatedRectangleVertices {\n    const rectHalfWidth = rect.Dimension.Width / 2;\n    const rectHalfHeight = rect.Dimension.Height / 2;\n\n    return [\n      Point.RotateAroundPoint(\n        { X: rect.Center.X - rectHalfWidth, Y: rect.Center.Y - rectHalfHeight },\n        rect.Center,\n        rect.Angle\n      ),\n      Point.RotateAroundPoint(\n        { X: rect.Center.X + rectHalfWidth, Y: rect.Center.Y - rectHalfHeight },\n        rect.Center,\n        rect.Angle\n      ),\n      Point.RotateAroundPoint(\n        { X: rect.Center.X + rectHalfWidth, Y: rect.Center.Y + rectHalfHeight },\n        rect.Center,\n        rect.Angle\n      ),\n      Point.RotateAroundPoint(\n        { X: rect.Center.X - rectHalfWidth, Y: rect.Center.Y + rectHalfHeight },\n        rect.Center,\n        rect.Angle\n      )\n    ];\n  }\n\n  /**\n   * Calculate vertices of an AABB rectangle\n   * @param rect rectangle\n   * @returns Array of vertices: [left bottom, right bottom, right top, left top]\n   */\n  public static AabbRectangleVertices(\n    rect: AABBRectangle\n  ): RotatedRectangleVertices {\n    return [\n      { X: rect.X, Y: rect.Y },\n      { X: rect.X + rect.Width, Y: rect.Y },\n      { X: rect.X + rect.Width, Y: rect.Y + rect.Width },\n      { X: rect.X, Y: rect.Y + rect.Width }\n    ];\n  }\n\n  public static ClosestLine(point: Vec2, lines: Line[]): Line {\n    let closestIdx = -1;\n    let closestDistance = Number.POSITIVE_INFINITY;\n\n    for (let n = 0; n < lines.length; ++n) {\n      const line = lines[n];\n\n      const distance = Point.Distance(Point.ClosestToLine(point, line), point);\n\n      if (distance < closestDistance) {\n        closestIdx = n;\n        closestDistance = distance;\n      }\n    }\n\n    return lines[closestIdx];\n  }\n\n  public static ClosestToLine(point: Vec2, line: Line): Vec2 {\n    const ab = Vector2.Subtract(line.B, line.A);\n    const ap = Vector2.Subtract(point, line.A);\n\n    const proj = Vector2.DotProduct(ap, ab);\n\n    const abSqrLen = Vector2.DotProduct(ab, ab);\n\n    const d = proj / abSqrLen;\n\n    if (d <= 0) {\n      return line.A;\n    } else if (d >= 1) {\n      return line.B;\n    } else {\n      return Vector2.Add(line.A, Vector2.Multiply(ab, d));\n    }\n  }\n\n  public static IsEqual(a: Vec2, b: Vec2): boolean {\n    return Real.IsEqual(a.X, b.X) && Real.IsEqual(a.Y, b.Y);\n  }\n}\n","import { Algorithm } from '../misc/Algorithm';\nimport {\n  Circle,\n  AABBRectangle,\n  Rectangle,\n  Vec2,\n  Line\n} from '../misc/Primitives';\n\nimport { Point } from './Point';\nimport { Vector2 } from './Vector';\n\nexport class Intersection {\n  public static AABBRectangleCircle(\n    rect: AABBRectangle,\n    circle: Circle\n  ): boolean {\n    const circleDistanceX = Math.abs(\n      circle.Center.X - (rect.X + rect.Width / 2)\n    );\n    const circleDistanceY = Math.abs(\n      circle.Center.Y - (rect.Y + rect.Height / 2)\n    );\n\n    if (circleDistanceX > rect.Width / 2 + circle.Radius) {\n      return false;\n    }\n    if (circleDistanceY > rect.Height / 2 + circle.Radius) {\n      return false;\n    }\n\n    if (circleDistanceX <= rect.Width / 2) {\n      return true;\n    }\n    if (circleDistanceY <= rect.Height / 2) {\n      return true;\n    }\n\n    const cornerDistance_sq =\n      (circleDistanceX - rect.Width / 2) ** 2 +\n      (circleDistanceY - rect.Height / 2) ** 2;\n\n    return cornerDistance_sq <= circle.Radius ** 2;\n  }\n\n  public static RectangleCircle(rect: Rectangle, circle: Circle): boolean {\n    const transformedRect: AABBRectangle = {\n      X: -rect.Dimension.Width / 2,\n      Y: -rect.Dimension.Height / 2,\n      Width: rect.Dimension.Width,\n      Height: rect.Dimension.Height\n    };\n\n    const transformedCircle: Circle = {\n      Center: Point.Rotate(\n        {\n          X: circle.Center.X - rect.Center.X,\n          Y: circle.Center.Y - rect.Center.Y\n        },\n        -rect.Angle\n      ),\n      Radius: circle.Radius\n    };\n\n    return Intersection.AABBRectangleCircle(transformedRect, transformedCircle);\n  }\n\n  public static AABBRectanglePoint(rect: AABBRectangle, point: Vec2): boolean {\n    return (\n      point.X <= rect.X + rect.Width &&\n      point.X >= rect.X &&\n      point.Y <= rect.Y + rect.Height &&\n      point.Y >= rect.Y\n    );\n  }\n\n  /**\n   * Determine if two lines intersect\n   *\n   * @see https://github.com/pgkelley4/line-segments-intersect\n   * @see https://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect/565282#565282\n   * @param a first line\n   * @param b second line\n   * @returns true if lines is intersected\n   */\n  public static LineLine(a: Line, b: Line): boolean {\n    const r = Vector2.Subtract(a.B, a.A);\n    const s = Vector2.Subtract(b.B, b.A);\n\n    const ba = Vector2.Subtract(b.A, a.A);\n    const uNumerator = Vector2.CrossProduct(ba, r);\n    const denominator = Vector2.CrossProduct(r, s);\n\n    if (uNumerator === 0 && denominator === 0) {\n      if (\n        Point.IsEqual(a.A, b.A) ||\n        Point.IsEqual(a.A, b.B) ||\n        Point.IsEqual(a.B, b.A) ||\n        Point.IsEqual(a.B, b.B)\n      ) {\n        return true;\n      }\n\n      return (\n        !Algorithm.IsEqualValues(\n          b.A.X - a.A.X < 0,\n          b.A.X - a.B.X < 0,\n          b.B.X - a.A.X < 0,\n          b.B.X - a.B.X < 0\n        ) ||\n        !Algorithm.IsEqualValues(\n          b.A.Y - a.A.Y < 0,\n          b.A.Y - a.B.Y < 0,\n          b.B.Y - a.A.Y < 0,\n          b.B.Y - a.B.Y < 0\n        )\n      );\n    }\n\n    if (denominator === 0) {\n      return false;\n    }\n\n    const u = uNumerator / denominator;\n    const t = Vector2.CrossProduct(ba, s) / denominator;\n\n    return t >= 0 && t <= 1 && u >= 0 && u <= 1;\n  }\n\n  public static AABBRectangleLine(rect: AABBRectangle, line: Line): boolean {\n    const lb: Vec2 = { X: rect.X, Y: rect.Y };\n    const rb: Vec2 = { X: rect.X + rect.Width, Y: rect.Y };\n    const rt: Vec2 = { X: rb.X, Y: rect.Y + rect.Height };\n    const lt: Vec2 = { X: rect.X, Y: rt.Y };\n\n    // At least one the line point inside the rectangle\n    if (\n      Intersection.AABBRectanglePoint(rect, line.A) ||\n      Intersection.AABBRectanglePoint(rect, line.B)\n    ) {\n      return true;\n    }\n\n    // The line intersect at least one the rectangle edge\n    return (\n      Intersection.LineLine(line, { A: lb, B: rb }) ||\n      Intersection.LineLine(line, { A: rb, B: rt }) ||\n      Intersection.LineLine(line, { A: rt, B: lt }) ||\n      Intersection.LineLine(line, { A: lt, B: lb })\n    );\n  }\n\n  public static RectangleAABBRectangle(\n    rect: Rectangle,\n    aabbRectangle: AABBRectangle\n  ): boolean {\n    const rectHalfWidth = rect.Dimension.Width / 2;\n    const rectHalfHeight = rect.Dimension.Height / 2;\n\n    /**\n     * Case when the aabb rectangle inscribed in the rotated rectangle.\n     * Convert the rotated rectangle to aabb by rotating the points of both rectangles by a negative angle.\n     */\n    {\n      const [lb, rb, rt, lt] = Point.AabbRectangleVertices(aabbRectangle).map(\n        v => Point.RotateAroundPoint(v, rect.Center, -rect.Angle)\n      );\n\n      const aabbNonRotated: AABBRectangle = {\n        X: rect.Center.X - rectHalfWidth,\n        Y: rect.Center.Y - rectHalfHeight,\n        Width: rect.Dimension.Width,\n        Height: rect.Dimension.Height\n      };\n\n      // TODO Rethink this. We can return true if any of this point inscribed\n      if (\n        Intersection.AABBRectanglePoint(aabbNonRotated, lb) &&\n        Intersection.AABBRectanglePoint(aabbNonRotated, rb) &&\n        Intersection.AABBRectanglePoint(aabbNonRotated, rt) &&\n        Intersection.AABBRectanglePoint(aabbNonRotated, lt)\n      ) {\n        return true;\n      }\n    }\n\n    // Case when the rotated rectangle inscribed in the aabb rectangle or it edges crosses the aabb rectangle edges\n    {\n      const [lb, rb, rt, lt] = Point.RectangleVertices(rect);\n\n      return (\n        Intersection.AABBRectangleLine(aabbRectangle, { A: lb, B: rb }) ||\n        Intersection.AABBRectangleLine(aabbRectangle, { A: rb, B: rt }) ||\n        Intersection.AABBRectangleLine(aabbRectangle, { A: rt, B: lt }) ||\n        Intersection.AABBRectangleLine(aabbRectangle, { A: lt, B: lb })\n      );\n    }\n  }\n\n  public static LinePoint(line: Line, point: Vec2): boolean {\n    const aToPointDistance = Point.Distance(line.A, point);\n    const bToPointDistance = Point.Distance(line.B, point);\n    const lineLength = Point.Distance(line.A, line.B);\n\n    // TODO Tune epsilon\n    return Math.abs(aToPointDistance + bToPointDistance - lineLength) <= 0.01;\n  }\n\n  public static CirclePoint(circle: Circle, point: Vec2): boolean {\n    return Point.Distance(circle.Center, point) <= circle.Radius;\n  }\n\n  public static LineCircle(line: Line, circle: Circle): boolean {\n    if (Intersection.CirclePoint(circle, line.A)) {\n      return true;\n    }\n\n    if (Intersection.CirclePoint(circle, line.B)) {\n      return true;\n    }\n\n    const lineLength = Point.Distance(line.A, line.B);\n\n    const dot =\n      Vector2.DotProduct(\n        Vector2.Subtract(circle.Center, line.A),\n        Vector2.Subtract(line.B, line.A)\n      ) /\n      lineLength ** 2;\n\n    const closest = Vector2.Add(\n      Vector2.Multiply(Vector2.Subtract(line.B, line.A), dot),\n      line.A\n    );\n\n    if (!Intersection.LinePoint(line, closest)) {\n      return false;\n    }\n\n    return Point.Distance(closest, circle.Center) <= circle.Radius;\n  }\n\n  public static CircleCircle(c0: Circle, c1: Circle): boolean {\n    // TODO Implementation without sqrt: square sum <= (r1 + r2) ^ 2\n    return Point.Distance(c0.Center, c1.Center) <= c0.Radius + c1.Radius;\n  }\n}\n","import { CircleCollider } from './kinds/circle/CircleCollider';\nimport { StaticRectangleCollider } from './kinds/rectangle/StaticRectangleCollider';\n\nimport { Intersection } from '@/lib/math/Intersection';\nimport { Point } from '@/lib/math/Point';\nimport { Vector2 } from '@/lib/math/Vector';\nimport { Line, Vec2 } from '@/lib/misc/Primitives';\n\nexport class Collision {\n  public static CircleStaticRectangle(\n    circle: CircleCollider,\n    rectangle: StaticRectangleCollider\n  ): void {\n    const sides = [\n      { A: rectangle.Vertices[0], B: rectangle.Vertices[1] },\n      { A: rectangle.Vertices[1], B: rectangle.Vertices[2] },\n      { A: rectangle.Vertices[2], B: rectangle.Vertices[3] },\n      { A: rectangle.Vertices[3], B: rectangle.Vertices[0] }\n    ];\n\n    const collided = sides.filter(side =>\n      Intersection.LineCircle(side, circle)\n    );\n\n    let tangent: Vec2;\n\n    if (collided.length > 1) {\n      const collidedSidePoints = collided.flatMap(x => [x.A, x.B]);\n      const collidedCorner =\n        collidedSidePoints.find(a =>\n          collidedSidePoints.find(b => b === a)\n        ) ?? collidedSidePoints[0];\n      tangent = Vector2.Normal(Vector2.Subtract(collidedCorner, circle.Center));\n    } else if (collided.length === 0) {\n      const closestSide = Collision.MoveOutCircleFromStaticRectangle(\n        sides,\n        circle\n      );\n      tangent = Vector2.Subtract(closestSide.A, closestSide.B);\n    } else {\n      tangent = Vector2.Subtract(collided[0].A, collided[0].B);\n    }\n\n    if (collided.length > 0) {\n      Collision.SolveCollision(collided, circle);\n    }\n\n    const afterBounce = Vector2.Reflect(circle.Velocity, tangent);\n\n    circle.Velocity.X = afterBounce.X;\n    circle.Velocity.Y = afterBounce.Y;\n  }\n\n  private static MoveOutCircleFromStaticRectangle(\n    sides: Line[],\n    circle: CircleCollider\n  ): Line {\n    return Collision.AttachToClosestSide(sides, circle, true);\n  }\n\n  private static SolveCollision(sides: Line[], circle: CircleCollider): void {\n    Collision.AttachToClosestSide(sides, circle, false);\n  }\n\n  private static AttachToClosestSide(\n    sides: Line[],\n    circle: CircleCollider,\n    oppositeSide: boolean\n  ): Line {\n    const closestSide = Point.ClosestLine(circle.Center, sides);\n\n    const closestPointOnSide = Point.ClosestToLine(circle.Center, closestSide);\n\n    const transformNormal = Vector2.Normalize(\n      Vector2.Subtract(closestPointOnSide, circle.Center)\n    );\n\n    const operator = oppositeSide ? Vector2.Add : Vector2.Subtract;\n\n    const centerOutside = operator(\n      closestPointOnSide,\n      Vector2.Multiply(transformNormal, circle.Radius)\n    );\n\n    circle.Center.X = centerOutside.X;\n    circle.Center.Y = centerOutside.Y;\n\n    return closestSide;\n  }\n}\n","import { Collider } from '../../../collision_engines/Collider';\nimport { Collision } from '../../Collision';\nimport { StaticRectangleCollider } from '../rectangle/StaticRectangleCollider';\n\nimport { Intersection } from '@/lib/math/Intersection';\nimport { AABBRectangle, Vec2 } from '@/lib/misc/Primitives';\n\nexport class CircleCollider implements Collider {\n  public constructor(\n    public readonly Center: Vec2,\n    public Radius: number,\n    public readonly Velocity: Vec2\n  ) {}\n\n  public IsOverlap(rect: AABBRectangle): boolean {\n    return Intersection.AABBRectangleCircle(rect, this);\n  }\n\n  public IsInside(rect: AABBRectangle): boolean {\n    if (this.Center.X - this.Radius < rect.X) {\n      return false;\n    }\n\n    if (this.Center.X + this.Radius > rect.X + rect.Width) {\n      return false;\n    }\n\n    if (this.Center.Y - this.Radius < rect.Y) {\n      return false;\n    }\n\n    if (this.Center.Y + this.Radius > rect.Y + rect.Height) {\n      return false;\n    }\n\n    return true;\n  }\n\n  public IsCollide(another: Collider): boolean {\n    return another.CollideWithCircle(this);\n  }\n\n  public CollideWithCircle(circle: CircleCollider): boolean {\n    return Intersection.CircleCircle(this, circle);\n  }\n\n  public CollideWithRectangle(rect: StaticRectangleCollider): boolean {\n    return Intersection.RectangleCircle(rect, this);\n  }\n\n  public CheckCollision(collider: Collider, elapsed: number): void {\n    collider.CheckCollisionWithCircle(this, elapsed);\n  }\n\n  CheckCollisionWithCircle(circle: CircleCollider, _elapsed: number): void {\n    // TODO Firstly if circles is overlapped we should move they to prevent it\n    const angle = Math.atan2(\n      circle.Center.Y - this.Center.Y,\n      circle.Center.X - this.Center.X\n    );\n\n    const targetX = this.Center.X + Math.cos(angle) * 2 * this.Radius;\n    const targetY = this.Center.Y + Math.sin(angle) * 2 * this.Radius;\n\n    const ax = targetX - circle.Center.X;\n    const ay = targetY - circle.Center.Y;\n\n    this.Velocity.X -= ax;\n    this.Velocity.Y -= ay;\n\n    circle.Velocity.X += ax;\n    circle.Velocity.Y += ay;\n  }\n\n  CheckCollisionWithRectangle(\n    rect: StaticRectangleCollider,\n    _elapsed: number\n  ): void {\n    Collision.CircleStaticRectangle(this, rect);\n  }\n\n  public Move(boundary: AABBRectangle, elapsed: number): void {\n    const MaxVelocity = 25;\n\n    const velocity = Math.sqrt(this.Velocity.X ** 2 + this.Velocity.Y ** 2);\n\n    if (velocity > MaxVelocity) {\n      const normalizeFactor = MaxVelocity / velocity;\n\n      this.Velocity.X *= normalizeFactor;\n      this.Velocity.Y *= normalizeFactor;\n    }\n\n    let tickVelocityX = this.Velocity.X * (elapsed / 1000);\n    let tickVelocityY = this.Velocity.Y * (elapsed / 1000);\n\n    const boundaryRight = boundary.X + boundary.Width;\n    const boundaryTop = boundary.Y + boundary.Height;\n\n    if (this.Center.X - this.Radius + tickVelocityX < boundary.X) {\n      this.Center.X = boundary.X + this.Radius;\n\n      tickVelocityX *= -1;\n      this.Velocity.X *= -1;\n    } else if (this.Center.X + this.Radius + tickVelocityX > boundaryRight) {\n      this.Center.X = boundaryRight - this.Radius;\n\n      tickVelocityX *= -1;\n      this.Velocity.X *= -1;\n    }\n\n    if (this.Center.Y - this.Radius + tickVelocityY < boundary.Y) {\n      this.Center.Y = boundary.X + this.Radius;\n\n      tickVelocityY *= -1;\n      this.Velocity.Y *= -1;\n    } else if (this.Center.Y + this.Radius + tickVelocityY > boundaryTop) {\n      this.Center.Y = boundaryTop - this.Radius;\n\n      tickVelocityY *= -1;\n      this.Velocity.Y *= -1;\n    }\n\n    this.Center.X = this.Center.X + tickVelocityX;\n    this.Center.Y = this.Center.Y + tickVelocityY;\n  }\n}\n","import { DataDescriptor } from '../../../models/DataDescriptor';\nimport { VisualBody } from '../../VisualBody';\n\nimport { Color, Vec2 } from '@/lib/misc/Primitives';\n\nexport class VisualCircle implements VisualBody {\n  constructor(private readonly center: DataDescriptor) {}\n\n  set Color(color: Color) {\n    const colorOffset = this.center.offset + 2;\n\n    this.center.buffer[colorOffset] = color.R;\n    this.center.buffer[colorOffset + 1] = color.G;\n    this.center.buffer[colorOffset + 2] = color.B;\n  }\n\n  get Color(): Color {\n    const colorOffset = this.center.offset + 2;\n\n    return {\n      R: this.center.buffer[colorOffset],\n      G: this.center.buffer[colorOffset + 1],\n      B: this.center.buffer[colorOffset + 2]\n    };\n  }\n\n  public Center(center: Vec2): void {\n    this.center.buffer[this.center.offset + 0] = center.X;\n    this.center.buffer[this.center.offset + 1] = center.Y;\n  }\n}\n","import { Collider } from '../../../collision_engines/Collider';\nimport { DataDescriptor } from '../../../models/DataDescriptor';\nimport { Body } from '../../Body';\nimport { StaticRectangleCollider } from '../rectangle/StaticRectangleCollider';\n\nimport { CircleCollider } from './CircleCollider';\nimport { VisualCircle } from './VisualCircle';\n\nimport { AABBRectangle, Color, Vec2 } from '@/lib/misc/Primitives';\n\nexport class CircleBody implements Body {\n  private collider: CircleCollider;\n\n  private visual: VisualCircle;\n\n  constructor(center: DataDescriptor, radius: number, velocity: Vec2) {\n    this.collider = new CircleCollider(\n      this.ExtractCenter(center),\n      radius,\n      velocity\n    );\n    this.visual = new VisualCircle(center);\n  }\n\n  public IsOverlap(rect: AABBRectangle): boolean {\n    return this.collider.IsOverlap(rect);\n  }\n\n  public IsInside(rect: AABBRectangle): boolean {\n    return this.collider.IsInside(rect);\n  }\n\n  public IsCollide(another: Collider): boolean {\n    return this.collider.IsCollide(another);\n  }\n\n  public CollideWithCircle(circle: CircleCollider): boolean {\n    return this.collider.CollideWithCircle(circle);\n  }\n\n  public CollideWithRectangle(rect: StaticRectangleCollider): boolean {\n    return this.collider.CollideWithRectangle(rect);\n  }\n\n  set Color(color: Color) {\n    this.visual.Color = color;\n  }\n\n  get Color(): Color {\n    return this.visual.Color;\n  }\n\n  public MoveInto(rect: AABBRectangle): void {\n    const radius = this.collider.Radius;\n\n    const rectRight = rect.X + rect.Width;\n    const rectTop = rect.Y + rect.Height;\n\n    if (this.Center.X + radius > rectRight) {\n      this.Center = { X: rectRight - radius, Y: this.Center.Y };\n    } else if (this.Center.X - radius < rect.X) {\n      this.Center = { X: rect.X + radius, Y: this.Center.Y };\n    }\n\n    if (this.Center.Y + radius > rectTop) {\n      this.Center = { X: this.Center.X, Y: rectTop - radius };\n    } else if (this.Center.Y - radius < rect.Y) {\n      this.Center = { X: this.Center.X, Y: rect.Y + radius };\n    }\n  }\n\n  public CheckCollision(collider: Collider, elapsed: number): void {\n    this.collider.CheckCollision(collider, elapsed);\n  }\n\n  public CheckCollisionWithCircle(\n    circle: CircleCollider,\n    elapsed: number\n  ): void {\n    this.collider.CheckCollisionWithCircle(circle, elapsed);\n  }\n\n  public CheckCollisionWithRectangle(\n    rect: StaticRectangleCollider,\n    elapsed: number\n  ): void {\n    this.collider.CheckCollisionWithRectangle(rect, elapsed);\n  }\n\n  public Move(boundary: AABBRectangle, elapsed: number): void {\n    this.collider.Move(boundary, elapsed);\n\n    this.Center = this.collider.Center;\n  }\n\n  private get Center(): Vec2 {\n    return this.collider.Center;\n  }\n\n  private set Center(center: Vec2) {\n    this.collider.Center.X = center.X;\n    this.collider.Center.Y = center.Y;\n\n    this.visual.Center(center);\n  }\n\n  public get Radius(): number {\n    return this.collider.Radius;\n  }\n\n  public set Radius(radius: number) {\n    this.collider.Radius = radius;\n  }\n\n  private ExtractCenter(center: DataDescriptor): Vec2 {\n    return {\n      X: center.buffer[center.offset],\n      Y: center.buffer[center.offset + 1]\n    };\n  }\n}\n","import { Collider } from '../../../collision_engines/Collider';\nimport { Collision } from '../../Collision';\nimport { CircleCollider } from '../circle/CircleCollider';\n\nimport { Intersection } from '@/lib/math/Intersection';\nimport { Point } from '@/lib/math/Point';\nimport { AABBRectangle, Dimension, Vec2 } from '@/lib/misc/Primitives';\n\nexport class StaticRectangleCollider implements Collider {\n  public Vertices!: [Vec2, Vec2, Vec2, Vec2];\n  public constructor(\n    public readonly Center: Vec2,\n    public readonly Dimension: Dimension,\n    private angle: number\n  ) {\n    this.UpdateVertices();\n  }\n\n  public IsOverlap(rect: AABBRectangle): boolean {\n    return Intersection.RectangleAABBRectangle(this, rect);\n  }\n\n  IsInside(rect: AABBRectangle): boolean {\n    return this.Vertices.every(p => Intersection.AABBRectanglePoint(rect, p));\n  }\n\n  public IsCollide(another: Collider): boolean {\n    return another.CollideWithRectangle(this);\n  }\n\n  public CollideWithCircle(circle: CircleCollider): boolean {\n    return Intersection.RectangleCircle(this, circle);\n  }\n\n  public CollideWithRectangle(_rect: StaticRectangleCollider): boolean {\n    throw new Error('Not required now');\n  }\n\n  public CheckCollision(collider: Collider, elapsed: number): void {\n    collider.CheckCollisionWithRectangle(this, elapsed);\n  }\n\n  public CheckCollisionWithCircle(\n    circle: CircleCollider,\n    _elapsed: number\n  ): void {\n    Collision.CircleStaticRectangle(circle, this);\n  }\n\n  public CheckCollisionWithRectangle(\n    _rect: StaticRectangleCollider,\n    _elapsed: number\n  ): void {\n    // Since we doesn't have any moving rectangles its not necessary\n    throw new Error('Method not implemented.');\n  }\n\n  public Move(_boundary: AABBRectangle, _elapsed: number): void {\n    // Since it's a static - nothing to do\n  }\n\n  public get Angle(): number {\n    return this.angle;\n  }\n\n  public set Angle(val: number) {\n    this.angle = val;\n\n    this.UpdateVertices();\n  }\n\n  private UpdateVertices(): void {\n    this.Vertices = Point.RectangleVertices(this);\n  }\n}\n","import { VisualBody } from '../../VisualBody';\n\nimport { Color } from '@/lib/misc/Primitives';\nimport { DataDescriptor } from '@/lib/render/PrimitivesRenderer';\n\nexport class VisualRectangle implements VisualBody {\n  constructor(private readonly data: DataDescriptor) {}\n\n  set Color(color: Color) {\n    this.data.buffer[this.data.offset + 2] = color.R;\n    this.data.buffer[this.data.offset + 3] = color.G;\n    this.data.buffer[this.data.offset + 4] = color.B;\n\n    this.data.buffer[this.data.offset + 7] = color.R;\n    this.data.buffer[this.data.offset + 8] = color.G;\n    this.data.buffer[this.data.offset + 9] = color.B;\n\n    this.data.buffer[this.data.offset + 12] = color.R;\n    this.data.buffer[this.data.offset + 13] = color.G;\n    this.data.buffer[this.data.offset + 14] = color.B;\n\n    this.data.buffer[this.data.offset + 17] = color.R;\n    this.data.buffer[this.data.offset + 18] = color.G;\n    this.data.buffer[this.data.offset + 19] = color.B;\n\n    this.data.buffer[this.data.offset + 22] = color.R;\n    this.data.buffer[this.data.offset + 23] = color.G;\n    this.data.buffer[this.data.offset + 24] = color.B;\n\n    this.data.buffer[this.data.offset + 27] = color.R;\n    this.data.buffer[this.data.offset + 28] = color.G;\n    this.data.buffer[this.data.offset + 29] = color.B;\n  }\n\n  get Color(): Color {\n    return {\n      R: this.data.buffer[this.data.offset + 2],\n      G: this.data.buffer[this.data.offset + 3],\n      B: this.data.buffer[this.data.offset + 4]\n    };\n  }\n}\n","import { Body } from '../../Body';\nimport { CircleCollider } from '../circle/CircleCollider';\n\nimport { StaticRectangleCollider } from './StaticRectangleCollider';\nimport { VisualRectangle } from './VisualRectangle';\n\nimport { Collider } from '@/apps/collision/collision_engines/Collider';\nimport { AABBRectangle, Color, Rectangle } from '@/lib/misc/Primitives';\nimport { DataDescriptor } from '@/lib/render/PrimitivesRenderer';\n\nexport class StaticRectangleBody implements Body {\n  private collider: StaticRectangleCollider;\n\n  private visual: VisualRectangle;\n\n  constructor(data: DataDescriptor, rect: Rectangle) {\n    this.collider = new StaticRectangleCollider(\n      rect.Center,\n      rect.Dimension,\n      rect.Angle\n    );\n    this.visual = new VisualRectangle(data);\n  }\n\n  MoveInto(_rect: AABBRectangle): void {\n    throw new Error('Method not implemented.');\n  }\n\n  set Color(color: Color) {\n    this.visual.Color = color;\n  }\n\n  get Color(): Color {\n    return this.visual.Color;\n  }\n\n  IsOverlap(rect: AABBRectangle): boolean {\n    return this.collider.IsOverlap(rect);\n  }\n\n  IsInside(rect: AABBRectangle): boolean {\n    return this.collider.IsInside(rect);\n  }\n\n  IsCollide(another: Collider): boolean {\n    return this.collider.IsCollide(another);\n  }\n\n  CollideWithCircle(circle: CircleCollider): boolean {\n    return this.collider.CollideWithCircle(circle);\n  }\n\n  CollideWithRectangle(rect: StaticRectangleCollider): boolean {\n    return this.collider.CollideWithRectangle(rect);\n  }\n\n  CheckCollision(collider: Collider, elapsed: number): void {\n    this.collider.CheckCollision(collider, elapsed);\n  }\n\n  CheckCollisionWithCircle(circle: CircleCollider, elapsed: number): void {\n    this.collider.CheckCollisionWithCircle(circle, elapsed);\n  }\n\n  CheckCollisionWithRectangle(\n    rect: StaticRectangleCollider,\n    elapsed: number\n  ): void {\n    this.collider.CheckCollisionWithRectangle(rect, elapsed);\n  }\n\n  Move(boundary: AABBRectangle, elapsed: number): void {\n    this.collider.Move(boundary, elapsed);\n  }\n}\n","export default \"#version 300 es\\n\\nprecision mediump float;\\n\\nin vec3 color;\\nout vec4 outColor;\\n\\nvoid main() \\n{\\n    outColor = vec4(color, 1);\\n}\\n\"","export default \"#version 300 es\\nprecision mediump float;\\n\\nin vec2 a_vertex;\\nin vec3 a_color;\\n\\nuniform vec3 u_cam;\\nuniform vec2 u_resolution;\\n\\nout vec3 color;\\n\\nvoid main() \\n{\\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\\n  color = a_color;\\n}\\n\"","export function EnumSize<T extends object>(e: T): number {\n  return Object.keys(e).length >> 1;\n}\n","import { Point } from '../math/Point';\nimport { AABBRectangle, Rectangle, Rgb, Rgba } from '../misc/Primitives';\n\nexport class PrimitiveBuilder {\n  // TODO Use AABBRectangle interface in params\n  public static AABBColorRectangle(\n    rect: AABBRectangle,\n    color: Rgb | Rgba\n  ): number[] {\n    const leftBottom = [rect.X, rect.Y, ...color];\n    const leftTop = [rect.X, rect.Y + rect.Height, ...color];\n    const rightTop = [rect.X + rect.Width, rect.Y + rect.Height, ...color];\n    const rightBottom = [rect.X + rect.Width, rect.Y, ...color];\n\n    return [\n      ...leftBottom,\n      ...rightTop,\n      ...leftTop,\n      ...leftBottom,\n      ...rightBottom,\n      ...rightTop\n    ];\n  }\n\n  public static ColorRectangle(rect: Rectangle, color: Rgb | Rgba): number[] {\n    const [lb, rb, rt, lt] = Point.RectangleVertices(rect);\n\n    return [\n      lb.X,\n      lb.Y,\n      ...color,\n      rt.X,\n      rt.Y,\n      ...color,\n      lt.X,\n      lt.Y,\n      ...color,\n      lb.X,\n      lb.Y,\n      ...color,\n      rb.X,\n      rb.Y,\n      ...color,\n      rt.X,\n      rt.Y,\n      ...color\n    ];\n  }\n}\n","type SupportedTypes<T extends readonly (readonly [GLenum, number])[]> =\n  T[number][0];\n\nexport class TypeSizeResolver {\n  private static readonly Sizes = [\n    [window.WebGL2RenderingContext.BYTE, Int8Array.BYTES_PER_ELEMENT] as const,\n    [\n      window.WebGL2RenderingContext.SHORT,\n      Int16Array.BYTES_PER_ELEMENT\n    ] as const,\n    [\n      window.WebGL2RenderingContext.UNSIGNED_BYTE,\n      Uint8Array.BYTES_PER_ELEMENT\n    ] as const,\n    [\n      window.WebGL2RenderingContext.UNSIGNED_SHORT,\n      Uint16Array.BYTES_PER_ELEMENT\n    ] as const,\n    [\n      window.WebGL2RenderingContext.FLOAT,\n      Float32Array.BYTES_PER_ELEMENT\n    ] as const,\n    [window.WebGL2RenderingContext.HALF_FLOAT, 2] as const,\n    [window.WebGL2RenderingContext.INT, Int32Array.BYTES_PER_ELEMENT] as const,\n    [\n      window.WebGL2RenderingContext.UNSIGNED_INT,\n      Uint32Array.BYTES_PER_ELEMENT\n    ] as const,\n    [\n      window.WebGL2RenderingContext.INT_2_10_10_10_REV,\n      Int32Array.BYTES_PER_ELEMENT\n    ] as const,\n    [\n      window.WebGL2RenderingContext.UNSIGNED_INT_2_10_10_10_REV,\n      Int32Array.BYTES_PER_ELEMENT\n    ] as const\n  ] as const;\n\n  public static Resolve(\n    type: SupportedTypes<typeof TypeSizeResolver.Sizes>\n  ): number {\n    return (\n      TypeSizeResolver.Sizes.find(x => x[0] === type) as [GLenum, number]\n    )[1];\n  }\n}\n","export function NotNull(): never {\n  throw new Error('Null or undefined are not acceptable');\n}\n","import FBorder from './border.frag';\nimport VBorder from './border.vert';\n\nimport { EnumSize } from '@/lib/misc/EnumSize';\nimport { Dimension, Rgb } from '@/lib/misc/Primitives';\nimport { PrimitiveBuilder } from '@/lib/render/PrimitiveBuilder';\nimport { RVec2, RVec3 } from '@/lib/render/Primitives';\nimport { PrimitivesRenderer } from '@/lib/render/PrimitivesRenderer';\nimport { TypeSizeResolver } from '@/lib/render/TypeSizeResolver';\n\nenum BorderComponent {\n  X = 0,\n  Y,\n  R,\n  G,\n  B\n}\n\nexport class BorderRenderer extends PrimitivesRenderer {\n  public static ComponentsPerIndex = EnumSize(BorderComponent);\n\n  private viewDimension: RVec2 = [800, 600];\n  private camera: RVec3 = [0, 0, 1];\n\n  private readonly borderColorConfig = {\n    default: [0.5, 0.5, 0.5] as Rgb\n  };\n  constructor(gl: WebGL2RenderingContext, private borderDimension: Dimension) {\n    const floatSize = TypeSizeResolver.Resolve(gl.FLOAT);\n    const stride = floatSize * BorderRenderer.ComponentsPerIndex;\n\n    super(\n      gl,\n      { vertex: VBorder, fragment: FBorder },\n      [\n        {\n          name: 'a_vertex',\n          size: 2,\n          type: gl.FLOAT,\n          normalized: false,\n          stride,\n          offset: 0\n        },\n        {\n          name: 'a_color',\n          size: 3,\n          type: gl.FLOAT,\n          normalized: false,\n          stride,\n          offset: 2 * floatSize\n        }\n      ],\n      { indicesPerPrimitive: 6, basePrimitiveType: gl.TRIANGLES }\n    );\n\n    this.ResizeView(borderDimension);\n  }\n\n  public ResizeView(size: Dimension): void {\n    this.viewDimension = [size.Width, size.Height];\n\n    this.shader.SetUniform2fv('u_resolution', this.viewDimension);\n  }\n\n  public Dimension(size: Dimension): void {\n    this.borderDimension = { ...size };\n\n    this.UploadAttributes(this.BuildBorder());\n  }\n\n  public Camera(camera: RVec3): void {\n    this.camera = [...camera];\n\n    this.shader.SetUniform3fv('u_cam', this.camera);\n  }\n\n  private BuildBorder() {\n    const BorderWidth = 2;\n    // Left, Top, Right, Bottom\n    return [\n      ...PrimitiveBuilder.AABBColorRectangle(\n        {\n          X: -BorderWidth,\n          Y: 0,\n          Width: BorderWidth,\n          Height: this.borderDimension.Height\n        },\n        this.borderColorConfig.default\n      ),\n      ...PrimitiveBuilder.AABBColorRectangle(\n        {\n          X: -BorderWidth,\n          Y: this.borderDimension.Height,\n          Width: this.borderDimension.Width + 2 * BorderWidth,\n          Height: BorderWidth\n        },\n        this.borderColorConfig.default\n      ),\n      ...PrimitiveBuilder.AABBColorRectangle(\n        {\n          X: this.borderDimension.Width,\n          Y: 0,\n          Width: BorderWidth,\n          Height: this.borderDimension.Height\n        },\n        this.borderColorConfig.default\n      ),\n      ...PrimitiveBuilder.AABBColorRectangle(\n        {\n          X: -BorderWidth,\n          Y: -BorderWidth,\n          Width: this.borderDimension.Width + 2 * BorderWidth,\n          Height: BorderWidth\n        },\n        this.borderColorConfig.default\n      )\n    ];\n  }\n}\n","import { TypeSizeResolver } from './TypeSizeResolver';\n\nimport { NotNull } from '@/lib/misc/NotNull';\nimport { ShaderProgram } from '@/lib/render/ShaderProgram';\n\ninterface ShaderProgramSource {\n  vertex: string;\n  fragment: string;\n}\n\ntype AttributeType =\n  | typeof WebGL2RenderingContext.BYTE\n  | typeof WebGL2RenderingContext.SHORT\n  | typeof WebGL2RenderingContext.UNSIGNED_BYTE\n  | typeof WebGL2RenderingContext.UNSIGNED_SHORT\n  | typeof WebGL2RenderingContext.FLOAT\n  | typeof WebGL2RenderingContext.HALF_FLOAT\n  | typeof WebGL2RenderingContext.INT\n  | typeof WebGL2RenderingContext.UNSIGNED_INT\n  | typeof WebGL2RenderingContext.INT_2_10_10_10_REV\n  | typeof WebGL2RenderingContext.UNSIGNED_INT_2_10_10_10_REV;\n\ntype BasePrimitiveType =\n  | typeof WebGL2RenderingContext.POINTS\n  | typeof WebGL2RenderingContext.LINES\n  | typeof WebGL2RenderingContext.LINE_LOOP\n  | typeof WebGL2RenderingContext.LINE_STRIP\n  | typeof WebGL2RenderingContext.TRIANGLES\n  | typeof WebGL2RenderingContext.TRIANGLE_STRIP\n  | typeof WebGL2RenderingContext.TRIANGLE_FAN;\n\ninterface AttributeDescription {\n  name: string;\n  size: GLint;\n  type: AttributeType;\n  normalized: GLboolean;\n  stride: GLsizei;\n  offset: GLintptr;\n}\n\ninterface PrimitiveDescription {\n  indicesPerPrimitive: number;\n  basePrimitiveType: BasePrimitiveType;\n}\n\nexport interface DataDescriptor {\n  buffer: Float32Array;\n  offset: number;\n}\n\nexport class PrimitivesRenderer {\n  private vbo!: WebGLBuffer;\n  private vao!: WebGLVertexArrayObject;\n  protected shader!: ShaderProgram;\n\n  private attributes!: Float32Array;\n\n  private componentsPerAttributeSet = 0;\n  private attributeSetCount = 0;\n\n  constructor(\n    private readonly gl: WebGL2RenderingContext,\n    shaderSource: ShaderProgramSource,\n    attributes: AttributeDescription[],\n    private readonly primitiveDescription: PrimitiveDescription\n  ) {\n    this.Setup(shaderSource);\n    this.SetupAttributes(attributes);\n  }\n\n  public UploadAttributes(attrib: number[]): void {\n    this.attributes = new Float32Array(attrib);\n\n    this.attributeSetCount =\n      this.attributes.length / this.componentsPerAttributeSet;\n\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vbo);\n    this.gl.bufferData(\n      this.gl.ARRAY_BUFFER,\n      this.attributes,\n      this.gl.DYNAMIC_DRAW\n    );\n  }\n\n  public PrimitiveAttributes(index: number): DataDescriptor {\n    return {\n      buffer: this.attributes,\n      offset:\n        index *\n        this.componentsPerAttributeSet *\n        this.primitiveDescription.indicesPerPrimitive\n    };\n  }\n\n  public Draw(): void {\n    this.shader.Use();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vbo);\n    this.gl.bufferData(\n      this.gl.ARRAY_BUFFER,\n      this.attributes,\n      this.gl.DYNAMIC_DRAW\n    );\n    this.gl.bindVertexArray(this.vao);\n    this.gl.drawArrays(\n      this.primitiveDescription.basePrimitiveType,\n      0,\n      this.attributeSetCount\n    );\n  }\n\n  private Setup(shaderSource: ShaderProgramSource): void {\n    this.vbo = this.gl.createBuffer() ?? NotNull();\n    this.vao = this.gl.createVertexArray() ?? NotNull();\n\n    this.shader = new ShaderProgram(this.gl);\n    this.shader.Attach(this.gl.FRAGMENT_SHADER, shaderSource.fragment);\n    this.shader.Attach(this.gl.VERTEX_SHADER, shaderSource.vertex);\n    this.shader.Link();\n    this.shader.Use();\n  }\n\n  private SetupAttributes(attributes: AttributeDescription[]): void {\n    if (attributes.length === 0) {\n      throw new Error(\"Attributes description can't be empty\");\n    }\n\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vbo);\n\n    this.gl.bindVertexArray(this.vao);\n\n    const stride = attributes.reduce(\n      (stride, attr) =>\n        stride + attr.size * TypeSizeResolver.Resolve(attr.type),\n      0\n    );\n\n    this.componentsPerAttributeSet =\n      stride / TypeSizeResolver.Resolve(attributes[0].type);\n\n    for (\n      let n = 0, offset = 0;\n      n < attributes.length;\n      offset +=\n        attributes[n].size * TypeSizeResolver.Resolve(attributes[n].type),\n        ++n\n    ) {\n      const attr = attributes[n];\n\n      const location = this.shader.GetAttributeLocation(attr.name);\n      this.gl.enableVertexAttribArray(location);\n      this.gl.vertexAttribPointer(\n        location,\n        attr.size,\n        attr.type,\n        attr.normalized,\n        stride,\n        offset\n      );\n    }\n\n    this.gl.bindVertexArray(null);\n  }\n}\n","import { Collider } from './Collider';\nimport { CollisionEngine } from './CollisionEngine';\n\nexport class BruteForceCollisionEngine implements CollisionEngine {\n  Reset(): void {\n    this.objects.splice(0);\n  }\n  private objects: Collider[] = [];\n\n  Add(object: Collider): boolean {\n    this.objects.push(object);\n\n    return true;\n  }\n\n  Remove(object: Collider): boolean {\n    const removedIdx = this.objects.indexOf(object);\n\n    if (removedIdx >= 0) {\n      this.objects.splice(removedIdx, 1);\n\n      return true;\n    }\n\n    return false;\n  }\n\n  ForEachCollided(handler: (a: Collider, b: Collider) => void): void {\n    for (let aIdx = 0; aIdx < this.objects.length; ++aIdx) {\n      for (let bIdx = aIdx + 1; bIdx < this.objects.length; ++bIdx) {\n        const a = this.objects[aIdx];\n        const b = this.objects[bIdx];\n\n        if (a.IsCollide(b)) {\n          handler(a, b);\n        }\n      }\n    }\n  }\n\n  RecalculateBuckets(): void {\n    // No buckets no problem\n  }\n\n  Draw(_elapsed: number): void {\n    // Nothing to draw\n  }\n}\n","import { Collider } from './Collider';\nimport { CollisionEngine } from './CollisionEngine';\nimport { QuadTreeRenderer } from './renderers/QuadTreeRenderer';\n\nexport class Boundary {\n  constructor(\n    public X: number,\n    public Y: number,\n    public Width: number,\n    public Height: number\n  ) {}\n\n  get Right(): number {\n    return this.X + this.Width;\n  }\n  get Top(): number {\n    return this.Y + this.Height;\n  }\n}\n\ninterface QuadNodePoolItem {\n  node: QuadNode;\n  nextFree: number;\n}\n\ninterface QuadNodePoolCreateResult {\n  idx: number;\n  node: QuadNode;\n}\n\nexport class QuadNodePool {\n  private static readonly NoNext = -1;\n  private static readonly GrowthFactor = 2;\n\n  private nextFree = QuadNodePool.NoNext;\n  private pool: QuadNodePoolItem[] = [];\n\n  Create(): QuadNodePoolCreateResult {\n    if (this.IsFull) {\n      this.Expand();\n    }\n\n    const free = this.pool[this.nextFree];\n    const idx = this.nextFree;\n\n    this.nextFree = free.nextFree;\n\n    return { idx, node: free.node };\n  }\n\n  Free(roomIdx: number): void {\n    this.pool[roomIdx].nextFree = this.nextFree;\n    this.nextFree = roomIdx;\n  }\n\n  At(roomIdx: number): QuadNode {\n    return this.pool[roomIdx].node;\n  }\n\n  private Expand(): void {\n    this.nextFree = this.pool.length;\n\n    this.pool = Array.from({ length: this.ExtendedSize }, (_x, n) => {\n      const node =\n        n < this.pool.length\n          ? this.pool[n].node\n          : new QuadNode(new Boundary(0, 0, 0, 0));\n\n      return { node, nextFree: n + 1 };\n    });\n\n    this.pool[this.pool.length - 1].nextFree = QuadNodePool.NoNext;\n  }\n\n  private get IsFull(): boolean {\n    return this.nextFree === QuadNodePool.NoNext;\n  }\n\n  private get ExtendedSize(): number {\n    return this.pool.length === 0\n      ? QuadNodePool.GrowthFactor\n      : this.pool.length * QuadNodePool.GrowthFactor;\n  }\n}\n\nexport class QuadNode {\n  private static readonly ChildrenPerNode = 4;\n  private static readonly NullNode = -1;\n  private static readonly MaxDepth = 8;\n  private static readonly Capacity = 16;\n  private static readonly CollapseRatio = 0.25;\n\n  private readonly objects: Collider[] = [];\n  public childStart = QuadNode.NullNode;\n\n  constructor(\n    public readonly boundary: Boundary,\n    private parent: number = QuadNode.NullNode,\n    private isLeaf = true,\n    private depth: number = 1\n  ) {}\n\n  Add(obj: Collider, leafs: Set<number>, nodePool: QuadNodePool): boolean {\n    if (!obj.IsOverlap(this.boundary)) {\n      return false;\n    }\n\n    if (this.IsLeaf) {\n      if (this.NeedSplit) {\n        this.Split(leafs, nodePool);\n\n        return this.AddToChildren(obj, leafs, nodePool);\n      } else if (!this.objects.includes(obj)) {\n        this.objects.push(obj);\n      }\n    } else {\n      return this.AddToChildren(obj, leafs, nodePool);\n    }\n\n    return true;\n  }\n\n  AddToChildren(\n    obj: Collider,\n    leafs: Set<number>,\n    nodePool: QuadNodePool\n  ): boolean {\n    let added = false;\n\n    for (let n = 0; n < QuadNode.ChildrenPerNode; ++n) {\n      added =\n        nodePool.At(this.childStart + n).Add(obj, leafs, nodePool) || added;\n    }\n\n    return added;\n  }\n\n  ForEachChild<TFn extends (val: QuadNode, idx: number) => void>(\n    fn: TFn,\n    nodePool: QuadNodePool\n  ): void {\n    for (let n = 0; n < QuadNode.ChildrenPerNode; ++n) {\n      const idx = this.childStart + n;\n      fn(nodePool.At(idx), idx);\n    }\n  }\n\n  FindNodeContaining(obj: Collider, nodePool: QuadNodePool): number[] {\n    const quads: number[] = [];\n\n    const search = (nodeIdx: number) => {\n      const node = nodePool.At(nodeIdx);\n\n      if (!obj.IsOverlap(this.boundary)) {\n        return;\n      }\n\n      if (node.isLeaf) {\n        if (node.objects.indexOf(obj) >= 0) {\n          quads.push(nodeIdx);\n        }\n      } else {\n        node.ForEachChild((_child, idx) => search(idx), nodePool);\n      }\n    };\n\n    search(this.PoolIdx(nodePool));\n\n    return quads;\n  }\n\n  FilterCollided(circle: Collider): Collider[] {\n    return this.objects.filter(\n      object => circle !== object && object.IsCollide(circle)\n    );\n  }\n\n  RecalculateBucket(\n    root: QuadNode,\n    leafs: Set<number>,\n    nodePool: QuadNodePool\n  ): void {\n    const outOfNode: Collider[] = [];\n\n    leafs.forEach(leafIdx => {\n      const leaf = nodePool.At(leafIdx);\n\n      for (let n = 0, step = 1; n < leaf.objects.length; n += step) {\n        const obj = leaf.objects[n];\n        if (!obj.IsOverlap(leaf.boundary)) {\n          leaf.RemoveFromNodes(obj, [leafIdx], leafs, nodePool);\n\n          outOfNode.push(obj);\n\n          step = 0;\n        } else if (!obj.IsInside(leaf.boundary)) {\n          outOfNode.push(obj);\n          step = 1;\n        } else {\n          step = 1;\n        }\n      }\n    });\n\n    outOfNode.forEach(obj => root.Add(obj, leafs, nodePool));\n  }\n\n  RemoveFromNodes(\n    obj: Collider,\n    nodesIdx: number[],\n    leafs: Set<number>,\n    nodePool: QuadNodePool\n  ): boolean {\n    if (nodesIdx.length === 0) {\n      return false;\n    }\n\n    nodesIdx.forEach(nodeIdx => {\n      const node = nodePool.At(nodeIdx);\n\n      const remove = node.objects.indexOf(obj);\n      if (remove >= 0) {\n        node.objects.splice(remove, 1);\n      }\n    });\n\n    for (const node of nodesIdx) {\n      for (\n        let collapseCandidate = node;\n        collapseCandidate !== QuadNode.NullNode &&\n        nodePool.At(collapseCandidate).NeedCollapse(nodePool);\n        collapseCandidate = nodePool.At(collapseCandidate).parent\n      ) {\n        nodePool.At(collapseCandidate).Collapse(leafs, nodePool);\n      }\n    }\n\n    return true;\n  }\n\n  Remove(obj: Collider, leafs: Set<number>, nodePool: QuadNodePool): boolean {\n    return this.RemoveFromNodes(\n      obj,\n      this.FindNodeContaining(obj, nodePool),\n      leafs,\n      nodePool\n    );\n  }\n\n  get HasChild(): boolean {\n    return this.childStart !== QuadNode.NullNode;\n  }\n\n  Size(nodePool: QuadNodePool): number {\n    return QuadNode.Size(this.PoolIdx(nodePool), nodePool);\n  }\n\n  private PoolIdx(nodePool: QuadNodePool): number {\n    if (this.isLeaf) {\n      if (this.parent === QuadNode.NullNode) {\n        return 0;\n      } else {\n        const parent = nodePool.At(this.parent);\n        for (let n = 0; n < QuadNode.ChildrenPerNode; ++n) {\n          const idx = parent.childStart + n;\n\n          if (nodePool.At(idx) === this) {\n            return idx;\n          }\n        }\n      }\n    } else {\n      return nodePool.At(this.childStart).parent;\n    }\n\n    return QuadNode.NullNode;\n  }\n\n  private get IsLeaf() {\n    return this.isLeaf;\n  }\n\n  // Can be called only on leaf node\n  private get NeedSplit() {\n    return (\n      this.objects.length >= QuadNode.Capacity && this.depth < QuadNode.MaxDepth\n    );\n  }\n\n  // Can be called only on leaf node\n  private NeedCollapse(nodePool: QuadNodePool): boolean {\n    return (\n      this.objects.length / QuadNode.Capacity < QuadNode.CollapseRatio &&\n      this.parent !== QuadNode.NullNode &&\n      QuadNode.Size(this.parent, nodePool) <= QuadNode.Capacity\n    );\n  }\n\n  private Split(leafs: Set<number>, nodePool: QuadNodePool) {\n    const halfWidth = this.boundary.Width / 2;\n    const halfHeight = this.boundary.Height / 2;\n\n    const firstChild = nodePool.Create();\n    const idx = this.PoolIdx(nodePool);\n\n    QuadNode.ConstructInPlace(firstChild.node, {\n      boundary: new Boundary(\n        this.boundary.X + halfWidth,\n        this.boundary.Y + halfHeight,\n        halfWidth,\n        halfHeight\n      ),\n      parent: idx,\n      isLeaf: true,\n      depth: this.depth + 1\n    });\n\n    this.childStart = firstChild.idx;\n\n    QuadNode.ConstructInPlace(nodePool.Create().node, {\n      boundary: new Boundary(\n        this.boundary.X,\n        this.boundary.Y + halfHeight,\n        halfWidth,\n        halfHeight\n      ),\n      parent: idx,\n      isLeaf: true,\n      depth: this.depth + 1\n    });\n\n    QuadNode.ConstructInPlace(nodePool.Create().node, {\n      boundary: new Boundary(\n        this.boundary.X,\n        this.boundary.Y,\n        halfWidth,\n        halfHeight\n      ),\n      parent: idx,\n      isLeaf: true,\n      depth: this.depth + 1\n    });\n\n    QuadNode.ConstructInPlace(nodePool.Create().node, {\n      boundary: new Boundary(\n        this.boundary.X + halfWidth,\n        this.boundary.Y,\n        halfWidth,\n        halfHeight\n      ),\n      parent: idx,\n      isLeaf: true,\n      depth: this.depth + 1\n    });\n\n    this.objects.forEach(obj => {\n      const added = this.AddToChildren(obj, leafs, nodePool);\n\n      if (!added) {\n        throw new Error(\n          'Leaf has object that not fit. Probably some mistake in RecalculateBucket implementation'\n        );\n      }\n    });\n\n    this.objects.splice(0);\n    this.isLeaf = false;\n\n    leafs.delete(idx);\n    this.ForEachChild((_leaf, idx) => leafs.add(idx), nodePool);\n  }\n\n  // Can be called only on leaf node with parent\n  private Collapse(leafs: Set<number>, nodePool: QuadNodePool): void {\n    if (this.parent === QuadNode.NullNode) {\n      throw new Error(\"Can't collapse a root node\");\n    }\n\n    if (!this.IsLeaf) {\n      throw new Error(\"Can't collapse a non leaf node\");\n    }\n\n    const receiver = new Set<Collider>();\n    const gather = (node: QuadNode) => {\n      if (node.IsLeaf) {\n        node.objects.forEach(obj => receiver.add(obj));\n        node.objects.splice(0);\n        leafs.delete(node.PoolIdx(nodePool));\n      } else {\n        node.ForEachChild(node => gather(node), nodePool);\n      }\n    };\n\n    const parent = nodePool.At(this.parent);\n    gather(parent);\n\n    for (\n      let childOffset = QuadNode.ChildrenPerNode - 1;\n      childOffset >= 0;\n      --childOffset\n    ) {\n      nodePool.Free(parent.childStart + childOffset);\n    }\n\n    parent.objects.push(...receiver);\n    parent.isLeaf = true;\n    parent.childStart = QuadNode.NullNode;\n\n    leafs.add(parent.PoolIdx(nodePool));\n  }\n\n  public static Size(nodeIdx: number, nodePool: QuadNodePool): number {\n    const node = nodePool.At(nodeIdx);\n\n    if (node.IsLeaf) {\n      return node.objects.length;\n    } else {\n      let sum = 0;\n\n      for (let n = 0; n < QuadNode.ChildrenPerNode; ++n) {\n        sum += QuadNode.Size(node.childStart + n, nodePool);\n      }\n\n      return sum;\n    }\n  }\n\n  public static *ObjectIterator(node: QuadNode) {\n    for (const object of node.objects) {\n      yield object;\n    }\n  }\n\n  public static ConstructInPlace(\n    target: QuadNode,\n    args: {\n      boundary: Boundary;\n      parent?: number;\n      isLeaf?: boolean;\n      depth?: number;\n    }\n  ): QuadNode {\n    const fullArgs = {\n      parent: QuadNode.NullNode,\n      isLeaf: true,\n      depth: 1,\n      ...args\n    };\n\n    target.boundary.X = fullArgs.boundary.X;\n    target.boundary.Y = fullArgs.boundary.Y;\n    target.boundary.Width = fullArgs.boundary.Width;\n    target.boundary.Height = fullArgs.boundary.Height;\n\n    target.objects.splice(0);\n    target.parent = fullArgs.parent;\n    target.isLeaf = fullArgs.isLeaf;\n    target.depth = fullArgs.depth;\n    target.childStart = QuadNode.NullNode;\n\n    return target;\n  }\n}\n\nexport class QuadTreeCollisionEngine implements CollisionEngine {\n  public root: QuadNode;\n  private readonly leafs = new Set<number>();\n  private nodePool: QuadNodePool;\n\n  constructor(\n    private readonly boundary: Boundary,\n    private renderer: QuadTreeRenderer\n  ) {\n    this.nodePool = new QuadNodePool();\n    const fromPool = this.nodePool.Create();\n    QuadNode.ConstructInPlace(fromPool.node, { boundary: this.boundary });\n    this.root = fromPool.node;\n    this.leafs.add(fromPool.idx);\n\n    this.renderer.RootFetcher = () => this.root;\n    this.renderer.NodePoolFetcher = () => this.nodePool;\n  }\n\n  Add(object: Collider): boolean {\n    return this.root.Add(object, this.leafs, this.nodePool);\n  }\n\n  Remove(object: Collider): boolean {\n    return this.root.Remove(object, this.leafs, this.nodePool);\n  }\n\n  RecalculateBuckets(): void {\n    this.root.RecalculateBucket(this.root, this.leafs, this.nodePool);\n  }\n\n  ForEachCollided(handler: (a: Collider, b: Collider) => void): void {\n    this.leafs.forEach(leaf => {\n      const bodies = [...QuadNode.ObjectIterator(this.nodePool.At(leaf))];\n\n      for (let aIdx = 0; aIdx < bodies.length; ++aIdx) {\n        for (let bIdx = aIdx + 1; bIdx < bodies.length; ++bIdx) {\n          const a = bodies[aIdx];\n          const b = bodies[bIdx];\n\n          if (a.IsCollide(b)) {\n            handler(a, b);\n          }\n        }\n      }\n    });\n  }\n\n  Reset(): void {\n    this.leafs.clear();\n\n    this.nodePool = new QuadNodePool();\n    const fromPool = this.nodePool.Create();\n    QuadNode.ConstructInPlace(fromPool.node, { boundary: this.boundary });\n    this.root = fromPool.node;\n    this.leafs.add(fromPool.idx);\n  }\n\n  Draw(elapsed: number): void {\n    this.renderer.Draw(elapsed);\n  }\n}\n","import { BruteForceCollisionEngine } from './BruteForceCollisionEngine';\nimport { CollisionEngine } from './CollisionEngine';\nimport { QuadTreeCollisionEngine } from './QuadTreeCollisionEngine';\n\ninterface Constructor {\n  new (...args: any[]): any;\n}\n\ninterface Creator<TConstructor extends Constructor> {\n  constructor: TConstructor;\n  args?: () => ConstructorParameters<TConstructor>;\n}\n\ninterface Engines {\n  'quad-tree': Creator<typeof QuadTreeCollisionEngine>;\n  'brute-force': Creator<typeof BruteForceCollisionEngine>;\n}\n\nexport type SupportedCollisionEngine = keyof Engines;\n\ntype HasArguments<T extends Constructor> =\n  ConstructorParameters<T>['length'] extends 0 ? false : true;\n\ntype EnginesWithoutOptions = Pick<\n  Engines,\n  {\n    [Prop in keyof Engines]: HasArguments<\n      Engines[Prop]['constructor']\n    > extends true\n      ? Prop\n      : never;\n  }[keyof Engines]\n>;\n\ntype ArgsBuilder = {\n  [Prop in keyof EnginesWithoutOptions]: EnginesWithoutOptions[Prop]['args'];\n};\n\nexport class CollisionEngineFactory {\n  private readonly engines: Engines = {\n    'quad-tree': { constructor: QuadTreeCollisionEngine },\n    'brute-force': { constructor: BruteForceCollisionEngine }\n  };\n\n  constructor(argsBuilder: ArgsBuilder) {\n    for (const prop in argsBuilder) {\n      const engine = prop as keyof ArgsBuilder;\n      this.engines[engine].args = argsBuilder[engine];\n    }\n  }\n\n  Create(name: keyof Engines): CollisionEngine {\n    const engine = this.engines[name];\n\n    const ctor = engine.constructor as Constructor;\n    const args = engine.args;\n\n    if (args) {\n      return new ctor(...args());\n    } else {\n      return new ctor();\n    }\n  }\n}\n","export default \"#version 300 es\\n\\nprecision mediump float;\\n\\nuniform vec3 u_color;\\n\\nout vec4 outColor;\\n\\nvoid main() \\n{\\n    outColor = vec4(u_color, 1);\\n}\\n\"","import { Dimension } from '@/lib/misc/Primitives';\nimport { Camera2 } from '@/lib/render/Camera';\n\nexport enum AppEvent {\n  ResizeView = 0,\n  CameraMove,\n  TogglePause\n}\n\nexport interface AppEventSet {\n  [AppEvent.ResizeView]: Dimension;\n  [AppEvent.CameraMove]: Camera2;\n  [AppEvent.TogglePause]: boolean;\n}\n","export enum AvailableInteractionTool {\n  Pan = 0,\n  Selection\n}\n\nexport interface InteractionTool {\n  get Type(): AvailableInteractionTool;\n\n  OnMouseDown(e: MouseEvent): void;\n\n  OnMouseUp(e: MouseEvent): void;\n\n  OnKeyDown(e: KeyboardEvent): void;\n\n  OnMouseMove(e: MouseEvent): void;\n\n  OnWheel(e: WheelEvent): void;\n\n  OnTouchMove(e: TouchEvent): void;\n\n  OnTouchStart(e: TouchEvent): void;\n\n  OnTouchEnd(e: TouchEvent): void;\n\n  Draw(elapsed: number): void;\n\n  Dispose(): void;\n}\n","import { Intersection } from '../math/Intersection';\nimport { EventBus, EventBusObserver } from '../misc/EventBus';\nimport { Circle } from '../misc/Primitives';\n\ntype TouchSlice = Pick<Touch, 'pageX' | 'pageY' | 'radiusX'>;\n\ninterface TouchTrace {\n  timestamp: number;\n  touch: TouchSlice;\n}\n\nexport enum TouchDoubleTapEventBus {\n  DoubleTap = 0\n}\n\ninterface TouchDoubleTapEventBusSet {\n  [TouchDoubleTapEventBus.DoubleTap]: Touch;\n}\n\nexport class TouchDoubleTap {\n  private readonly prev: TouchTrace[] = [];\n\n  private broadcaster = new EventBus<\n    TouchDoubleTapEventBusSet,\n    typeof TouchDoubleTapEventBus\n  >(TouchDoubleTapEventBus);\n\n  public OnTouchStart(e: TouchEvent): void {\n    const Timeout = 200;\n\n    [...e.changedTouches].forEach(touch => {\n      const Radius = touch.radiusX > 0 ? touch.radiusX : 15;\n\n      const touchCircle: Circle = {\n        Center: { X: touch.pageX, Y: touch.pageY },\n        Radius: touch.radiusX\n      };\n\n      let add = true;\n      for (let n = 0, step = 1; n < this.prev.length; n += step) {\n        const prev = this.prev[n];\n\n        const prevCircle: Circle = {\n          Center: { X: prev.touch.pageX, Y: prev.touch.pageY },\n          Radius\n        };\n\n        if (Date.now() - prev.timestamp >= Timeout) {\n          step = 0;\n\n          this.prev.splice(n, 1);\n        } else if (Intersection.CircleCircle(touchCircle, prevCircle)) {\n          add = false;\n          step = 0;\n\n          this.prev.splice(n, 1);\n\n          this.Notify(touch);\n        } else {\n          step = 1;\n        }\n      }\n\n      if (add) {\n        const copy: TouchSlice = {\n          pageX: touch.pageX,\n          pageY: touch.pageY,\n          radiusX: Radius\n        };\n        this.prev.push({ timestamp: Date.now(), touch: copy });\n      }\n    });\n  }\n\n  public get Observer(): EventBusObserver<TouchDoubleTapEventBusSet> {\n    return this.broadcaster;\n  }\n\n  private Notify(e: Touch): void {\n    this.broadcaster.Publish(TouchDoubleTapEventBus.DoubleTap, e);\n  }\n}\n","import { EventBus, Unsubscription } from '../misc/EventBus';\n\ninterface TouchPanTrace {\n  id: number;\n  x: number;\n  y: number;\n}\n\nexport interface TouchPanEvent {\n  dx: number;\n  dy: number;\n}\n\ntype Handler = (e: TouchPanEvent) => void;\n\nenum TouchPanEventBus {\n  Pan = 0\n}\n\ninterface TouchPanEventBusSet {\n  [TouchPanEventBus.Pan]: TouchPanEvent;\n}\n\nexport class TouchPan {\n  private broadcaster = new EventBus<\n    TouchPanEventBusSet,\n    typeof TouchPanEventBus\n  >(TouchPanEventBus);\n  private prev!: TouchPanTrace;\n\n  public OnTouchStart(e: TouchEvent): void {\n    const touch = e.targetTouches[0];\n    this.prev = {\n      id: touch.identifier,\n      x: touch.pageX,\n      y: touch.pageY\n    };\n  }\n\n  public OnTouchMove(e: TouchEvent): void {\n    if (e.targetTouches.item(0)?.identifier !== this.prev.id) {\n      return;\n    }\n\n    const touch = e.targetTouches[0];\n\n    this.Notify({\n      dx: touch.pageX - this.prev.x,\n      dy: touch.pageY - this.prev.y\n    });\n\n    this.prev.x = touch.pageX;\n    this.prev.y = touch.pageY;\n  }\n\n  public Subscribe(handle: Handler): Unsubscription {\n    return this.broadcaster.Subscribe(TouchPanEventBus.Pan, handle);\n  }\n\n  private Notify(e: TouchPanEvent): void {\n    this.broadcaster.Publish(TouchPanEventBus.Pan, e);\n  }\n}\n","import { Point } from '../math/Point';\nimport { EventBus, EventBusObserver } from '../misc/EventBus';\n\nexport type TouchZoomEvent = number; // Positive for zoom-out\n\ninterface TouchZoomTrace {\n  Id: number;\n  X: number;\n  Y: number;\n}\n\nexport enum TouchZoomEventBus {\n  ZoomStart = 0,\n  Zoom\n}\n\ninterface TouchZoomEventBusSet {\n  [TouchZoomEventBus.ZoomStart]: void;\n  [TouchZoomEventBus.Zoom]: TouchZoomEvent;\n}\n\nexport class TouchZoom {\n  private broadcaster = new EventBus<\n    TouchZoomEventBusSet,\n    typeof TouchZoomEventBus\n  >(TouchZoomEventBus);\n\n  private readonly prev: TouchZoomTrace[] = [\n    { Id: -1, X: 0, Y: 0 },\n    { Id: -1, X: 0, Y: 0 }\n  ];\n\n  public OnTouchStart(e: TouchEvent): void {\n    if (e.targetTouches.length !== 2) {\n      return;\n    }\n\n    this.broadcaster.Publish(TouchZoomEventBus.ZoomStart);\n\n    this.UpdateTrace(e);\n  }\n\n  public OnTouchEnd(e: TouchEvent): void {\n    [...e.targetTouches].forEach(touch => {\n      const prevTouch = this.prev.find(x => x.Id === touch.identifier);\n\n      if (prevTouch) {\n        prevTouch.Id = -1;\n      }\n    });\n  }\n\n  public OnTouchMove(e: TouchEvent): void {\n    if (\n      e.targetTouches.length !== 2 ||\n      !this.prev.every(trace => trace.Id !== -1)\n    ) {\n      return;\n    }\n\n    e.preventDefault();\n\n    const [p0, p1] = (\n      e.targetTouches[0].identifier === this.prev[0].Id\n        ? [e.targetTouches[0], e.targetTouches[1]]\n        : [e.targetTouches[1], e.targetTouches[0]]\n    ).map(touch => ({ X: touch.pageX, Y: touch.pageY }));\n\n    const dist0 = Point.Distance(this.prev[0], this.prev[1]);\n    const dist1 = Point.Distance(p0, p1);\n\n    this.Notify(dist1 / dist0);\n  }\n\n  public get Observer(): EventBusObserver<TouchZoomEventBusSet> {\n    return this.broadcaster;\n  }\n\n  private Notify(e: TouchZoomEvent): void {\n    this.broadcaster.Publish(TouchZoomEventBus.Zoom, e);\n  }\n\n  private UpdateTrace(e: TouchEvent): void {\n    for (let n = 0; n < e.targetTouches.length; ++n) {\n      this.prev[n].Id = e.targetTouches[n].identifier;\n      this.prev[n].X = e.targetTouches[n].pageX;\n      this.prev[n].Y = e.targetTouches[n].pageY;\n    }\n  }\n}\n","export enum MouseButtons {\n  Nope = 0,\n  Left = 1,\n  Right = 2,\n  Wheel = 4,\n  BrowserBack = 8,\n  BrowserForward = 16\n}\n\nexport enum MouseButton {\n  Left = 0,\n  Wheel = 1,\n  Right = 2,\n  BrowserBack = 3,\n  BrowserForward = 4\n}\n","export default \"#version 300 es\\nprecision mediump float;\\n\\nin vec2 a_vertex;\\n\\nuniform vec3 u_cam;\\nuniform vec2 u_resolution;\\n\\nout vec3 color;\\n\\nvoid main() \\n{\\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\\n}\\n\"","import { QuadNode, QuadNodePool } from '../QuadTreeCollisionEngine';\n\nimport { EngineRenderer } from './EngineRenderer';\nimport FQuadTreeNode from './QuadTreeNode.frag';\nimport VQuadTreeNode from './QuadTreeNode.vert';\n\nimport { NotNull } from '@/lib/misc/NotNull';\nimport { RVec2, RVec3 } from '@/lib/render/Primitives';\nimport { ShaderProgram } from '@/lib/render/ShaderProgram';\n\nexport class QuadTreeRenderer implements EngineRenderer {\n  private nodesVbo!: WebGLBuffer;\n  private nodesVao!: WebGLVertexArrayObject;\n  private nodesShader!: ShaderProgram;\n  private nodesAttributes!: Float32Array;\n\n  private colorConfig = {\n    default: [0.5, 0.5, 0.5]\n  };\n\n  public RootFetcher!: () => QuadNode;\n\n  public NodePoolFetcher!: () => QuadNodePool;\n\n  constructor(private gl: WebGL2RenderingContext) {\n    this.Setup();\n  }\n\n  ResizeView(resolution: RVec2): void {\n    this.nodesShader.SetUniform2fv('u_resolution', resolution);\n  }\n\n  Camera(camera: RVec3): void {\n    this.nodesShader.SetUniform3fv('u_cam', camera);\n  }\n\n  Draw(_elapsed: number): void {\n    const attributes: number[] = [];\n    this.CollectNodeBounds(this.Root, attributes);\n    this.nodesAttributes = new Float32Array(attributes);\n\n    this.nodesShader.Use();\n\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.nodesVbo);\n    this.gl.bufferData(\n      this.gl.ARRAY_BUFFER,\n      this.nodesAttributes,\n      this.gl.DYNAMIC_DRAW\n    );\n\n    this.gl.bindVertexArray(this.nodesVao);\n    this.gl.drawArrays(this.gl.LINES, 0, this.nodesAttributes.length / 2);\n  }\n\n  private CollectNodeBounds(node: QuadNode, receiver: number[]) {\n    if (!node.HasChild) {\n      return;\n    }\n\n    const halfWidth = node.boundary.Width / 2;\n    const halfHeight = node.boundary.Height / 2;\n\n    receiver.push(node.boundary.X + halfWidth, node.boundary.Y);\n    receiver.push(node.boundary.X + halfWidth, node.boundary.Top);\n\n    receiver.push(node.boundary.X, node.boundary.Y + halfHeight);\n    receiver.push(node.boundary.Right, node.boundary.Y + halfHeight);\n\n    node.ForEachChild(\n      node => this.CollectNodeBounds(node, receiver),\n      this.NodePoolFetcher()\n    );\n  }\n\n  private Setup(): void {\n    this.nodesVbo = this.gl.createBuffer() ?? NotNull();\n    this.nodesVao = this.gl.createVertexArray() ?? NotNull();\n\n    this.nodesShader = new ShaderProgram(this.gl);\n    this.nodesShader.Attach(this.gl.FRAGMENT_SHADER, FQuadTreeNode);\n    this.nodesShader.Attach(this.gl.VERTEX_SHADER, VQuadTreeNode);\n    this.nodesShader.Link();\n    this.nodesShader.Use();\n\n    const FloatSize = Float32Array.BYTES_PER_ELEMENT;\n    const ComponentsCount = 2;\n\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.nodesVbo);\n\n    this.gl.bindVertexArray(this.nodesVao);\n\n    const posLoc = this.nodesShader.GetAttributeLocation('a_vertex');\n    this.gl.enableVertexAttribArray(posLoc);\n    this.gl.vertexAttribPointer(\n      posLoc,\n      2,\n      this.gl.FLOAT,\n      false,\n      FloatSize * ComponentsCount,\n      0\n    );\n\n    this.gl.bindVertexArray(null);\n\n    this.nodesShader.SetUniform3fv('u_color', this.colorConfig.default);\n  }\n\n  private get Root(): QuadNode {\n    return this.RootFetcher();\n  }\n}\n","import { Collider } from './Collider';\n\nimport { Point } from '@/lib/math/Point';\n\nexport class XY {\n  constructor(public readonly X: number, public readonly Y: number) {}\n\n  Distance(p: XY): number {\n    return Point.Distance({ X: this.X, Y: this.Y }, p);\n  }\n}\n\nexport interface CollisionEngine {\n  // Returns true if added\n  Add(object: Collider): boolean;\n\n  // Returns true if found\n  Remove(object: Collider): boolean;\n\n  RecalculateBuckets(): void;\n\n  ForEachCollided(handler: (a: Collider, b: Collider) => void): void;\n\n  Reset(): void;\n\n  Draw(elapsed: number): void;\n}\n","export class MathUtil {\n  public static Clamp(value: number, min: number, max: number): number {\n    return Math.max(min, Math.min(value, max));\n  }\n}\n","import { App } from '../../App';\n\nimport { MathUtil } from '@/lib/math/MathUtil';\n\nexport class ZoomDefault {\n  private readonly min = 0.5;\n  private readonly max = 10;\n\n  constructor(private readonly app: App) {}\n\n  public Relative(value: number): void {\n    const dir = -value / Math.abs(value);\n    const zoom = this.app.Camera.Zoom;\n    const step = dir * (dir > 0 ? 0.1 : 0.2);\n\n    this.app.Camera = { Zoom: MathUtil.Clamp(zoom + step, this.min, this.max) };\n  }\n\n  public Absolute(value: number): void {\n    this.app.Camera = { Zoom: MathUtil.Clamp(value, this.min, this.max) };\n  }\n}\n","import { EnumSize } from './EnumSize';\n\ntype EventEnum = {\n  [id: number]: any;\n};\n\ntype SubHandler<TPayload extends any[]> = (...payload: TPayload) => void;\n\nexport type Unsubscription = () => void;\n\nclass Observer<TListener extends SubHandler<any>> {\n  private readonly listeners: TListener[] = [];\n\n  public Publish(...payload: TListener[]): void {\n    this.listeners.forEach(fn => fn(...payload));\n  }\n\n  public Subscribe(handler: TListener): Unsubscription {\n    if (!this.listeners.includes(handler)) {\n      this.listeners.push(handler);\n    }\n\n    return () => this.listeners.splice(this.listeners.indexOf(handler), 1);\n  }\n}\n\ntype EmptyIfVoid<T> = T extends void ? [] : [T];\n\nexport interface EventBusObserver<TEventSet> {\n  Subscribe<TEvent extends keyof TEventSet & number>(\n    event: TEvent,\n    handler: SubHandler<[TEventSet[TEvent]]>\n  ): Unsubscription;\n}\n\nexport class EventBus<TEventSet, TEventEnum extends EventEnum>\n  implements EventBusObserver<TEventSet>\n{\n  private readonly observers: Observer<any>[];\n\n  constructor(eventSet: TEventEnum) {\n    this.observers = Array.from(\n      { length: EnumSize(eventSet) },\n      () => new Observer()\n    );\n  }\n\n  public Publish<TEvent extends keyof TEventSet & number>(\n    event: TEvent,\n    ...payload: EmptyIfVoid<TEventSet[TEvent]>\n  ): void {\n    this.observers[event].Publish(...payload);\n  }\n\n  public Subscribe<TEvent extends keyof TEventSet & number>(\n    event: TEvent,\n    handler: SubHandler<[TEventSet[TEvent]]>\n  ): Unsubscription {\n    return this.observers[event].Subscribe(handler);\n  }\n\n  public Reset(): void {\n    for (let n = 0; n < this.observers.length; ++n) {\n      this.observers[n] = new Observer();\n    }\n  }\n}\n","import { XY } from '../collision_engines/CollisionEngine';\n\nimport { App } from './../App';\nimport { ZoomDefault } from './artifacts/ZoomDefault';\nimport { AvailableInteractionTool, InteractionTool } from './InteractionTool';\n\nimport {\n  TouchDoubleTap,\n  TouchDoubleTapEventBus\n} from '@/lib/Dom/TouchDoubleTap';\nimport { TouchPan, TouchPanEvent } from '@/lib/Dom/TouchPan';\nimport {\n  TouchZoom,\n  TouchZoomEvent,\n  TouchZoomEventBus\n} from '@/lib/Dom/TouchZoom';\nimport { MouseButton, MouseButtons } from '@/lib/misc/Dom';\nimport { Unsubscription } from '@/lib/misc/EventBus';\n\nexport class PanTool implements InteractionTool {\n  private lmbDownPosition!: XY;\n\n  private zoom: ZoomDefault;\n\n  private touchMovement = new TouchPan();\n  private touchZoom = new TouchZoom();\n  private touchDoubleTap = new TouchDoubleTap();\n  private unsubs: Unsubscription[] = [];\n\n  private initialZoom = 0;\n\n  constructor(\n    private readonly gl: WebGL2RenderingContext,\n    private readonly app: App\n  ) {\n    this.zoom = new ZoomDefault(this.app);\n    this.unsubs.push(\n      this.touchMovement.Subscribe(e => this.TouchMovement(e))\n    );\n\n    this.touchZoom.Observer.Subscribe(\n      TouchZoomEventBus.ZoomStart,\n      () => (this.initialZoom = this.app.Camera.Zoom)\n    );\n    this.unsubs.push(\n      this.touchZoom.Observer.Subscribe(TouchZoomEventBus.Zoom, e =>\n        this.TouchZoom(e)\n      )\n    );\n\n    this.unsubs.push(\n      this.touchDoubleTap.Observer.Subscribe(\n        TouchDoubleTapEventBus.DoubleTap,\n        e => this.TouchDoubleTap(e)\n      )\n    );\n  }\n\n  public get Type(): AvailableInteractionTool {\n    return AvailableInteractionTool.Pan;\n  }\n\n  public OnMouseDown(e: MouseEvent): void {\n    this.lmbDownPosition = new XY(e.offsetX, e.offsetY);\n  }\n\n  public OnMouseUp(e: MouseEvent): void {\n    if (e.button === MouseButton.Left) {\n      if (this.lmbDownPosition.Distance(new XY(e.offsetX, e.offsetY)) < 2) {\n        this.app.SelectBody(e.offsetX, e.offsetY);\n      }\n    }\n  }\n\n  public OnKeyDown(e: KeyboardEvent): void {\n    switch (e.code) {\n      case 'Space':\n        this.app.Pause = !this.app.Pause;\n        break;\n    }\n  }\n\n  public OnMouseMove(e: MouseEvent): void {\n    if (e.buttons & MouseButtons.Left) {\n      this.MoveCamera(e.movementX, e.movementY);\n    }\n  }\n\n  public OnWheel(e: WheelEvent): void {\n    this.zoom.Relative(e.deltaY);\n  }\n\n  public OnTouchMove(e: TouchEvent): void {\n    this.touchMovement.OnTouchMove(e);\n    this.touchZoom.OnTouchMove(e);\n  }\n\n  public OnTouchStart(e: TouchEvent): void {\n    this.touchMovement.OnTouchStart(e);\n    this.touchZoom.OnTouchStart(e);\n    this.touchDoubleTap.OnTouchStart(e);\n  }\n\n  public OnTouchEnd(e: TouchEvent): void {\n    this.touchZoom.OnTouchEnd(e);\n  }\n\n  public Draw(_elapsed: number): void {}\n\n  public Dispose(): void {\n    this.unsubs.forEach(unsub => unsub());\n  }\n\n  private MoveCamera(dx: number, dy: number) {\n    const zoom = this.app.Camera.Zoom;\n\n    this.app.Camera = {\n      X: this.app.Camera.X + dx / zoom,\n      Y: this.app.Camera.Y + dy / zoom\n    };\n  }\n\n  private TouchMovement(e: TouchPanEvent): void {\n    this.MoveCamera(e.dx, e.dy);\n  }\n\n  private TouchZoom(zoom: TouchZoomEvent): void {\n    this.zoom.Absolute(this.initialZoom * zoom);\n  }\n\n  private TouchDoubleTap(_e: Touch): void {\n    this.app.Pause = !this.app.Pause;\n  }\n}\n","export default \"#version 300 es\\n\\nprecision mediump float;\\n\\nin vec4 color;\\nout vec4 outColor;\\n\\nvoid main() \\n{\\n    outColor = color;\\n}\\n\"","export interface Vec2 {\n  X: number;\n  Y: number;\n}\n\nexport interface Vec3 extends Vec2 {\n  Z: number;\n}\n\nexport interface Color {\n  R: number;\n  G: number;\n  B: number;\n}\n\nexport enum RgbComponent {\n  R = 0,\n  G,\n  B\n}\n\nexport interface Rgb {\n  [RgbComponent.R]: number;\n  [RgbComponent.G]: number;\n  [RgbComponent.B]: number;\n  [Symbol.iterator](): IterableIterator<number>;\n}\n\nexport enum RgbaComponent {\n  R = 0,\n  G,\n  B,\n  A\n}\n\nexport interface Rgba {\n  [RgbaComponent.R]: number;\n  [RgbaComponent.G]: number;\n  [RgbaComponent.B]: number;\n  [RgbaComponent.A]: number;\n  [Symbol.iterator](): IterableIterator<number>;\n}\n\nexport interface Dimension {\n  Width: number;\n  Height: number;\n}\n\nexport interface AABBRectangle {\n  X: number;\n  Y: number;\n  Width: number;\n  Height: number;\n}\n\nexport interface Rectangle {\n  Center: Vec2;\n  Dimension: Dimension;\n  Angle: number;\n}\n\nexport interface Line {\n  A: Vec2;\n  B: Vec2;\n}\n\nexport interface Circle {\n  Center: Vec2;\n  Radius: number;\n}\n","export interface Vec3 {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport class Camera {\n  protected position: Vec3 = { x: 0, y: 0, z: 0 };\n  protected target: Vec3 = { x: 0, y: 0, z: 0 };\n}\n\nexport interface Camera2 {\n  X: number;\n  Y: number;\n  Zoom: number;\n}\n\nexport enum Camera2Component {\n  X = 0,\n  Y,\n  Zoom\n}\n","export type RVec2 = [number, number];\nexport type RVec3 = [number, number, number];\nexport type RVec4 = [number, number, number, number];\n\nexport type RMat3 = [RVec3, RVec3, RVec3];\n\nexport enum RVec2Component {\n  X = 0,\n  Y\n}\n","export default \"#version 300 es\\nprecision mediump float;\\n\\nin vec2 a_vertex;\\nin vec4 a_color;\\n\\nuniform vec3 u_cam;\\nuniform vec2 u_resolution;\\n\\nout vec4 color;\\n\\nvoid main() \\n{\\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\\n  color = a_color;\\n}\\n\"","import { App } from '../../App';\nimport { AppEvent } from '../../Events';\nimport { ZoomDefault } from '../artifacts/ZoomDefault';\nimport { AvailableInteractionTool, InteractionTool } from '../InteractionTool';\n\nimport FSelectionRectangle from './SelectionRectangle.frag';\nimport VSelectionRectangle from './SelectionRectangle.vert';\n\nimport { Point } from '@/lib/math/Point';\nimport { EnumSize } from '@/lib/misc/EnumSize';\nimport { Unsubscription } from '@/lib/misc/EventBus';\nimport {\n  Dimension,\n  AABBRectangle,\n  Rgba,\n  RgbaComponent,\n  Vec2\n} from '@/lib/misc/Primitives';\nimport { Camera2Component } from '@/lib/render/Camera';\nimport { PrimitiveBuilder } from '@/lib/render/PrimitiveBuilder';\nimport { RVec2, RVec2Component, RVec3 } from '@/lib/render/Primitives';\nimport { PrimitivesRenderer } from '@/lib/render/PrimitivesRenderer';\nimport { TypeSizeResolver } from '@/lib/render/TypeSizeResolver';\n\nexport class SelectionTool\n  extends PrimitivesRenderer\n  implements InteractionTool\n{\n  public static readonly ComponentsPerIndex =\n    EnumSize(RVec2Component) + EnumSize(RgbaComponent);\n\n  private baseDraw = () => {};\n\n  private viewDimension: RVec2 = [800, 600];\n  private camera: RVec3 = [0, 0, 1];\n\n  private selectionStart!: Vec2;\n  private selectionRect: AABBRectangle | null = null;\n\n  private zoom: ZoomDefault;\n\n  private eventBusUnsubs!: Unsubscription[];\n\n  constructor(gl: WebGL2RenderingContext, private readonly app: App) {\n    const floatSize = TypeSizeResolver.Resolve(gl.FLOAT);\n    const stride = floatSize * SelectionTool.ComponentsPerIndex;\n\n    super(\n      gl,\n      { vertex: VSelectionRectangle, fragment: FSelectionRectangle },\n      [\n        {\n          name: 'a_vertex',\n          size: 2,\n          type: gl.FLOAT,\n          normalized: false,\n          stride,\n          offset: 0\n        },\n        {\n          name: 'a_color',\n          size: 4,\n          type: gl.FLOAT,\n          normalized: false,\n          stride,\n          offset: 2 * floatSize\n        }\n      ],\n      { indicesPerPrimitive: 6, basePrimitiveType: gl.TRIANGLES }\n    );\n\n    this.zoom = new ZoomDefault(this.app);\n\n    this.SetupListeners();\n\n    this.ResizeView(this.app.ViewDimension);\n\n    const cam = this.app.Camera;\n    this.Camera([cam.X, cam.Y, cam.Zoom]);\n  }\n\n  public get Type(): AvailableInteractionTool {\n    return AvailableInteractionTool.Selection;\n  }\n\n  public ResizeView(size: Dimension): void {\n    this.viewDimension = [size.Width, size.Height];\n\n    this.shader.SetUniform2fv('u_resolution', this.viewDimension);\n  }\n\n  public Camera(camera: RVec3): void {\n    this.camera = [...camera];\n\n    this.shader.SetUniform3fv('u_cam', this.camera);\n  }\n\n  OnMouseDown(e: MouseEvent): void {\n    this.selectionStart = this.app.ScreenToWorld(e.offsetX, e.offsetY);\n  }\n\n  OnMouseUp(_e: MouseEvent): void {\n    if (this.selectionRect !== null) {\n      this.app.SelectBodies(this.selectionRect);\n    }\n  }\n\n  OnKeyDown(_e: KeyboardEvent): void {\n    // Nothing to do\n  }\n\n  OnMouseMove(e: MouseEvent): void {\n    const selectionEnd = this.app.ScreenToWorld(e.offsetX, e.offsetY);\n\n    const rect = Point.Extremum2([this.selectionStart, selectionEnd]);\n\n    this.selectionRect = {\n      X: rect.min.X,\n      Y: rect.min.Y,\n      Width: rect.max.X - rect.min.X,\n      Height: rect.max.Y - rect.min.Y\n    };\n\n    const innerRegion = PrimitiveBuilder.AABBColorRectangle(\n      {\n        ...rect.min,\n        Width: this.selectionRect.Width,\n        Height: this.selectionRect.Height\n      },\n      [0.3764705882352941, 0.49019607843137253, 0.5450980392156862, 0.65]\n    );\n\n    const borderWidth = 1 / this.camera[Camera2Component.Zoom];\n    const borderColor: Rgba = [0.47, 0.56, 0.61, 1];\n    const borderTop = PrimitiveBuilder.AABBColorRectangle(\n      {\n        X: rect.min.X - borderWidth,\n        Y: rect.max.Y,\n        Width: this.selectionRect.Width + 2 * borderWidth,\n        Height: borderWidth\n      },\n      borderColor\n    );\n\n    const borderRight = PrimitiveBuilder.AABBColorRectangle(\n      {\n        X: rect.max.X,\n        Y: rect.min.Y,\n        Width: borderWidth,\n        Height: this.selectionRect.Height\n      },\n      borderColor\n    );\n\n    const borderBottom = PrimitiveBuilder.AABBColorRectangle(\n      {\n        X: rect.min.X - borderWidth,\n        Y: rect.min.Y - borderWidth,\n        Width: this.selectionRect.Width + 2 * borderWidth,\n        Height: borderWidth\n      },\n      borderColor\n    );\n\n    const borderLeft = PrimitiveBuilder.AABBColorRectangle(\n      {\n        X: rect.min.X - borderWidth,\n        Y: rect.min.Y,\n        Width: borderWidth,\n        Height: this.selectionRect.Height\n      },\n      borderColor\n    );\n\n    this.UploadAttributes([\n      ...innerRegion,\n      ...borderTop,\n      ...borderRight,\n      ...borderBottom,\n      ...borderLeft\n    ]);\n\n    this.baseDraw = super.Draw;\n  }\n\n  OnWheel(e: WheelEvent): void {\n    this.zoom.Relative(e.deltaY);\n  }\n\n  public OnTouchMove(_e: TouchEvent): void {}\n\n  public OnTouchStart(_e: TouchEvent): void {}\n\n  public OnTouchEnd(_e: TouchEvent): void {}\n\n  Draw(): void {\n    this.baseDraw();\n  }\n\n  private SetupListeners(): void {\n    const resizeUnsub = App.EventBus.Subscribe(AppEvent.ResizeView, dim =>\n      this.ResizeView(dim)\n    );\n    const camMoveUnsub = App.EventBus.Subscribe(AppEvent.CameraMove, cam =>\n      this.Camera([cam.X, cam.Y, cam.Zoom])\n    );\n\n    this.eventBusUnsubs = [resizeUnsub, camMoveUnsub];\n  }\n\n  public Dispose(): void {\n    this.eventBusUnsubs.forEach(unsub => unsub());\n  }\n}\n","export function RandomFloat(min: number, max: number): number {\n  return Math.random() * (max - min) + min;\n}\n","export default \"#version 300 es\\n\\nprecision mediump float;\\n\\nin vec3 circleColor;\\n\\nuniform float u_radius;\\n\\nout vec4 outColor;\\n\\nvoid main() \\n{\\n  if (distance(gl_PointCoord.xy, vec2(0.5)) > 0.5) {\\n    discard;\\n  } else {\\n    outColor = vec4(circleColor.xyz, 1);\\n  }\\n}\\n\"","import { PrimitivesRenderer } from '../PrimitivesRenderer';\nimport { TypeSizeResolver } from '../TypeSizeResolver';\n\nimport FCircle from './circle.frag';\nimport VCircle from './circle.vert';\n\nimport { EnumSize } from '@/lib/misc/EnumSize';\nimport { Dimension } from '@/lib/misc/Primitives';\nimport { RVec2, RVec3 } from '@/lib/render/Primitives';\n\nenum CircleComponent {\n  X = 0,\n  Y,\n  R,\n  G,\n  B\n}\n\nexport class CircleRenderer extends PrimitivesRenderer {\n  public static ComponentsPerIndex = EnumSize(CircleComponent);\n\n  private viewDimension: RVec2 = [800, 600];\n  private camera: RVec3 = [0, 0, 1];\n  private bodyRadius = 5;\n\n  constructor(gl: WebGL2RenderingContext) {\n    const floatSize = TypeSizeResolver.Resolve(gl.FLOAT);\n    const stride = floatSize * CircleRenderer.ComponentsPerIndex;\n\n    super(\n      gl,\n      { vertex: VCircle, fragment: FCircle },\n      [\n        {\n          name: 'a_vertex',\n          size: 2,\n          type: gl.FLOAT,\n          normalized: false,\n          stride,\n          offset: 0\n        },\n        {\n          name: 'a_color',\n          size: 3,\n          type: gl.FLOAT,\n          normalized: false,\n          stride,\n          offset: 2 * floatSize\n        }\n      ],\n      { indicesPerPrimitive: 1, basePrimitiveType: gl.POINTS }\n    );\n\n    this.InitializeUniforms();\n  }\n\n  public ResizeView(size: Dimension): void {\n    this.viewDimension = [size.Width, size.Height];\n\n    this.shader.SetUniform2fv('u_resolution', this.viewDimension);\n  }\n\n  public Camera(camera: RVec3): void {\n    this.camera = [...camera];\n\n    this.shader.SetUniform3fv('u_cam', this.camera);\n  }\n\n  public Radius(radius: number): void {\n    this.bodyRadius = radius;\n    this.shader.SetUniform1f('u_radius', this.bodyRadius);\n  }\n\n  private InitializeUniforms(): void {\n    this.shader.SetUniform3fv('u_cam', this.camera);\n    this.shader.SetUniform1f('u_radius', this.bodyRadius);\n    this.shader.SetUniform2fv('u_resolution', this.viewDimension);\n  }\n}\n","export default \"#version 300 es\\nprecision mediump float;\\n\\nin vec2 a_vertex;\\nin vec3 a_color;\\n\\nuniform vec3 u_cam;\\nuniform float u_radius;\\nuniform vec2 u_resolution;\\n\\nout vec3 circleColor;\\n\\nvoid main() \\n{\\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\\n  circleColor = a_color;\\n  gl_PointSize = u_radius * 2.f * u_cam.z;\\n}\\n\"","export default \"#version 300 es\\n\\nprecision mediump float;\\n\\nin vec3 rectangleColor;\\n\\nout vec4 outColor;\\n\\nvoid main() \\n{\\n  outColor = vec4(rectangleColor.xyz, 1);\\n}\\n\"","import { PrimitivesRenderer } from '../PrimitivesRenderer';\nimport { TypeSizeResolver } from '../TypeSizeResolver';\n\nimport FRectangle from './rectangle.frag';\nimport VRectangle from './rectangle.vert';\n\nimport { EnumSize } from '@/lib/misc/EnumSize';\nimport { Dimension } from '@/lib/misc/Primitives';\nimport { RVec2, RVec3 } from '@/lib/render/Primitives';\n\nenum RectangleComponent {\n  X = 0,\n  Y,\n  R,\n  G,\n  B\n}\n\nexport class RectangleRenderer extends PrimitivesRenderer {\n  public static ComponentsPerIndex = EnumSize(RectangleComponent);\n\n  private viewDimension: RVec2 = [800, 600];\n  private camera: RVec3 = [0, 0, 1];\n\n  constructor(gl: WebGL2RenderingContext) {\n    const floatSize = TypeSizeResolver.Resolve(gl.FLOAT);\n    const stride = floatSize * RectangleRenderer.ComponentsPerIndex;\n\n    super(\n      gl,\n      { vertex: VRectangle, fragment: FRectangle },\n      [\n        {\n          name: 'a_vertex',\n          size: 2,\n          type: gl.FLOAT,\n          normalized: false,\n          stride,\n          offset: 0\n        },\n        {\n          name: 'a_color',\n          size: 3,\n          type: gl.FLOAT,\n          normalized: false,\n          stride,\n          offset: 2 * floatSize\n        }\n      ],\n      { indicesPerPrimitive: 6, basePrimitiveType: gl.TRIANGLES }\n    );\n\n    this.InitializeUniforms();\n  }\n\n  public ResizeView(size: Dimension): void {\n    this.viewDimension = [size.Width, size.Height];\n\n    this.shader.SetUniform2fv('u_resolution', this.viewDimension);\n  }\n\n  public Camera(camera: RVec3): void {\n    this.camera = [...camera];\n\n    this.shader.SetUniform3fv('u_cam', this.camera);\n  }\n\n  private InitializeUniforms(): void {\n    this.shader.SetUniform3fv('u_cam', this.camera);\n    this.shader.SetUniform2fv('u_resolution', this.viewDimension);\n  }\n}\n","import { Body } from './bodies/Body';\nimport { CircleBody } from './bodies/kinds/circle/CircleBody';\nimport { StaticRectangleBody } from './bodies/kinds/rectangle/StaticRectangleBody';\nimport { BorderRenderer } from './border/BorderRenderer';\nimport { CollisionEngine } from './collision_engines/CollisionEngine';\nimport {\n  CollisionEngineFactory,\n  SupportedCollisionEngine\n} from './collision_engines/CollisionEngineFactory';\nimport { Boundary } from './collision_engines/QuadTreeCollisionEngine';\nimport { EngineRenderer } from './collision_engines/renderers/EngineRenderer';\nimport { QuadTreeRenderer } from './collision_engines/renderers/QuadTreeRenderer';\nimport { AppEvent, AppEventSet } from './Events';\nimport {\n  AvailableInteractionTool,\n  InteractionTool\n} from './tools/InteractionTool';\nimport { PanTool } from './tools/PanTool';\nimport { SelectionTool } from './tools/SelectionTool/SelectionTool';\n\nimport { MouseButton } from '@/lib/misc/Dom';\nimport { EventBus } from '@/lib/misc/EventBus';\nimport {\n  Color,\n  Dimension,\n  AABBRectangle,\n  Rectangle\n} from '@/lib/misc/Primitives';\nimport { RandomFloat } from '@/lib/misc/RandomFloat';\nimport { Camera2, Camera2Component } from '@/lib/render/Camera';\nimport { CircleRenderer } from '@/lib/render/circle/CircleRenderer';\nimport { PrimitiveBuilder } from '@/lib/render/PrimitiveBuilder';\nimport { RVec2, RVec3 } from '@/lib/render/Primitives';\nimport { RectangleRenderer } from '@/lib/render/rectangle/RectangleRenderer';\n\ntype UpdatedCameraComponent = Partial<Camera2>;\n\nenum ResolutionComponent {\n  Width = 0,\n  Height\n}\n\ninterface SelectedBodyState {\n  target: Body;\n  color: Color;\n}\n\nexport class App {\n  public static EventBus = new EventBus<AppEventSet, typeof AppEvent>(AppEvent);\n\n  private bodies!: Body[];\n  // [x, y, zoom]\n  private readonly camera: RVec3 = [0, 0, 1];\n\n  private fieldDimension: AABBRectangle = {\n    X: 0,\n    Y: 0,\n    Width: 1000,\n    Height: 1000\n  };\n  private readonly resolution: RVec2 = [800, 600];\n  private bodiesCount = 100;\n  private bodyRadius = 15;\n  private bodyColorConfig = {\n    default: [0.392, 0.867, 0.09],\n    collide: [1, 0, 0],\n    selected: [0, 0, 1]\n  };\n\n  private border!: BorderRenderer;\n\n  private collisionEngine!: CollisionEngine;\n  private collisionEngineFactory!: CollisionEngineFactory;\n\n  private selectedBodies: SelectedBodyState[] = [];\n\n  private engineRenderer!: EngineRenderer;\n\n  private bodiesRenderer!: CircleRenderer;\n\n  private obstaclesRenderer!: RectangleRenderer;\n\n  public IsEngineRendererEnabled = false;\n\n  private isSimulationPaused = false;\n\n  private interactionTool!: InteractionTool;\n\n  private resizeViewBehavior = (d: Dimension) => this.CenterCamera(d);\n\n  private pointerWorld = { X: 0, Y: 0 };\n\n  constructor(\n    private readonly gl: WebGL2RenderingContext,\n    private engineName: SupportedCollisionEngine\n  ) {\n    this.collisionEngineFactory = new CollisionEngineFactory({\n      'quad-tree': () => [\n        new Boundary(\n          0,\n          0,\n          this.fieldDimension.Width,\n          this.fieldDimension.Height\n        ),\n        (this.engineRenderer = new QuadTreeRenderer(this.gl))\n      ]\n    });\n\n    this.bodiesRenderer = new CircleRenderer(this.gl);\n    this.obstaclesRenderer = new RectangleRenderer(this.gl);\n\n    this.collisionEngine = this.collisionEngineFactory.Create(engineName);\n\n    this.border = new BorderRenderer(gl, this.fieldDimension);\n\n    this.interactionTool = new PanTool(this.gl, this);\n\n    this.Setup();\n\n    (window as any)['app'] = this;\n  }\n\n  public Dispose(): void {\n    delete (window as any)['app'];\n\n    App.EventBus.Reset();\n  }\n\n  public SwitchCollisionEngine(engineName: SupportedCollisionEngine): void {\n    this.engineName = engineName;\n\n    this.collisionEngine.Reset();\n    this.collisionEngine = this.collisionEngineFactory.Create(engineName);\n\n    this.engineRenderer.Camera(this.camera);\n    this.engineRenderer.ResizeView(this.resolution);\n\n    this.bodies.forEach(body => this.collisionEngine.Add(body));\n  }\n\n  public SelectBody(x: number, y: number): boolean {\n    const world = this.ScreenToWorld(x, y);\n\n    this.RestoreSelectedBodiesState();\n\n    this.SelectBodiesAndStoreState({\n      X: world.X,\n      Y: world.Y,\n      Width: 1,\n      Height: 1\n    });\n\n    return true;\n  }\n\n  public SelectBodies(region: AABBRectangle): boolean {\n    this.RestoreSelectedBodiesState();\n\n    this.SelectBodiesAndStoreState(region);\n\n    return true;\n  }\n\n  private SelectBodiesAndStoreState(region: AABBRectangle): void {\n    this.selectedBodies = this.bodies\n      .filter(body => body.IsOverlap(region))\n      .map(target => ({ target, color: target.Color }));\n\n    const selectedColor = this.bodyColorConfig.selected;\n    this.selectedBodies.forEach(\n      body =>\n        (body.target.Color = {\n          R: selectedColor[0],\n          G: selectedColor[1],\n          B: selectedColor[2]\n        })\n    );\n  }\n\n  private RestoreSelectedBodiesState(): void {\n    this.selectedBodies.forEach(state => (state.target.Color = state.color));\n  }\n\n  public ResizeView(dimension: Dimension) {\n    this.resizeViewBehavior(dimension);\n  }\n\n  private CenterCamera(dimension: Dimension): void {\n    this.Camera = {\n      X: (dimension.Width - this.fieldDimension.Width) / 2,\n      Y: -(dimension.Height - this.fieldDimension.Height) / 2\n    };\n\n    this.ResizeViewDefault(dimension);\n\n    this.resizeViewBehavior = (d: Dimension) => this.ResizeViewDefault(d);\n  }\n\n  private ResizeViewDefault(dimension: Dimension): void {\n    this.resolution[ResolutionComponent.Width] = dimension.Width;\n    this.resolution[ResolutionComponent.Height] = dimension.Height;\n\n    App.EventBus.Publish(AppEvent.ResizeView, dimension);\n\n    this.bodiesRenderer.ResizeView(dimension);\n    this.obstaclesRenderer.ResizeView(dimension);\n    this.border.ResizeView(dimension);\n    this.engineRenderer.ResizeView(this.resolution);\n  }\n\n  public ResizeField(dimension: Dimension): void {\n    if (this.IsDimensionShrink(dimension)) {\n      this.bodies.forEach(body => {\n        const rect = {\n          X: 0,\n          Y: 0,\n          Width: dimension.Width,\n          Height: dimension.Height\n        };\n\n        if (!body.IsInside(rect)) {\n          body.MoveInto(rect);\n        }\n      });\n    }\n\n    this.fieldDimension = { X: 0, Y: 0, ...dimension };\n\n    this.border.Dimension(this.fieldDimension);\n\n    this.SwitchCollisionEngine(this.engineName);\n  }\n\n  public OnMouseMove(e: MouseEvent): void {\n    this.pointerWorld = this.ScreenToWorld(e.offsetX, e.offsetY);\n    this.interactionTool.OnMouseMove(e);\n  }\n\n  public OnMouseDown(e: MouseEvent): void {\n    if (e.button === MouseButton.Left) {\n      if (e.shiftKey) {\n        this.SwitchInteractionTool(AvailableInteractionTool.Selection);\n      } else {\n        this.SwitchInteractionTool(AvailableInteractionTool.Pan);\n      }\n    }\n\n    this.interactionTool.OnMouseDown(e);\n  }\n\n  public OnMouseUp(e: MouseEvent): void {\n    this.interactionTool.OnMouseUp(e);\n\n    if (\n      e.button === MouseButton.Left &&\n      this.interactionTool instanceof SelectionTool\n    ) {\n      this.SwitchInteractionTool(AvailableInteractionTool.Pan);\n    }\n  }\n\n  public OnKeyDown(e: KeyboardEvent): void {\n    this.interactionTool.OnKeyDown(e);\n  }\n\n  OnWheel(e: WheelEvent): void {\n    this.interactionTool.OnWheel(e);\n  }\n\n  public OnTouchMove(e: TouchEvent): void {\n    this.interactionTool.OnTouchMove(e);\n  }\n\n  public OnTouchStart(e: TouchEvent): void {\n    this.interactionTool.OnTouchStart(e);\n  }\n\n  public OnTouchEnd(e: TouchEvent): void {\n    this.interactionTool.OnTouchEnd(e);\n  }\n\n  public ScreenToWorld(x: number, y: number) {\n    const halfWidth = this.resolution[0] / 2;\n    const halfHeight = this.resolution[1] / 2;\n    const zoom = this.camera[2];\n\n    const worldX = (x - halfWidth) / zoom + halfWidth - this.camera[0];\n    const worldY =\n      (this.resolution[1] - y - halfHeight) / zoom +\n      halfHeight +\n      this.camera[1];\n\n    return { X: worldX, Y: worldY };\n  }\n\n  public get Camera(): Required<UpdatedCameraComponent> {\n    return {\n      X: this.camera[Camera2Component.X],\n      Y: this.camera[Camera2Component.Y],\n      Zoom: this.camera[Camera2Component.Zoom]\n    };\n  }\n\n  public set Camera(position: UpdatedCameraComponent) {\n    if (position.X !== undefined) {\n      this.camera[Camera2Component.X] = position.X;\n    }\n\n    if (position.Y !== undefined) {\n      this.camera[Camera2Component.Y] = position.Y;\n    }\n\n    if (position.Zoom !== undefined) {\n      this.camera[Camera2Component.Zoom] = position.Zoom;\n    }\n\n    App.EventBus.Publish(AppEvent.CameraMove, this.Camera);\n\n    this.bodiesRenderer.Camera(this.camera);\n    this.obstaclesRenderer.Camera(this.camera);\n    this.border.Camera(this.camera);\n    this.engineRenderer.Camera(this.camera);\n  }\n\n  public get BodiesCount(): number {\n    return this.bodiesCount;\n  }\n\n  public set BodiesCount(count: number) {\n    this.bodiesCount = count;\n\n    this.BuildBodies();\n  }\n\n  public get BodiesRadius(): number {\n    return this.bodyRadius;\n  }\n\n  public set BodiesRadius(radius: number) {\n    this.bodyRadius = radius;\n    this.bodiesRenderer.Radius(radius);\n    this.UpdateRadiusForBodies();\n  }\n\n  public get ViewDimension(): Dimension {\n    return {\n      Width: this.resolution[ResolutionComponent.Width],\n      Height: this.resolution[ResolutionComponent.Height]\n    };\n  }\n\n  public get FieldBoundary(): Dimension {\n    return this.fieldDimension;\n  }\n\n  public get Pause(): boolean {\n    return this.isSimulationPaused;\n  }\n\n  public set Pause(value: boolean) {\n    this.isSimulationPaused = value;\n\n    App.EventBus.Publish(AppEvent.TogglePause, value);\n  }\n\n  public Draw(elapsed: number): void {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\n    if (this.collisionEngine !== null) {\n      this.UpdateBodies(elapsed);\n      this.obstaclesRenderer.Draw();\n      this.bodiesRenderer.Draw();\n      this.border.Draw();\n\n      if (this.IsEngineRendererEnabled) {\n        this.collisionEngine.Draw(elapsed);\n      }\n    }\n\n    this.interactionTool.Draw(elapsed);\n  }\n\n  private UpdateBodies(elapsed: number): void {\n    if (!this.isSimulationPaused) {\n      this.collisionEngine.ForEachCollided((a, b) =>\n        a.CheckCollision(b, elapsed)\n      );\n\n      this.bodies.forEach(body => body.Move(this.fieldDimension, elapsed));\n\n      this.collisionEngine.RecalculateBuckets();\n    }\n  }\n\n  private BuildBodies(): void {\n    const CircleComponentsCount = CircleRenderer.ComponentsPerIndex;\n\n    this.bodies = [];\n\n    const attributeBuilder = [\n      () => RandomFloat(0, this.fieldDimension.Width), // X\n      () => RandomFloat(0, this.fieldDimension.Height), // Y\n      () => this.bodyColorConfig.default[0], // R\n      () => this.bodyColorConfig.default[1], // G\n      () => this.bodyColorConfig.default[2] // B\n    ];\n\n    const data = Array.from(\n      { length: this.bodiesCount * CircleComponentsCount },\n      (_, n) => attributeBuilder[n % CircleComponentsCount]()\n    );\n\n    this.bodiesRenderer.UploadAttributes(data);\n\n    this.collisionEngine.Reset();\n\n    for (let n = 0; n < this.bodiesCount; ++n) {\n      const object = new CircleBody(\n        this.bodiesRenderer.PrimitiveAttributes(n),\n        this.bodyRadius,\n        {\n          X: RandomFloat(-100, 100),\n          Y: RandomFloat(-100, 100)\n        }\n      );\n\n      this.bodies.push(object);\n\n      this.collisionEngine.Add(object);\n    }\n\n    // Static rectangle (obstacle)\n    const obstacleRectangle: Rectangle = {\n      Center: {\n        X: this.fieldDimension.Width / 2,\n        Y: this.fieldDimension.Height / 2\n      },\n      Dimension: { Width: 400, Height: 200 },\n      Angle: RandomFloat(0, 2 * Math.PI)\n    };\n    const obstacles: number[] = PrimitiveBuilder.ColorRectangle(\n      obstacleRectangle,\n      [0.8, 0.8, 0.8]\n    );\n\n    this.obstaclesRenderer.UploadAttributes(obstacles);\n\n    const obstacle = new StaticRectangleBody(\n      this.obstaclesRenderer.PrimitiveAttributes(0),\n      obstacleRectangle\n    );\n\n    this.bodies.push(obstacle);\n\n    this.collisionEngine.Add(obstacle);\n  }\n\n  private UpdateRadiusForBodies(): void {\n    this.bodies.forEach(\n      body => body instanceof CircleBody && (body.Radius = this.bodyRadius)\n    );\n  }\n\n  private Setup(): void {\n    this.engineRenderer.Camera(this.camera);\n    this.engineRenderer.ResizeView(this.resolution);\n\n    this.gl.disable(this.gl.DEPTH_TEST);\n    this.gl.enable(this.gl.BLEND);\n    this.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\n    this.gl.clearColor(1, 1, 1, 1);\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n  }\n\n  private IsDimensionShrink(dimension: Dimension): boolean {\n    return (\n      dimension.Width < this.fieldDimension.Width ||\n      dimension.Height < this.fieldDimension.Height\n    );\n  }\n\n  private SwitchInteractionTool(tool: AvailableInteractionTool): void {\n    if (this.interactionTool !== null) {\n      if (tool === this.interactionTool.Type) {\n        return;\n      }\n\n      this.interactionTool.Dispose();\n    }\n\n    const factory = [\n      () => new PanTool(this.gl, this),\n      () => new SelectionTool(this.gl, this)\n    ];\n\n    this.interactionTool = factory[tool]();\n  }\n}\n","export default \"#version 300 es\\nprecision mediump float;\\n\\nin vec2 a_vertex;\\nin vec3 a_color;\\n\\nuniform vec3 u_cam;\\nuniform vec2 u_resolution;\\n\\nout vec3 rectangleColor;\\n\\nvoid main() \\n{\\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\\n  rectangleColor = a_color;\\n}\\n\"","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('aside',{class:{ minimized: _vm.isMinimized }},[_c('button',{staticClass:\"w-8 h-8 absolute block p-0 -right-8 top-0 cursor-pointer rounded-r bg-inherit\",on:{\"click\":_vm.ToggleMinimize}},[(!_vm.isMinimized)?_c('fa-icon',{attrs:{\"icon\":\"minus\"}}):_c('span',[_vm._v(_vm._s(_vm.appState.fps))])],1),_c('div',{staticClass:\"absolute text-xs\"},[_c('span',[_vm._v(\"FPS: \"+_vm._s(_vm.appState.fps))])]),_c('h3',{staticClass:\"text-center\"},[_vm._v(\"Collision\")]),_c('my-help-popup'),_c('fieldset',{staticClass:\"border border-y-slate-200 border-x-transparent p-2\"},[_c('legend',[_vm._v(\"Detection engine\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.appState.engine),expression:\"appState.engine\"}],attrs:{\"id\":\"QuadTree\",\"type\":\"radio\",\"name\":\"detectionEngine\",\"value\":\"quad-tree\"},domProps:{\"checked\":_vm._q(_vm.appState.engine,\"quad-tree\")},on:{\"change\":function($event){return _vm.$set(_vm.appState, \"engine\", \"quad-tree\")}}}),_c('label',{attrs:{\"for\":\"QuadTree\"}},[_vm._v(\"Quad tree\")])]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.appState.engine),expression:\"appState.engine\"}],attrs:{\"id\":\"BruteForce\",\"type\":\"radio\",\"name\":\"detectionEngine\",\"value\":\"brute-force\"},domProps:{\"checked\":_vm._q(_vm.appState.engine,\"brute-force\")},on:{\"change\":function($event){return _vm.$set(_vm.appState, \"engine\", \"brute-force\")}}}),_c('label',{attrs:{\"for\":\"BruteForce\"}},[_vm._v(\"Brute-force\")])])]),_c('my-tabs',{staticClass:\"mb-2\",model:{value:(_vm.settingsTab),callback:function ($$v) {_vm.settingsTab=$$v},expression:\"settingsTab\"}},[_c('my-tab',{attrs:{\"tabid\":_vm.Tab.Bodies}},[_vm._v(\"Bodies\")]),_c('my-tab',{attrs:{\"tabid\":_vm.Tab.Boundary}},[_vm._v(\"Boundary\")]),_c('my-tab',{attrs:{\"tabid\":_vm.Tab.Engine}},[_vm._v(\"Engine\")])],1),(_vm.IsBodiesTab)?_c('my-bodies-settings',{model:{value:(_vm.appState.bodies),callback:function ($$v) {_vm.$set(_vm.appState, \"bodies\", $$v)},expression:\"appState.bodies\"}}):(_vm.IsBoundaryTab)?_c('my-boundary-settings',{model:{value:(_vm.appState.boundary),callback:function ($$v) {_vm.$set(_vm.appState, \"boundary\", $$v)},expression:\"appState.boundary\"}}):(_vm.IsEngineTab)?_c('div',[_c('label',{staticClass:\"mr-2\",attrs:{\"for\":\"showEngineInternals\"}},[_vm._v(\"Show engine internals\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.appState.showEngineInternals),expression:\"appState.showEngineInternals\"}],staticClass:\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\",attrs:{\"id\":\"showEngineInternals\",\"type\":\"checkbox\",\"min\":\"1\",\"max\":\"500\"},domProps:{\"checked\":Array.isArray(_vm.appState.showEngineInternals)?_vm._i(_vm.appState.showEngineInternals,null)>-1:(_vm.appState.showEngineInternals)},on:{\"change\":function($event){var $$a=_vm.appState.showEngineInternals,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.$set(_vm.appState, \"showEngineInternals\", $$a.concat([$$v])))}else{$$i>-1&&(_vm.$set(_vm.appState, \"showEngineInternals\", $$a.slice(0,$$i).concat($$a.slice($$i+1))))}}else{_vm.$set(_vm.appState, \"showEngineInternals\", $$c)}}}})]):_vm._e(),_c('div',{staticClass:\"flex justify-between\"},[_c('button',{on:{\"click\":_vm.TogglePause}},[_c('fa-icon',{attrs:{\"icon\":_vm.togglePauseIcon}})],1),_c('button',{attrs:{\"disabled\":!_vm.CanApplySettings()},on:{\"click\":_vm.ApplySettings}},[_c('fa-icon',{attrs:{\"icon\":\"save\"}})],1)])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',[_c('div',[_c('span',{staticClass:\"mr-2\",class:{ 'caption-validation-error': _vm.IsInvalidBodiesCount(_vm.bodies.count.value) }},[_vm._v(\"Bodies\")]),_c('input',{class:{ invalid: _vm.IsInvalidBodiesCount(_vm.bodies.count.value) },attrs:{\"type\":\"number\",\"min\":\"2\",\"max\":\"1000000\"},domProps:{\"value\":_vm.bodies.count.value},on:{\"input\":_vm.UpdateCount}})]),_c('div',{staticClass:\"mt-1\"},[_c('span',{staticClass:\"mr-2\",class:{ 'caption-validation-error': _vm.IsInvalidBodiesRadius(_vm.bodies.radius.value) }},[_vm._v(\"Radius\")]),_c('input',{class:{ invalid: _vm.IsInvalidBodiesRadius(_vm.bodies.radius.value) },attrs:{\"type\":\"number\",\"min\":\"1\",\"max\":\"500\"},domProps:{\"value\":_vm.bodies.radius.value},on:{\"input\":_vm.UpdateRadius}})])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nimport { Component, Vue, Model, Emit } from 'vue-property-decorator';\n\ninterface MyInput extends Element {\n    value: string;\n}\n\ninterface MyInputEvent extends InputEvent {\n    target: MyInput;\n}\n\ninterface ValidatedValue<T> {\n    value: T;\n    isValid: boolean;\n}\n\nexport interface BodiesSettings {\n    count: ValidatedValue<number>;\n    radius: ValidatedValue<number>;\n}\n\n@Component\nexport default class MyBodiesSettings extends Vue {\n    @Model('update', { required: true, type: Object })\n    public bodies!: BodiesSettings;\n\n    @Emit('update')\n    public UpdateBoundary(_bodies: BodiesSettings) {}\n\n    public UpdateCount(e: Event): void {\n        const count = Number.parseInt((e as MyInputEvent).target.value);\n\n        this.bodies.count.value = count;\n        this.bodies.count.isValid = !this.IsInvalidBodiesCount(count);\n    }\n\n    public UpdateRadius(e: Event): void {\n        const radius = Number.parseInt((e as MyInputEvent).target.value);\n\n        this.bodies.radius.value = radius;\n        this.bodies.radius.isValid = !this.IsInvalidBodiesRadius(radius);\n    }\n\n    public IsInvalidBodiesCount(count: number) {\n        return count < 2 || count > 1000000;\n    }\n\n    public IsInvalidBodiesRadius(radius: number) {\n        return radius < 1 || radius > 500;\n    }\n}\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyBodiesSettings.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyBodiesSettings.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./MyBodiesSettings.vue?vue&type=template&id=664861e8&scoped=true&\"\nimport script from \"./MyBodiesSettings.vue?vue&type=script&lang=ts&\"\nexport * from \"./MyBodiesSettings.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"664861e8\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',[_c('div',[_c('span',{staticClass:\"inline-block mr-2 w-12\",class:{ 'caption-validation-error': _vm.IsInvalid(_vm.boundary.width.value) }},[_vm._v(\"Width\")]),_c('input',{class:{ 'invalid': _vm.IsInvalid(_vm.boundary.width.value) },attrs:{\"type\":\"number\",\"min\":\"10\",\"max\":\"1000000\"},domProps:{\"value\":_vm.boundary.width.value},on:{\"input\":_vm.UpdateWidth}})]),_c('div',{staticClass:\"mt-1\"},[_c('span',{staticClass:\"inline-block mr-2 w-12\",class:{ 'caption-validation-error': _vm.IsInvalid(_vm.boundary.height.value) }},[_vm._v(\"Height\")]),_c('input',{class:{ 'invalid': _vm.IsInvalid(_vm.boundary.height.value) },attrs:{\"type\":\"number\",\"min\":\"10\",\"max\":\"1000000\"},domProps:{\"value\":_vm.boundary.height.value},on:{\"input\":_vm.UpdateHeight}})])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nimport { Component, Vue, Emit, Model } from 'vue-property-decorator';\n\ninterface MyInput extends Element {\n    value: string;\n}\n\ninterface MyInputEvent extends InputEvent {\n    target: MyInput;\n}\n\ninterface ValidatedValue<T> {\n    value: T;\n    isValid: boolean;\n}\n\nexport interface Boundary {\n    width: ValidatedValue<number>;\n    height: ValidatedValue<number>;\n}\n\n@Component\nexport default class MyBoundarySettings extends Vue {\n    @Model('update', { required: true, type: Object })\n    public boundary!: Boundary;\n\n    @Emit('update')\n    public UpdateBoundary(_boundary: Boundary) {}\n\n    public UpdateWidth(e: Event): void {\n        const width = Number.parseInt((e as MyInputEvent).target.value);\n\n        this.boundary.width.value = width;\n        this.boundary.width.isValid = !this.IsInvalid(width);\n    }\n\n    public UpdateHeight(e: Event): void {\n        const height = Number.parseInt((e as MyInputEvent).target.value);\n\n        this.boundary.height.value = height;\n        this.boundary.height.isValid = !this.IsInvalid(height);\n    }\n\n    public IsInvalid(value: number) {\n        return value < 10 || value > 100000;\n    }\n}\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyBoundarySettings.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyBoundarySettings.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./MyBoundarySettings.vue?vue&type=template&id=4c28363e&scoped=true&\"\nimport script from \"./MyBoundarySettings.vue?vue&type=script&lang=ts&\"\nexport * from \"./MyBoundarySettings.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4c28363e\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',[_c('fa-icon',{staticClass:\"panel-help-trigger\",attrs:{\"icon\":\"question-circle\"}}),_c('div',{staticClass:\"panel-help-content\"},[_c('ul',[_c('li',[_c('fa-icon',{attrs:{\"icon\":\"mouse\"}}),_vm._v(\" \"),_c('span',{staticClass:\"accent\"},[_vm._v(\"LMB\")]),_vm._v(\" - select body \")],1),_c('li',[_c('fa-icon',{attrs:{\"icon\":\"mouse\"}}),_vm._v(\" \"),_c('span',{staticClass:\"accent\"},[_vm._v(\"LMB\")]),_vm._v(\" + \"),_c('span',{staticClass:\"accent\"},[_vm._v(\"SHIFT\")]),_vm._v(\" - select bodies in a rectangular region \")],1),_c('li',[_c('fa-icon',{attrs:{\"icon\":\"keyboard\"}}),_vm._v(\" \"),_c('span',{staticClass:\"accent\"},[_vm._v(\"SPACE\")]),_vm._v(\" - pause & resume simulation \")],1)])])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nimport { Component, Vue } from 'vue-property-decorator';\n\n@Component\nexport default class MyHelpPopup extends Vue { }\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyHelpPopup.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyHelpPopup.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./MyHelpPopup.vue?vue&type=template&id=4ab3fb2c&scoped=true&\"\nimport script from \"./MyHelpPopup.vue?vue&type=script&lang=ts&\"\nexport * from \"./MyHelpPopup.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./MyHelpPopup.vue?vue&type=style&index=0&id=4ab3fb2c&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4ab3fb2c\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',{staticClass:\"mx-2 first:mx-0 last:mr-0 cursor-pointer\",class:{ ['active-tab']: _vm.isActive },on:{\"click\":_vm.SelectTab}},[_vm._t(\"default\")],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nimport { Component, Vue, Prop } from 'vue-property-decorator';\n\nimport { Tabs } from './MyTabs.vue';\n\nexport interface Tab {\n    tabid: number;\n    isActive: boolean;\n}\n\n@Component\nexport default class MyTab extends Vue implements Tab {\n    @Prop({ required: true })\n    public tabid!: number;\n\n    public isActive = false;\n\n    public SelectTab(): void {\n        this.Parent.UpdateActiveTab(this.tabid);\n    }\n\n    private get Parent(): Tabs {\n        return this.$parent as unknown as Tabs;\n    }\n}\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyTab.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyTab.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./MyTab.vue?vue&type=template&id=ef8c96e4&scoped=true&\"\nimport script from \"./MyTab.vue?vue&type=script&lang=ts&\"\nexport * from \"./MyTab.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./MyTab.vue?vue&type=style&index=0&id=ef8c96e4&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ef8c96e4\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('div',{staticClass:\"flex\"},[_vm._t(\"default\")],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nimport { Component, Vue, Model, Emit, Watch } from 'vue-property-decorator';\n\nimport { Tab } from './MyTab.vue';\n\nexport interface Tabs {\n    UpdateActiveTab(_tab: number): void;\n}\n\n@Component\nexport default class MyTabs extends Vue implements Tabs {\n    @Model('tabId', { required: true, type: Number })\n    public readonly activeTab!: number;\n\n    @Emit('tabId')\n    public UpdateActiveTab(_tab: number) {}\n\n    @Watch('activeTab')\n    private ActiveTabChanged(_value: number, prev: number): void {\n        this.SyncActiveTab(prev);\n    }\n\n    mounted(): void {\n        this.SyncActiveTab(Number.POSITIVE_INFINITY);\n    }\n\n    private SyncActiveTab(prev: number): void {\n        const prevTab = this.FindTab(prev);\n        if (prevTab) {\n            prevTab.isActive = false;\n        }\n\n        const nextActive = this.FindTab(this.activeTab);\n        if (nextActive) {\n            nextActive.isActive = true;\n        }\n    }\n\n    private FindTab(tabId: number): Tab | null {\n        return this.Tabs.find(tab => tab.tabid === tabId) ?? null;\n    }\n\n    private get Tabs(): Tab[] {\n        return this.$children as unknown as Tab[];\n    }\n}\n","\nimport {\n    Component,\n    Vue,\n    Prop,\n    Watch,\n    Model,\n    Emit\n} from 'vue-property-decorator';\n\nimport { App } from './App';\nimport { SupportedCollisionEngine } from './collision_engines/CollisionEngineFactory';\nimport { AppEvent } from './Events';\nimport MyBodiesSettings from './MyBodiesSettings.vue';\nimport MyBoundarySettings from './MyBoundarySettings.vue';\nimport MyHelpPopup from './MyHelpPopup.vue';\nimport { AppState } from './View.vue';\n\nimport { MyTab, MyTabs } from '@/components/Tabs';\n\nenum TabId {\n    Bodies,\n    Boundary,\n    Engine\n}\n\n@Component({\n    components: {\n        MyBodiesSettings,\n        MyBoundarySettings,\n        MyHelpPopup,\n        MyTabs,\n        MyTab\n    }\n})\nexport default class MyAsidePanel extends Vue {\n    public readonly Tab = TabId;\n\n    @Model('updateAppState')\n    public appState!: AppState;\n\n    @Emit('updateAppState')\n    public UpdateModelState(_state: AppState) { }\n\n    @Prop()\n    public app!: App;\n\n    public settingsTab = TabId.Bodies;\n\n    private togglePauseIcons = ['pause', 'play'];\n    public togglePauseIcon = this.togglePauseIcons[+false];\n\n    public isMinimized = false;\n\n    @Watch('appState.engine')\n    private CollisionEngineChange(\n        value: SupportedCollisionEngine,\n        _prev: SupportedCollisionEngine\n    ): void {\n        this.app.SwitchCollisionEngine(value);\n    }\n\n    @Watch('appState.showEngineInternals')\n    private ShowEngineInternalsChange(value: boolean, _prev: boolean): void {\n        this.app.IsEngineRendererEnabled = value;\n    }\n\n    mounted(): void {\n        App.EventBus.Subscribe(\n            AppEvent.TogglePause,\n            pause => (this.togglePauseIcon = this.togglePauseIcons[+pause])\n        );\n    }\n\n    public ToggleMinimize(): void {\n        this.isMinimized = !this.isMinimized;\n    }\n\n    public ApplySettings(): void {\n        if (\n            this.IsFieldBoundaryWidthDiffer() ||\n            this.IsFieldBoundaryHeightDiffer()\n        ) {\n            this.app.ResizeField({\n                Width: this.appState.boundary.width.value,\n                Height: this.appState.boundary.height.value\n            });\n        }\n\n        if (this.IsBodiesCountDiffer()) {\n            this.app.BodiesCount = this.appState.bodies.count.value;\n        }\n\n        if (this.IsBodiesRadiusDiffer()) {\n            this.app.BodiesRadius = this.appState.bodies.radius.value;\n        }\n\n        this.$forceUpdate();\n    }\n\n    public TogglePause(): void {\n        this.app.Pause = !this.app.Pause;\n        this.togglePauseIcon = this.togglePauseIcons[+this.app.Pause];\n    }\n    public get IsBodiesTab(): boolean {\n        return this.settingsTab === TabId.Bodies;\n    }\n\n    public get IsBoundaryTab(): boolean {\n        return this.settingsTab === TabId.Boundary;\n    }\n\n    public get IsEngineTab(): boolean {\n        return this.settingsTab === TabId.Engine;\n    }\n\n    public CanApplySettings(): boolean {\n        return (\n            this.appState.boundary.width.isValid &&\n            this.appState.boundary.height.isValid &&\n            this.appState.bodies.count.isValid &&\n            this.appState.bodies.radius.isValid &&\n            this.IsSettingsDiffer()\n        );\n    }\n\n    private IsSettingsDiffer(): boolean {\n        return (\n            this.IsFieldBoundaryWidthDiffer() ||\n            this.IsFieldBoundaryHeightDiffer() ||\n            this.IsBodiesCountDiffer() ||\n            this.IsBodiesRadiusDiffer()\n        );\n    }\n\n    private IsFieldBoundaryWidthDiffer(): boolean {\n        return this.app.FieldBoundary.Width !== this.appState.boundary.width.value;\n    }\n\n    private IsFieldBoundaryHeightDiffer(): boolean {\n        return (\n            this.app.FieldBoundary.Height !== this.appState.boundary.height.value\n        );\n    }\n\n    private IsBodiesCountDiffer(): boolean {\n        return this.app.BodiesCount !== this.appState.bodies.count.value;\n    }\n\n    private IsBodiesRadiusDiffer(): boolean {\n        return this.app.BodiesRadius !== this.appState.bodies.radius.value;\n    }\n}\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyTabs.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyTabs.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./MyTabs.vue?vue&type=template&id=0da3f717&scoped=true&\"\nimport script from \"./MyTabs.vue?vue&type=script&lang=ts&\"\nexport * from \"./MyTabs.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0da3f717\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyAsidePanel.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MyAsidePanel.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./MyAsidePanel.vue?vue&type=template&id=4b0e2b98&scoped=true&\"\nimport script from \"./MyAsidePanel.vue?vue&type=script&lang=ts&\"\nexport * from \"./MyAsidePanel.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./MyAsidePanel.vue?vue&type=style&index=0&id=4b0e2b98&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4b0e2b98\",\n  null\n  \n)\n\nexport default component.exports","\nimport { Component, Vue } from 'vue-property-decorator';\n\nimport { App } from './App';\nimport { SupportedCollisionEngine } from './collision_engines/CollisionEngineFactory';\nimport MyAsidePanel from './MyAsidePanel.vue';\nimport { BodiesSettings } from './MyBodiesSettings.vue';\nimport { Boundary } from './MyBoundarySettings.vue';\n\nimport Viewport from '@/components/Viewport.vue';\n\nimport '@/css/button.css';\nimport '@/css/input.css';\n\nexport interface AppState {\n  engine: SupportedCollisionEngine,\n  bodies: BodiesSettings;\n  boundary: Boundary;\n  showEngineInternals: boolean;\n  fps: number;\n}\n\n@Component({\n  components: {\n    MyAsidePanel,\n    Viewport\n  }\n})\nexport default class Main extends Vue {\n  public width = 800;\n  public height = 600;\n\n  public readonly state: AppState = {\n    engine: 'quad-tree',\n    bodies: {\n      count: { value: 10000, isValid: true },\n      radius: { value: 2, isValid: true }\n    },\n    boundary: {\n      width: { value: 1000, isValid: true },\n      height: { value: 1000, isValid: true }\n    },\n    showEngineInternals: false,\n    fps: 0\n  };\n\n  private drawCallCounter = 0;\n  private drawCallCounterStart = Date.now();\n\n  public app!: App;\n  private isUnmounted!: boolean;\n  public isAppInitialized = false;\n\n  public async mounted() {\n    this.isUnmounted = false;\n\n    window.addEventListener('resize', this.OnResize);\n\n    this.lastDrawCall = Date.now();\n    window.requestAnimationFrame(() => {\n      this.Draw(Date.now() - this.lastDrawCall);\n    });\n  }\n\n  public beforeDestroy() {\n    this.isUnmounted = true;\n    window.removeEventListener('resize', this.OnResize);\n    this.app.Dispose();\n  }\n\n  public OnContextReady(ctx: WebGL2RenderingContext) {\n    this.app = new App(ctx, this.state.engine);\n    this.app.BodiesCount = this.state.bodies.count.value;\n    this.app.BodiesRadius = this.state.bodies.radius.value;\n    this.app.ResizeField({\n      Width: this.state.boundary.width.value,\n      Height: this.state.boundary.height.value\n    });\n\n    this.OnResize();\n\n    this.isAppInitialized = true;\n  }\n\n  private lastDrawCall = 0;\n\n  private Draw(elapsed: number) {\n    if (this.isUnmounted) {\n      return;\n    }\n\n    this.TrackFps();\n\n    this.app.Draw(elapsed);\n\n    window.requestAnimationFrame(() => {\n      const elapsed = Date.now() - this.lastDrawCall;\n      this.lastDrawCall = Date.now();\n\n      this.Draw(elapsed);\n    });\n\n    ++this.drawCallCounter;\n  }\n\n  private TrackFps(): void {\n    const elapsed = Date.now() - this.drawCallCounterStart;\n    if (elapsed >= 1000) {\n      this.state.fps = Math.round(this.drawCallCounter * (elapsed / 1000));\n\n      this.drawCallCounterStart = Date.now();\n      this.drawCallCounter = 0;\n    }\n  }\n\n  public OnWheel(e: WheelEvent) {\n    this.app.OnWheel(e);\n  }\n  /**\n   * @param offsetX positive values for moving towards right\n   * @param offsetY positive values for moving towards top\n   */\n  public OnMouseMove(e: MouseEvent) {\n    this.app.OnMouseMove(e);\n  }\n\n  public OnMouseDown(e: MouseEvent): void {\n    this.app.OnMouseDown(e);\n  }\n\n  public OnMouseUp(e: MouseEvent): void {\n    this.app.OnMouseUp(e);\n  }\n\n  public OnKeyDown(e: KeyboardEvent): void {\n    this.app.OnKeyDown(e);\n  }\n\n  public OnTouchMove(e: TouchEvent): void {\n    this.app.OnTouchMove(e);\n  }\n\n  public OnTouchStart(e: TouchEvent): void {\n    this.app.OnTouchStart(e);\n  }\n\n  public OnTouchEnd(e: TouchEvent): void {\n    this.app.OnTouchEnd(e);\n  }\n\n  private OnResize() {\n    this.width = window.innerWidth;\n    this.height = window.innerHeight;\n\n    this.app.ResizeView({ Width: this.width, Height: this.height });\n  }\n}\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./View.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./View.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./View.vue?vue&type=template&id=ddd80148&scoped=true&\"\nimport script from \"./View.vue?vue&type=script&lang=ts&\"\nexport * from \"./View.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ddd80148\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c,_setup=_vm._self._setupProxy;return _c('canvas',{ref:\"canvas\",style:({ width: _vm.Width, height: _vm.Height })})\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nimport { Component, Emit, Prop, Ref, Vue, Watch } from 'vue-property-decorator';\n\n@Component\nexport default class Viewport extends Vue {\n  @Prop() public readonly width!: number;\n  @Prop() public readonly height!: number;\n  @Prop({ default: false }) public readonly preserveDrawingBuffer!: boolean;\n  @Ref() public readonly canvas!: HTMLCanvasElement;\n  @Emit('context-ready') public ContextReady(_ctx: WebGL2RenderingContext) { /** Nope */ }\n  private context: WebGL2RenderingContext | null = null;\n\n  public get Width() { return this.width + 'px' ?? '100%'; }\n  public get Height() { return this.height + 'px' ?? '100%'; }\n  public async mounted() {\n    this.context = this.canvas.getContext('webgl2', { preserveDrawingBuffer: this.preserveDrawingBuffer });\n    if (this.context === null) {\n      console.error('Can\\'t initialize webgl2 context');\n      return;\n    }\n    this.UpdateViewport();\n    this.context.enable(this.context.CULL_FACE);\n    this.context.enable(this.context.DEPTH_TEST);\n    this.ContextReady(this.context);\n  }\n  @Watch('width')\n  private OnWidth() {\n    this.UpdateViewport();\n  }\n  @Watch('height')\n  private OnHeight() {\n    this.UpdateViewport();\n  }\n  private UpdateViewport() {\n    this.canvas.width = this.width;\n    this.canvas.height = this.height;\n    this.context?.viewport(0, 0, this.width, this.height);\n  }\n}\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Viewport.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-41.use[2]!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Viewport.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Viewport.vue?vue&type=template&id=13fb0e92&scoped=true&\"\nimport script from \"./Viewport.vue?vue&type=script&lang=ts&\"\nexport * from \"./Viewport.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/cli-service/node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"13fb0e92\",\n  null\n  \n)\n\nexport default component.exports","export function Throw(msg: string): never {\n  throw new Error(msg);\n}\n","import { Throw } from '../misc/Throw';\n\nexport class ShaderProgram {\n  private uniformCache: Map<string, WebGLUniformLocation> = new Map();\n  protected instance: WebGLProgram;\n  public constructor(protected gl: WebGL2RenderingContext) {\n    if (!gl) throw new Error('Invalid webgl2 context');\n\n    this.instance = gl.createProgram() ?? Throw(\"Can't create shader program\");\n  }\n  public Attach(type: number, source: string) {\n    const shader = this.gl.createShader(type);\n    if (shader === null) throw new Error('Failed to create shader');\n\n    this.gl.shaderSource(shader, source);\n    this.gl.compileShader(shader);\n\n    if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n      const err = new Error(\n        this.gl.getShaderInfoLog(shader) ?? 'Failed to compile shader'\n      );\n      this.gl.deleteShader(shader);\n      throw err;\n    }\n\n    this.gl.attachShader(this.instance, shader);\n  }\n  public async AttachFromUrl(type: number, url: string) {\n    this.Attach(type, await (await fetch(url)).text());\n  }\n  public Link() {\n    this.gl.linkProgram(this.instance);\n    if (!this.gl.getProgramParameter(this.instance, this.gl.LINK_STATUS)) {\n      const err = new Error(\n        this.gl.getProgramParameter(this.instance, this.gl.LINK_STATUS) ??\n          'Failed to link shader'\n      );\n      this.gl.deleteProgram(this.instance);\n      throw err;\n    }\n  }\n  public Use() {\n    this.gl.useProgram(this.instance);\n  }\n  public SetUniform3fv(name: string, value: number[]) {\n    this.gl.uniform3fv(this.GetUniformLocation(name), value);\n  }\n  public SetUniform2fv(name: string, value: number[]) {\n    this.gl.uniform2fv(this.GetUniformLocation(name), value);\n  }\n  public SetUniform4fv(name: string, value: number[]) {\n    this.gl.uniform4fv(this.GetUniformLocation(name), value);\n  }\n  public SetUniform1f(name: string, value: number) {\n    this.gl.uniform1f(this.GetUniformLocation(name), value);\n  }\n  public SetUniform1i(name: string, value: number) {\n    this.gl.uniform1i(this.GetUniformLocation(name), value);\n  }\n  public SetUniform2iv(name: string, value: number[]) {\n    this.gl.uniform2iv(this.GetUniformLocation(name), value);\n  }\n  public GetAttributeLocation(name: string) {\n    this.Use();\n\n    const loc = this.gl.getAttribLocation(this.instance, name);\n\n    if (loc === -1) throw new Error(`Failed to locate attribute '${name}'`);\n\n    return loc;\n  }\n  private GetUniformLocation(name: string) {\n    this.Use();\n\n    let loc = this.uniformCache.get(name) ?? null;\n\n    if (loc === null) {\n      loc = this.gl.getUniformLocation(this.instance, name);\n\n      if (loc === null) throw new Error(`Failed to locate uniform '${name}'`);\n\n      this.uniformCache.set(name, loc);\n    }\n\n    return loc;\n  }\n}\n"],"names":["render","_vm","this","_c","_self","_setupProxy","staticClass","attrs","width","height","on","OnContextReady","nativeOn","$event","preventDefault","OnWheel","apply","arguments","OnMouseMove","OnMouseDown","OnMouseUp","OnKeyDown","OnTouchMove","OnTouchStart","OnTouchEnd","isAppInitialized","app","model","value","state","callback","$$v","expression","_e","staticRenderFns","Algorithm","static","values","n","length","iterable","comp","a","b","max","MaxElement","Real","Math","abs","Number","EPSILON","Vector2","X","Y","vector","scalar","vec","Divide","Point","Distance","ray","surface","normalizedSurface","Normalize","dot","DotProduct","Subtract","Multiply","atan2","p0","p1","sqrt","SqrDistance","pow","points","min","POSITIVE_INFINITY","NEGATIVE_INFINITY","forEach","p","angle","c","cos","s","sin","origin","rotated","Rotate","rect","rectHalfWidth","Dimension","Width","rectHalfHeight","Height","RotateAroundPoint","Center","Angle","point","lines","closestIdx","closestDistance","line","distance","ClosestToLine","ab","B","A","ap","proj","abSqrLen","d","Add","IsEqual","Intersection","circle","circleDistanceX","circleDistanceY","Radius","cornerDistance_sq","transformedRect","transformedCircle","AABBRectangleCircle","r","ba","uNumerator","CrossProduct","denominator","IsEqualValues","u","t","lb","rb","rt","lt","AABBRectanglePoint","LineLine","aabbRectangle","AabbRectangleVertices","map","v","aabbNonRotated","RectangleVertices","AABBRectangleLine","aToPointDistance","bToPointDistance","lineLength","CirclePoint","closest","LinePoint","c0","c1","Collision","rectangle","sides","Vertices","collided","filter","side","LineCircle","tangent","collidedSidePoints","flatMap","x","collidedCorner","find","Normal","closestSide","MoveOutCircleFromStaticRectangle","SolveCollision","afterBounce","Reflect","Velocity","AttachToClosestSide","oppositeSide","ClosestLine","closestPointOnSide","transformNormal","operator","centerOutside","CircleCollider","constructor","IsOverlap","IsInside","IsCollide","another","CollideWithCircle","CircleCircle","CollideWithRectangle","RectangleCircle","CheckCollision","collider","elapsed","CheckCollisionWithCircle","_elapsed","targetX","targetY","ax","ay","CheckCollisionWithRectangle","CircleStaticRectangle","Move","boundary","MaxVelocity","velocity","normalizeFactor","tickVelocityX","tickVelocityY","boundaryRight","boundaryTop","VisualCircle","center","Color","color","colorOffset","offset","buffer","R","G","CircleBody","visual","radius","ExtractCenter","MoveInto","rectRight","rectTop","StaticRectangleCollider","UpdateVertices","RectangleAABBRectangle","every","_rect","Error","_boundary","val","VisualRectangle","data","StaticRectangleBody","EnumSize","e","Object","keys","PrimitiveBuilder","leftBottom","leftTop","rightTop","rightBottom","TypeSizeResolver","window","WebGL2RenderingContext","BYTE","Int8Array","BYTES_PER_ELEMENT","SHORT","Int16Array","UNSIGNED_BYTE","Uint8Array","UNSIGNED_SHORT","Uint16Array","FLOAT","Float32Array","HALF_FLOAT","INT","Int32Array","UNSIGNED_INT","Uint32Array","INT_2_10_10_10_REV","UNSIGNED_INT_2_10_10_10_REV","type","Sizes","NotNull","BorderComponent","PrimitivesRenderer","gl","primitiveDescription","vbo","vao","shader","attributes","componentsPerAttributeSet","attributeSetCount","shaderSource","Setup","SetupAttributes","UploadAttributes","attrib","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","PrimitiveAttributes","index","indicesPerPrimitive","Draw","Use","bindVertexArray","drawArrays","basePrimitiveType","createBuffer","createVertexArray","ShaderProgram","Attach","FRAGMENT_SHADER","fragment","VERTEX_SHADER","vertex","Link","stride","reduce","attr","size","Resolve","location","GetAttributeLocation","name","enableVertexAttribArray","vertexAttribPointer","normalized","BorderRenderer","borderDimension","viewDimension","camera","borderColorConfig","default","floatSize","ComponentsPerIndex","super","VBorder","FBorder","TRIANGLES","ResizeView","SetUniform2fv","BuildBorder","Camera","SetUniform3fv","BorderWidth","AABBColorRectangle","BruteForceCollisionEngine","Reset","objects","splice","object","push","Remove","removedIdx","indexOf","ForEachCollided","handler","aIdx","bIdx","RecalculateBuckets","Boundary","Right","Top","QuadNodePool","nextFree","NoNext","pool","Create","IsFull","Expand","free","idx","node","Free","roomIdx","At","Array","from","ExtendedSize","_x","QuadNode","GrowthFactor","parent","isLeaf","depth","childStart","NullNode","obj","leafs","nodePool","IsLeaf","NeedSplit","Split","AddToChildren","includes","added","ChildrenPerNode","ForEachChild","fn","FindNodeContaining","quads","search","nodeIdx","_child","PoolIdx","FilterCollided","RecalculateBucket","root","outOfNode","leafIdx","leaf","step","RemoveFromNodes","nodesIdx","remove","collapseCandidate","NeedCollapse","Collapse","HasChild","Size","Capacity","MaxDepth","CollapseRatio","halfWidth","halfHeight","firstChild","ConstructInPlace","delete","_leaf","add","receiver","Set","gather","childOffset","sum","target","args","fullArgs","QuadTreeCollisionEngine","renderer","fromPool","RootFetcher","NodePoolFetcher","bodies","ObjectIterator","clear","CollisionEngineFactory","engines","argsBuilder","prop","engine","ctor","AppEvent","AvailableInteractionTool","TouchDoubleTapEventBus","TouchPanEventBus","TouchZoomEventBus","MouseButtons","MouseButton","QuadTreeRenderer","nodesVbo","nodesVao","nodesShader","nodesAttributes","colorConfig","resolution","CollectNodeBounds","Root","LINES","FQuadTreeNode","VQuadTreeNode","FloatSize","ComponentsCount","posLoc","XY","MathUtil","ZoomDefault","Relative","dir","zoom","Zoom","Clamp","Absolute","Observer","listeners","Publish","payload","Subscribe","EventBus","observers","eventSet","event","TouchDoubleTap","prev","broadcaster","Timeout","changedTouches","touch","radiusX","touchCircle","pageX","pageY","prevCircle","Date","now","timestamp","Notify","copy","DoubleTap","TouchPan","targetTouches","id","identifier","y","item","dx","dy","handle","Pan","TouchZoom","Id","ZoomStart","UpdateTrace","prevTouch","trace","dist0","dist1","PanTool","lmbDownPosition","touchMovement","touchZoom","touchDoubleTap","unsubs","initialZoom","TouchMovement","Type","offsetX","offsetY","button","Left","SelectBody","code","Pause","buttons","MoveCamera","movementX","movementY","deltaY","Dispose","unsub","RgbComponent","RgbaComponent","Camera2Component","RVec2Component","SelectionTool","baseDraw","selectionStart","selectionRect","eventBusUnsubs","VSelectionRectangle","FSelectionRectangle","SetupListeners","ViewDimension","cam","Selection","ScreenToWorld","SelectBodies","selectionEnd","Extremum2","innerRegion","borderWidth","borderColor","borderTop","borderRight","borderBottom","borderLeft","resizeUnsub","App","dim","camMoveUnsub","CameraMove","RandomFloat","random","CircleComponent","CircleRenderer","bodyRadius","VCircle","FCircle","POINTS","InitializeUniforms","SetUniform1f","RectangleComponent","ResolutionComponent","RectangleRenderer","VRectangle","FRectangle","engineName","fieldDimension","bodiesCount","bodyColorConfig","collide","selected","border","collisionEngine","collisionEngineFactory","selectedBodies","engineRenderer","bodiesRenderer","obstaclesRenderer","IsEngineRendererEnabled","isSimulationPaused","interactionTool","resizeViewBehavior","CenterCamera","pointerWorld","quad-tree","SwitchCollisionEngine","body","world","RestoreSelectedBodiesState","SelectBodiesAndStoreState","region","selectedColor","dimension","ResizeViewDefault","ResizeField","IsDimensionShrink","shiftKey","SwitchInteractionTool","worldX","worldY","position","undefined","BodiesCount","count","BuildBodies","BodiesRadius","UpdateRadiusForBodies","FieldBoundary","TogglePause","COLOR_BUFFER_BIT","UpdateBodies","CircleComponentsCount","attributeBuilder","_","obstacleRectangle","PI","obstacles","ColorRectangle","obstacle","disable","DEPTH_TEST","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","clearColor","tool","factory","class","minimized","isMinimized","ToggleMinimize","_v","_s","appState","fps","directives","rawName","domProps","_q","$set","settingsTab","Tab","Bodies","Engine","IsBodiesTab","IsBoundaryTab","IsEngineTab","showEngineInternals","isArray","_i","$$a","$$el","$$c","checked","$$i","concat","slice","togglePauseIcon","CanApplySettings","ApplySettings","IsInvalidBodiesCount","invalid","UpdateCount","IsInvalidBodiesRadius","UpdateRadius","MyBodiesSettings","Vue","UpdateBoundary","_bodies","parseInt","isValid","__decorate","Model","required","Emit","Component","component","IsInvalid","UpdateWidth","UpdateHeight","MyBoundarySettings","MyHelpPopup","isActive","SelectTab","_t","MyTab","tabid","Parent","UpdateActiveTab","$parent","Prop","MyTabs","activeTab","_tab","ActiveTabChanged","_value","SyncActiveTab","mounted","prevTab","FindTab","nextActive","tabId","Tabs","tab","$children","Watch","TabId","MyAsidePanel","UpdateModelState","_state","togglePauseIcons","CollisionEngineChange","_prev","ShowEngineInternalsChange","pause","IsFieldBoundaryWidthDiffer","IsFieldBoundaryHeightDiffer","IsBodiesCountDiffer","IsBodiesRadiusDiffer","$forceUpdate","IsSettingsDiffer","components","Main","drawCallCounter","drawCallCounterStart","isUnmounted","async","addEventListener","OnResize","lastDrawCall","requestAnimationFrame","beforeDestroy","removeEventListener","ctx","TrackFps","round","innerWidth","innerHeight","Viewport","ref","style","preserveDrawingBuffer","canvas","ContextReady","_ctx","context","getContext","UpdateViewport","CULL_FACE","console","error","OnWidth","OnHeight","viewport","Ref","Throw","msg","uniformCache","Map","instance","createProgram","source","createShader","compileShader","getShaderParameter","COMPILE_STATUS","err","getShaderInfoLog","deleteShader","attachShader","url","fetch","text","linkProgram","getProgramParameter","LINK_STATUS","deleteProgram","useProgram","uniform3fv","GetUniformLocation","uniform2fv","SetUniform4fv","uniform4fv","uniform1f","SetUniform1i","uniform1i","SetUniform2iv","uniform2iv","loc","getAttribLocation","get","getUniformLocation","set"],"sourceRoot":""}