"use strict";(self["webpackChunkwebgl_polygon"]=self["webpackChunkwebgl_polygon"]||[]).push([[607],{567:function(e,t,i){i.r(t),i.d(t,{default:function(){return pt}});var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"flex"},[t("Viewport",{staticClass:"outline-none",attrs:{tabindex:"0",width:e.width,height:e.height,preserveDrawingBuffer:"true"},on:{"context-ready":e.OnContextReady},nativeOn:{wheel:function(t){return t.preventDefault(),e.OnWheel.apply(null,arguments)},mousemove:function(t){return e.OnMouseMove.apply(null,arguments)},mousedown:function(t){return e.OnMouseDown.apply(null,arguments)},mouseup:function(t){return e.OnMouseUp.apply(null,arguments)},keydown:function(t){return e.OnKeyDown.apply(null,arguments)},touchmove:function(t){return e.OnTouchMove.apply(null,arguments)},touchstart:function(t){return e.OnTouchStart.apply(null,arguments)},touchend:function(t){return e.OnTouchEnd.apply(null,arguments)}}}),e.isAppInitialized?t("my-aside-panel",{attrs:{app:e.app},model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}):e._e()],1)},n=[],o=i(655),r=i(195);class a{static IsEqualValues(...e){for(let t=1;t<e.length;++t)if(e[0]!==e[t])return!1;return!0}static MaxElement(e,t=((e,t)=>e<t)){let i=null;for(const s of e)(null===i||t(i,s))&&(i=s);return i}static MinElement(e,t=((e,t)=>e<t)){return a.MaxElement(e,((e,i)=>t(i,e)))}}class h{static IsEqual(e,t){return Math.abs(e-t)<Number.EPSILON}}class l{static Add(e,t){return{X:e.X+t.X,Y:e.Y+t.Y}}static Subtract(e,t){return{X:e.X-t.X,Y:e.Y-t.Y}}static Multiply(e,t){return{X:e.X*t,Y:e.Y*t}}static Divide(e,t){return{X:e.X/t,Y:e.Y/t}}static CrossProduct(e,t){return e.X*t.Y-e.Y*t.X}static DotProduct(e,t){return e.X*t.X+e.Y*t.Y}static Normalize(e){return l.Divide(e,c.Distance({X:0,Y:0},e))}static Normal(e){return{X:e.Y,Y:-e.X}}static Reflect(e,t){const i=l.Normalize(t),s=l.DotProduct(e,i);return l.Subtract(l.Multiply(i,2*s),e)}static Angle(e,t){return Math.atan2(e.Y,t.X)-Math.atan2(t.Y,t.X)}}class c{static Distance(e,t){return Math.sqrt(c.SqrDistance(e,t))}static SqrDistance(e,t){return Math.pow(e.X-t.X,2)+Math.pow(e.Y-t.Y,2)}static Extremum2(e){const t={X:Number.POSITIVE_INFINITY,Y:Number.POSITIVE_INFINITY},i={X:Number.NEGATIVE_INFINITY,Y:Number.NEGATIVE_INFINITY};return e.forEach((e=>{e.X<t.X&&(t.X=e.X),e.X>i.X&&(i.X=e.X),e.Y<t.Y&&(t.Y=e.Y),e.Y>i.Y&&(i.Y=e.Y)})),{min:t,max:i}}static Rotate(e,t){const i=Math.cos(t),s=Math.sin(t);return{X:e.X*i-e.Y*s,Y:e.X*s+e.Y*i}}static RotateAroundPoint(e,t,i){const s=c.Rotate({X:e.X-t.X,Y:e.Y-t.Y},i);return s.X+=t.X,s.Y+=t.Y,s}static RectangleVertices(e){const t=e.Dimension.Width/2,i=e.Dimension.Height/2;return[c.RotateAroundPoint({X:e.Center.X-t,Y:e.Center.Y-i},e.Center,e.Angle),c.RotateAroundPoint({X:e.Center.X+t,Y:e.Center.Y-i},e.Center,e.Angle),c.RotateAroundPoint({X:e.Center.X+t,Y:e.Center.Y+i},e.Center,e.Angle),c.RotateAroundPoint({X:e.Center.X-t,Y:e.Center.Y+i},e.Center,e.Angle)]}static AabbRectangleVertices(e){return[{X:e.X,Y:e.Y},{X:e.X+e.Width,Y:e.Y},{X:e.X+e.Width,Y:e.Y+e.Width},{X:e.X,Y:e.Y+e.Width}]}static ClosestLine(e,t){let i=-1,s=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;++n){const o=t[n],r=c.Distance(c.ClosestToLine(e,o),e);r<s&&(i=n,s=r)}return t[i]}static ClosestToLine(e,t){const i=l.Subtract(t.B,t.A),s=l.Subtract(e,t.A),n=l.DotProduct(s,i),o=l.DotProduct(i,i),r=n/o;return r<=0?t.A:r>=1?t.B:l.Add(t.A,l.Multiply(i,r))}static IsEqual(e,t){return h.IsEqual(e.X,t.X)&&h.IsEqual(e.Y,t.Y)}}class d{static AABBRectangleCircle(e,t){const i=Math.abs(t.Center.X-(e.X+e.Width/2)),s=Math.abs(t.Center.Y-(e.Y+e.Height/2));if(i>e.Width/2+t.Radius)return!1;if(s>e.Height/2+t.Radius)return!1;if(i<=e.Width/2)return!0;if(s<=e.Height/2)return!0;const n=(i-e.Width/2)**2+(s-e.Height/2)**2;return n<=t.Radius**2}static RectangleCircle(e,t){const i={X:-e.Dimension.Width/2,Y:-e.Dimension.Height/2,Width:e.Dimension.Width,Height:e.Dimension.Height},s={Center:c.Rotate({X:t.Center.X-e.Center.X,Y:t.Center.Y-e.Center.Y},-e.Angle),Radius:t.Radius};return d.AABBRectangleCircle(i,s)}static AABBRectanglePoint(e,t){return t.X<=e.X+e.Width&&t.X>=e.X&&t.Y<=e.Y+e.Height&&t.Y>=e.Y}static LineLine(e,t){const i=l.Subtract(e.B,e.A),s=l.Subtract(t.B,t.A),n=l.Subtract(t.A,e.A),o=l.CrossProduct(n,i),r=l.CrossProduct(i,s);if(0===o&&0===r)return!!(c.IsEqual(e.A,t.A)||c.IsEqual(e.A,t.B)||c.IsEqual(e.B,t.A)||c.IsEqual(e.B,t.B))||(!a.IsEqualValues(t.A.X-e.A.X<0,t.A.X-e.B.X<0,t.B.X-e.A.X<0,t.B.X-e.B.X<0)||!a.IsEqualValues(t.A.Y-e.A.Y<0,t.A.Y-e.B.Y<0,t.B.Y-e.A.Y<0,t.B.Y-e.B.Y<0));if(0===r)return!1;const h=o/r,d=l.CrossProduct(n,s)/r;return d>=0&&d<=1&&h>=0&&h<=1}static AABBRectangleLine(e,t){const i={X:e.X,Y:e.Y},s={X:e.X+e.Width,Y:e.Y},n={X:s.X,Y:e.Y+e.Height},o={X:e.X,Y:n.Y};return!(!d.AABBRectanglePoint(e,t.A)&&!d.AABBRectanglePoint(e,t.B))||(d.LineLine(t,{A:i,B:s})||d.LineLine(t,{A:s,B:n})||d.LineLine(t,{A:n,B:o})||d.LineLine(t,{A:o,B:i}))}static RectangleAABBRectangle(e,t){const i=e.Dimension.Width/2,s=e.Dimension.Height/2;{const[n,o,r,a]=c.AabbRectangleVertices(t).map((t=>c.RotateAroundPoint(t,e.Center,-e.Angle))),h={X:e.Center.X-i,Y:e.Center.Y-s,Width:e.Dimension.Width,Height:e.Dimension.Height};if(d.AABBRectanglePoint(h,n)&&d.AABBRectanglePoint(h,o)&&d.AABBRectanglePoint(h,r)&&d.AABBRectanglePoint(h,a))return!0}{const[i,s,n,o]=c.RectangleVertices(e);return d.AABBRectangleLine(t,{A:i,B:s})||d.AABBRectangleLine(t,{A:s,B:n})||d.AABBRectangleLine(t,{A:n,B:o})||d.AABBRectangleLine(t,{A:o,B:i})}}static LinePoint(e,t){const i=c.Distance(e.A,t),s=c.Distance(e.B,t),n=c.Distance(e.A,e.B);return Math.abs(i+s-n)<=.01}static CirclePoint(e,t){return c.Distance(e.Center,t)<=e.Radius}static LineCircle(e,t){if(d.CirclePoint(t,e.A))return!0;if(d.CirclePoint(t,e.B))return!0;const i=c.Distance(e.A,e.B),s=l.DotProduct(l.Subtract(t.Center,e.A),l.Subtract(e.B,e.A))/i**2,n=l.Add(l.Multiply(l.Subtract(e.B,e.A),s),e.A);return!!d.LinePoint(e,n)&&c.Distance(n,t.Center)<=t.Radius}static CircleCircle(e,t){return c.Distance(e.Center,t.Center)<=e.Radius+t.Radius}}class u{static CircleStaticRectangle(e,t){const i=[{A:t.Vertices[0],B:t.Vertices[1]},{A:t.Vertices[1],B:t.Vertices[2]},{A:t.Vertices[2],B:t.Vertices[3]},{A:t.Vertices[3],B:t.Vertices[0]}],s=i.filter((t=>d.LineCircle(t,e)));let n;if(s.length>1){const t=s.flatMap((e=>[e.A,e.B])),i=t.find((e=>t.find((t=>t===e))))??t[0];n=l.Normal(l.Subtract(i,e.Center))}else if(0===s.length){const t=u.MoveOutCircleFromStaticRectangle(i,e);n=l.Subtract(t.A,t.B)}else n=l.Subtract(s[0].A,s[0].B);s.length>0&&u.SolveCollision(s,e);const o=l.Reflect(e.Velocity,n);e.Velocity.X=o.X,e.Velocity.Y=o.Y}static MoveOutCircleFromStaticRectangle(e,t){return u.AttachToClosestSide(e,t,!0)}static SolveCollision(e,t){u.AttachToClosestSide(e,t,!1)}static AttachToClosestSide(e,t,i){const s=c.ClosestLine(t.Center,e),n=c.ClosestToLine(t.Center,s),o=l.Normalize(l.Subtract(n,t.Center)),r=i?l.Add:l.Subtract,a=r(n,l.Multiply(o,t.Radius));return t.Center.X=a.X,t.Center.Y=a.Y,s}}class p{Center;Radius;Velocity;constructor(e,t,i){this.Center=e,this.Radius=t,this.Velocity=i}IsOverlap(e){return d.AABBRectangleCircle(e,this)}IsInside(e){return!(this.Center.X-this.Radius<e.X)&&(!(this.Center.X+this.Radius>e.X+e.Width)&&(!(this.Center.Y-this.Radius<e.Y)&&!(this.Center.Y+this.Radius>e.Y+e.Height)))}IsCollide(e){return e.CollideWithCircle(this)}CollideWithCircle(e){return d.CircleCircle(this,e)}CollideWithRectangle(e){return d.RectangleCircle(e,this)}CheckCollision(e,t){e.CheckCollisionWithCircle(this,t)}CheckCollisionWithCircle(e,t){const i=Math.atan2(e.Center.Y-this.Center.Y,e.Center.X-this.Center.X),s=this.Center.X+2*Math.cos(i)*this.Radius,n=this.Center.Y+2*Math.sin(i)*this.Radius,o=s-e.Center.X,r=n-e.Center.Y;this.Velocity.X-=o,this.Velocity.Y-=r,e.Velocity.X+=o,e.Velocity.Y+=r}CheckCollisionWithRectangle(e,t){u.CircleStaticRectangle(this,e)}Move(e,t){const i=25,s=Math.sqrt(this.Velocity.X**2+this.Velocity.Y**2);if(s>i){const e=i/s;this.Velocity.X*=e,this.Velocity.Y*=e}let n=this.Velocity.X*(t/1e3),o=this.Velocity.Y*(t/1e3);const r=e.X+e.Width,a=e.Y+e.Height;this.Center.X-this.Radius+n<e.X?(this.Center.X=e.X+this.Radius,n*=-1,this.Velocity.X*=-1):this.Center.X+this.Radius+n>r&&(this.Center.X=r-this.Radius,n*=-1,this.Velocity.X*=-1),this.Center.Y-this.Radius+o<e.Y?(this.Center.Y=e.X+this.Radius,o*=-1,this.Velocity.Y*=-1):this.Center.Y+this.Radius+o>a&&(this.Center.Y=a-this.Radius,o*=-1,this.Velocity.Y*=-1),this.Center.X=this.Center.X+n,this.Center.Y=this.Center.Y+o}}class f{center;constructor(e){this.center=e}set Color(e){const t=this.center.offset+2;this.center.buffer[t]=e.R,this.center.buffer[t+1]=e.G,this.center.buffer[t+2]=e.B}get Color(){const e=this.center.offset+2;return{R:this.center.buffer[e],G:this.center.buffer[e+1],B:this.center.buffer[e+2]}}Center(e){this.center.buffer[this.center.offset+0]=e.X,this.center.buffer[this.center.offset+1]=e.Y}}class g{collider;visual;constructor(e,t,i){this.collider=new p(this.ExtractCenter(e),t,i),this.visual=new f(e)}IsOverlap(e){return this.collider.IsOverlap(e)}IsInside(e){return this.collider.IsInside(e)}IsCollide(e){return this.collider.IsCollide(e)}CollideWithCircle(e){return this.collider.CollideWithCircle(e)}CollideWithRectangle(e){return this.collider.CollideWithRectangle(e)}set Color(e){this.visual.Color=e}get Color(){return this.visual.Color}MoveInto(e){const t=this.collider.Radius,i=e.X+e.Width,s=e.Y+e.Height;this.Center.X+t>i?this.Center={X:i-t,Y:this.Center.Y}:this.Center.X-t<e.X&&(this.Center={X:e.X+t,Y:this.Center.Y}),this.Center.Y+t>s?this.Center={X:this.Center.X,Y:s-t}:this.Center.Y-t<e.Y&&(this.Center={X:this.Center.X,Y:e.Y+t})}CheckCollision(e,t){this.collider.CheckCollision(e,t)}CheckCollisionWithCircle(e,t){this.collider.CheckCollisionWithCircle(e,t)}CheckCollisionWithRectangle(e,t){this.collider.CheckCollisionWithRectangle(e,t)}Move(e,t){this.collider.Move(e,t),this.Center=this.collider.Center}get Center(){return this.collider.Center}set Center(e){this.collider.Center.X=e.X,this.collider.Center.Y=e.Y,this.visual.Center(e)}get Radius(){return this.collider.Radius}set Radius(e){this.collider.Radius=e}ExtractCenter(e){return{X:e.buffer[e.offset],Y:e.buffer[e.offset+1]}}}class m{Center;Dimension;angle;Vertices;constructor(e,t,i){this.Center=e,this.Dimension=t,this.angle=i,this.UpdateVertices()}IsOverlap(e){return d.RectangleAABBRectangle(this,e)}IsInside(e){return this.Vertices.every((t=>d.AABBRectanglePoint(e,t)))}IsCollide(e){return e.CollideWithRectangle(this)}CollideWithCircle(e){return d.RectangleCircle(this,e)}CollideWithRectangle(e){throw new Error("Not required now")}CheckCollision(e,t){e.CheckCollisionWithRectangle(this,t)}CheckCollisionWithCircle(e,t){u.CircleStaticRectangle(e,this)}CheckCollisionWithRectangle(e,t){throw new Error("Method not implemented.")}Move(e,t){}get Angle(){return this.angle}set Angle(e){this.angle=e,this.UpdateVertices()}UpdateVertices(){this.Vertices=c.RectangleVertices(this)}}class b{data;constructor(e){this.data=e}set Color(e){this.data.buffer[this.data.offset+2]=e.R,this.data.buffer[this.data.offset+3]=e.G,this.data.buffer[this.data.offset+4]=e.B,this.data.buffer[this.data.offset+7]=e.R,this.data.buffer[this.data.offset+8]=e.G,this.data.buffer[this.data.offset+9]=e.B,this.data.buffer[this.data.offset+12]=e.R,this.data.buffer[this.data.offset+13]=e.G,this.data.buffer[this.data.offset+14]=e.B,this.data.buffer[this.data.offset+17]=e.R,this.data.buffer[this.data.offset+18]=e.G,this.data.buffer[this.data.offset+19]=e.B,this.data.buffer[this.data.offset+22]=e.R,this.data.buffer[this.data.offset+23]=e.G,this.data.buffer[this.data.offset+24]=e.B,this.data.buffer[this.data.offset+27]=e.R,this.data.buffer[this.data.offset+28]=e.G,this.data.buffer[this.data.offset+29]=e.B}get Color(){return{R:this.data.buffer[this.data.offset+2],G:this.data.buffer[this.data.offset+3],B:this.data.buffer[this.data.offset+4]}}}class v{collider;visual;constructor(e,t){this.collider=new m(t.Center,t.Dimension,t.Angle),this.visual=new b(e)}MoveInto(e){throw new Error("Method not implemented.")}set Color(e){this.visual.Color=e}get Color(){return this.visual.Color}IsOverlap(e){return this.collider.IsOverlap(e)}IsInside(e){return this.collider.IsInside(e)}IsCollide(e){return this.collider.IsCollide(e)}CollideWithCircle(e){return this.collider.CollideWithCircle(e)}CollideWithRectangle(e){return this.collider.CollideWithRectangle(e)}CheckCollision(e,t){this.collider.CheckCollision(e,t)}CheckCollisionWithCircle(e,t){this.collider.CheckCollisionWithCircle(e,t)}CheckCollisionWithRectangle(e,t){this.collider.CheckCollisionWithRectangle(e,t)}Move(e,t){this.collider.Move(e,t)}}var C="#version 300 es\n\nprecision mediump float;\n\nin vec3 color;\nout vec4 outColor;\n\nvoid main() \n{\n    outColor = vec4(color, 1);\n}\n",R="#version 300 es\nprecision mediump float;\n\nin vec2 a_vertex;\nin vec3 a_color;\n\nuniform vec3 u_cam;\nuniform vec2 u_resolution;\n\nout vec3 color;\n\nvoid main() \n{\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\n  color = a_color;\n}\n";function w(e){return Object.keys(e).length>>1}class y{static AABBColorRectangle(e,t){const i=[e.X,e.Y,...t],s=[e.X,e.Y+e.Height,...t],n=[e.X+e.Width,e.Y+e.Height,...t],o=[e.X+e.Width,e.Y,...t];return[...i,...n,...s,...i,...o,...n]}static ColorRectangle(e,t){const[i,s,n,o]=c.RectangleVertices(e);return[i.X,i.Y,...t,n.X,n.Y,...t,o.X,o.Y,...t,i.X,i.Y,...t,s.X,s.Y,...t,n.X,n.Y,...t]}}class A{static Sizes=[[window.WebGL2RenderingContext.BYTE,Int8Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.SHORT,Int16Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.UNSIGNED_BYTE,Uint8Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.UNSIGNED_SHORT,Uint16Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.FLOAT,Float32Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.HALF_FLOAT,2],[window.WebGL2RenderingContext.INT,Int32Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.INT_2_10_10_10_REV,Int32Array.BYTES_PER_ELEMENT],[window.WebGL2RenderingContext.UNSIGNED_INT_2_10_10_10_REV,Int32Array.BYTES_PER_ELEMENT]];static Resolve(e){return A.Sizes.find((t=>t[0]===e))[1]}}function S(){throw new Error("Null or undefined are not acceptable")}var B,Y=i(695);class I{gl;primitiveDescription;vbo;vao;shader;attributes;componentsPerAttributeSet=0;attributeSetCount=0;constructor(e,t,i,s){this.gl=e,this.primitiveDescription=s,this.Setup(t),this.SetupAttributes(i)}UploadAttributes(e){this.attributes=new Float32Array(e),this.attributeSetCount=this.attributes.length/this.componentsPerAttributeSet,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attributes,this.gl.DYNAMIC_DRAW)}PrimitiveAttributes(e){return{buffer:this.attributes,offset:e*this.componentsPerAttributeSet*this.primitiveDescription.indicesPerPrimitive}}Draw(){this.shader.Use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attributes,this.gl.DYNAMIC_DRAW),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.primitiveDescription.basePrimitiveType,0,this.attributeSetCount)}Setup(e){this.vbo=this.gl.createBuffer()??S(),this.vao=this.gl.createVertexArray()??S(),this.shader=new Y.s(this.gl),this.shader.Attach(this.gl.FRAGMENT_SHADER,e.fragment),this.shader.Attach(this.gl.VERTEX_SHADER,e.vertex),this.shader.Link(),this.shader.Use()}SetupAttributes(e){if(0===e.length)throw new Error("Attributes description can't be empty");this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bindVertexArray(this.vao);const t=e.reduce(((e,t)=>e+t.size*A.Resolve(t.type)),0);this.componentsPerAttributeSet=t/A.Resolve(e[0].type);for(let i=0,s=0;i<e.length;s+=e[i].size*A.Resolve(e[i].type),++i){const n=e[i],o=this.shader.GetAttributeLocation(n.name);this.gl.enableVertexAttribArray(o),this.gl.vertexAttribPointer(o,n.size,n.type,n.normalized,t,s)}this.gl.bindVertexArray(null)}}(function(e){e[e["X"]=0]="X",e[e["Y"]=1]="Y",e[e["R"]=2]="R",e[e["G"]=3]="G",e[e["B"]=4]="B"})(B||(B={}));class T extends I{borderDimension;static ComponentsPerIndex=w(B);viewDimension=[800,600];camera=[0,0,1];borderColorConfig={default:[.5,.5,.5]};constructor(e,t){const i=A.Resolve(e.FLOAT),s=i*T.ComponentsPerIndex;super(e,{vertex:R,fragment:C},[{name:"a_vertex",size:2,type:e.FLOAT,normalized:!1,stride:s,offset:0},{name:"a_color",size:3,type:e.FLOAT,normalized:!1,stride:s,offset:2*i}],{indicesPerPrimitive:6,basePrimitiveType:e.TRIANGLES}),this.borderDimension=t,this.ResizeView(t)}ResizeView(e){this.viewDimension=[e.Width,e.Height],this.shader.SetUniform2fv("u_resolution",this.viewDimension)}Dimension(e){this.borderDimension={...e},this.UploadAttributes(this.BuildBorder())}Camera(e){this.camera=[...e],this.shader.SetUniform3fv("u_cam",this.camera)}BuildBorder(){const e=2;return[...y.AABBColorRectangle({X:-e,Y:0,Width:e,Height:this.borderDimension.Height},this.borderColorConfig.default),...y.AABBColorRectangle({X:-e,Y:this.borderDimension.Height,Width:this.borderDimension.Width+2*e,Height:e},this.borderColorConfig.default),...y.AABBColorRectangle({X:this.borderDimension.Width,Y:0,Width:e,Height:this.borderDimension.Height},this.borderColorConfig.default),...y.AABBColorRectangle({X:-e,Y:-e,Width:this.borderDimension.Width+2*e,Height:e},this.borderColorConfig.default)]}}class E{Reset(){this.objects.splice(0)}objects=[];Add(e){return this.objects.push(e),!0}Remove(e){const t=this.objects.indexOf(e);return t>=0&&(this.objects.splice(t,1),!0)}ForEachCollided(e){for(let t=0;t<this.objects.length;++t)for(let i=t+1;i<this.objects.length;++i){const s=this.objects[t],n=this.objects[i];s.IsCollide(n)&&e(s,n)}}RecalculateBuckets(){}Draw(e){}}class X{X;Y;Width;Height;constructor(e,t,i,s){this.X=e,this.Y=t,this.Width=i,this.Height=s}get Right(){return this.X+this.Width}get Top(){return this.Y+this.Height}}class _{static NoNext=-1;static GrowthFactor=2;nextFree=_.NoNext;pool=[];Create(){this.IsFull&&this.Expand();const e=this.pool[this.nextFree],t=this.nextFree;return this.nextFree=e.nextFree,{idx:t,node:e.node}}Free(e){this.pool[e].nextFree=this.nextFree,this.nextFree=e}At(e){return this.pool[e].node}Expand(){this.nextFree=this.pool.length,this.pool=Array.from({length:this.ExtendedSize},((e,t)=>{const i=t<this.pool.length?this.pool[t].node:new P(new X(0,0,0,0));return{node:i,nextFree:t+1}})),this.pool[this.pool.length-1].nextFree=_.NoNext}get IsFull(){return this.nextFree===_.NoNext}get ExtendedSize(){return 0===this.pool.length?_.GrowthFactor:this.pool.length*_.GrowthFactor}}class P{boundary;parent;isLeaf;depth;static ChildrenPerNode=4;static NullNode=-1;static MaxDepth=8;static Capacity=16;static CollapseRatio=.25;objects=[];childStart=P.NullNode;constructor(e,t=P.NullNode,i=!0,s=1){this.boundary=e,this.parent=t,this.isLeaf=i,this.depth=s}Add(e,t,i){return!!e.IsOverlap(this.boundary)&&(this.IsLeaf?this.NeedSplit?(this.Split(t,i),this.AddToChildren(e,t,i)):(this.objects.includes(e)||this.objects.push(e),!0):this.AddToChildren(e,t,i))}AddToChildren(e,t,i){let s=!1;for(let n=0;n<P.ChildrenPerNode;++n)s=i.At(this.childStart+n).Add(e,t,i)||s;return s}ForEachChild(e,t){for(let i=0;i<P.ChildrenPerNode;++i){const s=this.childStart+i;e(t.At(s),s)}}FindNodeContaining(e,t){const i=[],s=n=>{const o=t.At(n);e.IsOverlap(this.boundary)&&(o.isLeaf?o.objects.indexOf(e)>=0&&i.push(n):o.ForEachChild(((e,t)=>s(t)),t))};return s(this.PoolIdx(t)),i}FilterCollided(e){return this.objects.filter((t=>e!==t&&t.IsCollide(e)))}RecalculateBucket(e,t,i){const s=[];t.forEach((e=>{const n=i.At(e);for(let o=0,r=1;o<n.objects.length;o+=r){const a=n.objects[o];a.IsOverlap(n.boundary)?(a.IsInside(n.boundary)||s.push(a),r=1):(n.RemoveFromNodes(a,[e],t,i),s.push(a),r=0)}})),s.forEach((s=>e.Add(s,t,i)))}RemoveFromNodes(e,t,i,s){if(0===t.length)return!1;t.forEach((t=>{const i=s.At(t),n=i.objects.indexOf(e);n>=0&&i.objects.splice(n,1)}));for(const n of t)for(let e=n;e!==P.NullNode&&s.At(e).NeedCollapse(s);e=s.At(e).parent)s.At(e).Collapse(i,s);return!0}Remove(e,t,i){return this.RemoveFromNodes(e,this.FindNodeContaining(e,i),t,i)}get HasChild(){return this.childStart!==P.NullNode}Size(e){return P.Size(this.PoolIdx(e),e)}PoolIdx(e){if(!this.isLeaf)return e.At(this.childStart).parent;if(this.parent===P.NullNode)return 0;{const t=e.At(this.parent);for(let i=0;i<P.ChildrenPerNode;++i){const s=t.childStart+i;if(e.At(s)===this)return s}}return P.NullNode}get IsLeaf(){return this.isLeaf}get NeedSplit(){return this.objects.length>=P.Capacity&&this.depth<P.MaxDepth}NeedCollapse(e){return this.objects.length/P.Capacity<P.CollapseRatio&&this.parent!==P.NullNode&&P.Size(this.parent,e)<=P.Capacity}Split(e,t){const i=this.boundary.Width/2,s=this.boundary.Height/2,n=t.Create(),o=this.PoolIdx(t);P.ConstructInPlace(n.node,{boundary:new X(this.boundary.X+i,this.boundary.Y+s,i,s),parent:o,isLeaf:!0,depth:this.depth+1}),this.childStart=n.idx,P.ConstructInPlace(t.Create().node,{boundary:new X(this.boundary.X,this.boundary.Y+s,i,s),parent:o,isLeaf:!0,depth:this.depth+1}),P.ConstructInPlace(t.Create().node,{boundary:new X(this.boundary.X,this.boundary.Y,i,s),parent:o,isLeaf:!0,depth:this.depth+1}),P.ConstructInPlace(t.Create().node,{boundary:new X(this.boundary.X+i,this.boundary.Y,i,s),parent:o,isLeaf:!0,depth:this.depth+1}),this.objects.forEach((i=>{const s=this.AddToChildren(i,e,t);if(!s)throw new Error("Leaf has object that not fit. Probably some mistake in RecalculateBucket implementation")})),this.objects.splice(0),this.isLeaf=!1,e.delete(o),this.ForEachChild(((t,i)=>e.add(i)),t)}Collapse(e,t){if(this.parent===P.NullNode)throw new Error("Can't collapse a root node");if(!this.IsLeaf)throw new Error("Can't collapse a non leaf node");const i=new Set,s=n=>{n.IsLeaf?(n.objects.forEach((e=>i.add(e))),n.objects.splice(0),e.delete(n.PoolIdx(t))):n.ForEachChild((e=>s(e)),t)},n=t.At(this.parent);s(n);for(let o=P.ChildrenPerNode-1;o>=0;--o)t.Free(n.childStart+o);n.objects.push(...i),n.isLeaf=!0,n.childStart=P.NullNode,e.add(n.PoolIdx(t))}static Size(e,t){const i=t.At(e);if(i.IsLeaf)return i.objects.length;{let e=0;for(let s=0;s<P.ChildrenPerNode;++s)e+=P.Size(i.childStart+s,t);return e}}static*ObjectIterator(e){for(const t of e.objects)yield t}static ConstructInPlace(e,t){const i={parent:P.NullNode,isLeaf:!0,depth:1,...t};return e.boundary.X=i.boundary.X,e.boundary.Y=i.boundary.Y,e.boundary.Width=i.boundary.Width,e.boundary.Height=i.boundary.Height,e.objects.splice(0),e.parent=i.parent,e.isLeaf=i.isLeaf,e.depth=i.depth,e.childStart=P.NullNode,e}}class D{boundary;renderer;root;leafs=new Set;nodePool;constructor(e,t){this.boundary=e,this.renderer=t,this.nodePool=new _;const i=this.nodePool.Create();P.ConstructInPlace(i.node,{boundary:this.boundary}),this.root=i.node,this.leafs.add(i.idx),this.renderer.RootFetcher=()=>this.root,this.renderer.NodePoolFetcher=()=>this.nodePool}Add(e){return this.root.Add(e,this.leafs,this.nodePool)}Remove(e){return this.root.Remove(e,this.leafs,this.nodePool)}RecalculateBuckets(){this.root.RecalculateBucket(this.root,this.leafs,this.nodePool)}ForEachCollided(e){this.leafs.forEach((t=>{const i=[...P.ObjectIterator(this.nodePool.At(t))];for(let s=0;s<i.length;++s)for(let t=s+1;t<i.length;++t){const n=i[s],o=i[t];n.IsCollide(o)&&e(n,o)}}))}Reset(){this.leafs.clear(),this.nodePool=new _;const e=this.nodePool.Create();P.ConstructInPlace(e.node,{boundary:this.boundary}),this.root=e.node,this.leafs.add(e.idx)}Draw(e){this.renderer.Draw(e)}}class x{engines={"quad-tree":{constructor:D},"brute-force":{constructor:E}};constructor(e){for(const t in e){const i=t;this.engines[i].args=e[i]}}Create(e){const t=this.engines[e],i=t.constructor,s=t.args;return s?new i(...s()):new i}}var W,N,O,M,F,L,V,U="#version 300 es\n\nprecision mediump float;\n\nuniform vec3 u_color;\n\nout vec4 outColor;\n\nvoid main() \n{\n    outColor = vec4(u_color, 1);\n}\n",z="#version 300 es\nprecision mediump float;\n\nin vec2 a_vertex;\n\nuniform vec3 u_cam;\nuniform vec2 u_resolution;\n\nout vec3 color;\n\nvoid main() \n{\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\n}\n";class H{gl;nodesVbo;nodesVao;nodesShader;nodesAttributes;colorConfig={default:[.5,.5,.5]};RootFetcher;NodePoolFetcher;constructor(e){this.gl=e,this.Setup()}ResizeView(e){this.nodesShader.SetUniform2fv("u_resolution",e)}Camera(e){this.nodesShader.SetUniform3fv("u_cam",e)}Draw(e){const t=[];this.CollectNodeBounds(this.Root,t),this.nodesAttributes=new Float32Array(t),this.nodesShader.Use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.nodesVbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.nodesAttributes,this.gl.DYNAMIC_DRAW),this.gl.bindVertexArray(this.nodesVao),this.gl.drawArrays(this.gl.LINES,0,this.nodesAttributes.length/2)}CollectNodeBounds(e,t){if(!e.HasChild)return;const i=e.boundary.Width/2,s=e.boundary.Height/2;t.push(e.boundary.X+i,e.boundary.Y),t.push(e.boundary.X+i,e.boundary.Top),t.push(e.boundary.X,e.boundary.Y+s),t.push(e.boundary.Right,e.boundary.Y+s),e.ForEachChild((e=>this.CollectNodeBounds(e,t)),this.NodePoolFetcher())}Setup(){this.nodesVbo=this.gl.createBuffer()??S(),this.nodesVao=this.gl.createVertexArray()??S(),this.nodesShader=new Y.s(this.gl),this.nodesShader.Attach(this.gl.FRAGMENT_SHADER,U),this.nodesShader.Attach(this.gl.VERTEX_SHADER,z),this.nodesShader.Link(),this.nodesShader.Use();const e=Float32Array.BYTES_PER_ELEMENT,t=2;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.nodesVbo),this.gl.bindVertexArray(this.nodesVao);const i=this.nodesShader.GetAttributeLocation("a_vertex");this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,e*t,0),this.gl.bindVertexArray(null),this.nodesShader.SetUniform3fv("u_color",this.colorConfig.default)}get Root(){return this.RootFetcher()}}(function(e){e[e["ResizeView"]=0]="ResizeView",e[e["CameraMove"]=1]="CameraMove",e[e["TogglePause"]=2]="TogglePause"})(W||(W={})),function(e){e[e["Pan"]=0]="Pan",e[e["Selection"]=1]="Selection"}(N||(N={}));class k{X;Y;constructor(e,t){this.X=e,this.Y=t}Distance(e){return c.Distance({X:this.X,Y:this.Y},e)}}class G{static Clamp(e,t,i){return Math.max(t,Math.min(e,i))}}class Z{app;min=.5;max=10;constructor(e){this.app=e}Relative(e){const t=-e/Math.abs(e),i=this.app.Camera.Zoom,s=t*(t>0?.1:.2);this.app.Camera={Zoom:G.Clamp(i+s,this.min,this.max)}}Absolute(e){this.app.Camera={Zoom:G.Clamp(e,this.min,this.max)}}}class j{listeners=[];Publish(...e){this.listeners.forEach((t=>t(...e)))}Subscribe(e){return this.listeners.includes(e)||this.listeners.push(e),()=>this.listeners.splice(this.listeners.indexOf(e),1)}}class q{observers;constructor(e){this.observers=Array.from({length:w(e)},(()=>new j))}Publish(e,...t){this.observers[e].Publish(...t)}Subscribe(e,t){return this.observers[e].Subscribe(t)}Reset(){for(let e=0;e<this.observers.length;++e)this.observers[e]=new j}}(function(e){e[e["DoubleTap"]=0]="DoubleTap"})(O||(O={}));class ${prev=[];broadcaster=new q(O);OnTouchStart(e){const t=200;[...e.changedTouches].forEach((e=>{const i=e.radiusX>0?e.radiusX:15,s={Center:{X:e.pageX,Y:e.pageY},Radius:e.radiusX};let n=!0;for(let o=0,r=1;o<this.prev.length;o+=r){const a=this.prev[o],h={Center:{X:a.touch.pageX,Y:a.touch.pageY},Radius:i};Date.now()-a.timestamp>=t?(r=0,this.prev.splice(o,1)):d.CircleCircle(s,h)?(n=!1,r=0,this.prev.splice(o,1),this.Notify(e)):r=1}if(n){const t={pageX:e.pageX,pageY:e.pageY,radiusX:i};this.prev.push({timestamp:Date.now(),touch:t})}}))}get Observer(){return this.broadcaster}Notify(e){this.broadcaster.Publish(O.DoubleTap,e)}}(function(e){e[e["Pan"]=0]="Pan"})(M||(M={}));class K{broadcaster=new q(M);prev;OnTouchStart(e){const t=e.targetTouches[0];this.prev={id:t.identifier,x:t.pageX,y:t.pageY}}OnTouchMove(e){if(e.targetTouches.item(0)?.identifier!==this.prev.id)return;const t=e.targetTouches[0];this.Notify({dx:t.pageX-this.prev.x,dy:t.pageY-this.prev.y}),this.prev.x=t.pageX,this.prev.y=t.pageY}Subscribe(e){return this.broadcaster.Subscribe(M.Pan,e)}Notify(e){this.broadcaster.Publish(M.Pan,e)}}(function(e){e[e["ZoomStart"]=0]="ZoomStart",e[e["Zoom"]=1]="Zoom"})(F||(F={}));class Q{broadcaster=new q(F);prev=[{Id:-1,X:0,Y:0},{Id:-1,X:0,Y:0}];OnTouchStart(e){2===e.targetTouches.length&&(this.broadcaster.Publish(F.ZoomStart),this.UpdateTrace(e))}OnTouchEnd(e){[...e.targetTouches].forEach((e=>{const t=this.prev.find((t=>t.Id===e.identifier));t&&(t.Id=-1)}))}OnTouchMove(e){if(2!==e.targetTouches.length||!this.prev.every((e=>-1!==e.Id)))return;e.preventDefault();const[t,i]=(e.targetTouches[0].identifier===this.prev[0].Id?[e.targetTouches[0],e.targetTouches[1]]:[e.targetTouches[1],e.targetTouches[0]]).map((e=>({X:e.pageX,Y:e.pageY}))),s=c.Distance(this.prev[0],this.prev[1]),n=c.Distance(t,i);this.Notify(n/s)}get Observer(){return this.broadcaster}Notify(e){this.broadcaster.Publish(F.Zoom,e)}UpdateTrace(e){for(let t=0;t<e.targetTouches.length;++t)this.prev[t].Id=e.targetTouches[t].identifier,this.prev[t].X=e.targetTouches[t].pageX,this.prev[t].Y=e.targetTouches[t].pageY}}(function(e){e[e["Nope"]=0]="Nope",e[e["Left"]=1]="Left",e[e["Right"]=2]="Right",e[e["Wheel"]=4]="Wheel",e[e["BrowserBack"]=8]="BrowserBack",e[e["BrowserForward"]=16]="BrowserForward"})(L||(L={})),function(e){e[e["Left"]=0]="Left",e[e["Wheel"]=1]="Wheel",e[e["Right"]=2]="Right",e[e["BrowserBack"]=3]="BrowserBack",e[e["BrowserForward"]=4]="BrowserForward"}(V||(V={}));class J{gl;app;lmbDownPosition;zoom;touchMovement=new K;touchZoom=new Q;touchDoubleTap=new $;unsubs=[];initialZoom=0;constructor(e,t){this.gl=e,this.app=t,this.zoom=new Z(this.app),this.unsubs.push(this.touchMovement.Subscribe((e=>this.TouchMovement(e)))),this.touchZoom.Observer.Subscribe(F.ZoomStart,(()=>this.initialZoom=this.app.Camera.Zoom)),this.unsubs.push(this.touchZoom.Observer.Subscribe(F.Zoom,(e=>this.TouchZoom(e)))),this.unsubs.push(this.touchDoubleTap.Observer.Subscribe(O.DoubleTap,(e=>this.TouchDoubleTap(e))))}get Type(){return N.Pan}OnMouseDown(e){this.lmbDownPosition=new k(e.offsetX,e.offsetY)}OnMouseUp(e){e.button===V.Left&&this.lmbDownPosition.Distance(new k(e.offsetX,e.offsetY))<2&&this.app.SelectBody(e.offsetX,e.offsetY)}OnKeyDown(e){switch(e.code){case"Space":this.app.Pause=!this.app.Pause;break}}OnMouseMove(e){e.buttons&L.Left&&this.MoveCamera(e.movementX,e.movementY)}OnWheel(e){this.zoom.Relative(e.deltaY)}OnTouchMove(e){this.touchMovement.OnTouchMove(e),this.touchZoom.OnTouchMove(e)}OnTouchStart(e){this.touchMovement.OnTouchStart(e),this.touchZoom.OnTouchStart(e),this.touchDoubleTap.OnTouchStart(e)}OnTouchEnd(e){this.touchZoom.OnTouchEnd(e)}Draw(e){}Dispose(){this.unsubs.forEach((e=>e()))}MoveCamera(e,t){const i=this.app.Camera.Zoom;this.app.Camera={X:this.app.Camera.X+e/i,Y:this.app.Camera.Y+t/i}}TouchMovement(e){this.MoveCamera(e.dx,e.dy)}TouchZoom(e){this.zoom.Absolute(this.initialZoom*e)}TouchDoubleTap(e){this.app.Pause=!this.app.Pause}}var ee,te,ie,se,ne="#version 300 es\n\nprecision mediump float;\n\nin vec4 color;\nout vec4 outColor;\n\nvoid main() \n{\n    outColor = color;\n}\n",oe="#version 300 es\nprecision mediump float;\n\nin vec2 a_vertex;\nin vec4 a_color;\n\nuniform vec3 u_cam;\nuniform vec2 u_resolution;\n\nout vec4 color;\n\nvoid main() \n{\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\n  color = a_color;\n}\n";(function(e){e[e["R"]=0]="R",e[e["G"]=1]="G",e[e["B"]=2]="B"})(ee||(ee={})),function(e){e[e["R"]=0]="R",e[e["G"]=1]="G",e[e["B"]=2]="B",e[e["A"]=3]="A"}(te||(te={}));(function(e){e[e["X"]=0]="X",e[e["Y"]=1]="Y",e[e["Zoom"]=2]="Zoom"})(ie||(ie={})),function(e){e[e["X"]=0]="X",e[e["Y"]=1]="Y"}(se||(se={}));class re extends I{app;static ComponentsPerIndex=w(se)+w(te);baseDraw=()=>{};viewDimension=[800,600];camera=[0,0,1];selectionStart;selectionRect=null;zoom;eventBusUnsubs;constructor(e,t){const i=A.Resolve(e.FLOAT),s=i*re.ComponentsPerIndex;super(e,{vertex:oe,fragment:ne},[{name:"a_vertex",size:2,type:e.FLOAT,normalized:!1,stride:s,offset:0},{name:"a_color",size:4,type:e.FLOAT,normalized:!1,stride:s,offset:2*i}],{indicesPerPrimitive:6,basePrimitiveType:e.TRIANGLES}),this.app=t,this.zoom=new Z(this.app),this.SetupListeners(),this.ResizeView(this.app.ViewDimension);const n=this.app.Camera;this.Camera([n.X,n.Y,n.Zoom])}get Type(){return N.Selection}ResizeView(e){this.viewDimension=[e.Width,e.Height],this.shader.SetUniform2fv("u_resolution",this.viewDimension)}Camera(e){this.camera=[...e],this.shader.SetUniform3fv("u_cam",this.camera)}OnMouseDown(e){this.selectionStart=this.app.ScreenToWorld(e.offsetX,e.offsetY)}OnMouseUp(e){null!==this.selectionRect&&this.app.SelectBodies(this.selectionRect)}OnKeyDown(e){}OnMouseMove(e){const t=this.app.ScreenToWorld(e.offsetX,e.offsetY),i=c.Extremum2([this.selectionStart,t]);this.selectionRect={X:i.min.X,Y:i.min.Y,Width:i.max.X-i.min.X,Height:i.max.Y-i.min.Y};const s=y.AABBColorRectangle({...i.min,Width:this.selectionRect.Width,Height:this.selectionRect.Height},[.3764705882352941,.49019607843137253,.5450980392156862,.65]),n=1/this.camera[ie.Zoom],o=[.47,.56,.61,1],r=y.AABBColorRectangle({X:i.min.X-n,Y:i.max.Y,Width:this.selectionRect.Width+2*n,Height:n},o),a=y.AABBColorRectangle({X:i.max.X,Y:i.min.Y,Width:n,Height:this.selectionRect.Height},o),h=y.AABBColorRectangle({X:i.min.X-n,Y:i.min.Y-n,Width:this.selectionRect.Width+2*n,Height:n},o),l=y.AABBColorRectangle({X:i.min.X-n,Y:i.min.Y,Width:n,Height:this.selectionRect.Height},o);this.UploadAttributes([...s,...r,...a,...h,...l]),this.baseDraw=super.Draw}OnWheel(e){this.zoom.Relative(e.deltaY)}OnTouchMove(e){}OnTouchStart(e){}OnTouchEnd(e){}Draw(){this.baseDraw()}SetupListeners(){const e=be.EventBus.Subscribe(W.ResizeView,(e=>this.ResizeView(e))),t=be.EventBus.Subscribe(W.CameraMove,(e=>this.Camera([e.X,e.Y,e.Zoom])));this.eventBusUnsubs=[e,t]}Dispose(){this.eventBusUnsubs.forEach((e=>e()))}}function ae(e,t){return Math.random()*(t-e)+e}var he,le="#version 300 es\n\nprecision mediump float;\n\nin vec3 circleColor;\n\nuniform float u_radius;\n\nout vec4 outColor;\n\nvoid main() \n{\n  if (distance(gl_PointCoord.xy, vec2(0.5)) > 0.5) {\n    discard;\n  } else {\n    outColor = vec4(circleColor.xyz, 1);\n  }\n}\n",ce="#version 300 es\nprecision mediump float;\n\nin vec2 a_vertex;\nin vec3 a_color;\n\nuniform vec3 u_cam;\nuniform float u_radius;\nuniform vec2 u_resolution;\n\nout vec3 circleColor;\n\nvoid main() \n{\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\n  circleColor = a_color;\n  gl_PointSize = u_radius * 2.f * u_cam.z;\n}\n";(function(e){e[e["X"]=0]="X",e[e["Y"]=1]="Y",e[e["R"]=2]="R",e[e["G"]=3]="G",e[e["B"]=4]="B"})(he||(he={}));class de extends I{static ComponentsPerIndex=w(he);viewDimension=[800,600];camera=[0,0,1];bodyRadius=5;constructor(e){const t=A.Resolve(e.FLOAT),i=t*de.ComponentsPerIndex;super(e,{vertex:ce,fragment:le},[{name:"a_vertex",size:2,type:e.FLOAT,normalized:!1,stride:i,offset:0},{name:"a_color",size:3,type:e.FLOAT,normalized:!1,stride:i,offset:2*t}],{indicesPerPrimitive:1,basePrimitiveType:e.POINTS}),this.InitializeUniforms()}ResizeView(e){this.viewDimension=[e.Width,e.Height],this.shader.SetUniform2fv("u_resolution",this.viewDimension)}Camera(e){this.camera=[...e],this.shader.SetUniform3fv("u_cam",this.camera)}Radius(e){this.bodyRadius=e,this.shader.SetUniform1f("u_radius",this.bodyRadius)}InitializeUniforms(){this.shader.SetUniform3fv("u_cam",this.camera),this.shader.SetUniform1f("u_radius",this.bodyRadius),this.shader.SetUniform2fv("u_resolution",this.viewDimension)}}var ue,pe,fe="#version 300 es\n\nprecision mediump float;\n\nin vec3 rectangleColor;\n\nout vec4 outColor;\n\nvoid main() \n{\n  outColor = vec4(rectangleColor.xyz, 1);\n}\n",ge="#version 300 es\nprecision mediump float;\n\nin vec2 a_vertex;\nin vec3 a_color;\n\nuniform vec3 u_cam;\nuniform vec2 u_resolution;\n\nout vec3 rectangleColor;\n\nvoid main() \n{\n  gl_Position = vec4(((a_vertex + u_cam.xy * vec2(1, -1)) / (u_resolution / 2.0f) - vec2(1, 1)) * u_cam.z, 0, 1);\n  rectangleColor = a_color;\n}\n";(function(e){e[e["X"]=0]="X",e[e["Y"]=1]="Y",e[e["R"]=2]="R",e[e["G"]=3]="G",e[e["B"]=4]="B"})(ue||(ue={}));class me extends I{static ComponentsPerIndex=w(ue);viewDimension=[800,600];camera=[0,0,1];constructor(e){const t=A.Resolve(e.FLOAT),i=t*me.ComponentsPerIndex;super(e,{vertex:ge,fragment:fe},[{name:"a_vertex",size:2,type:e.FLOAT,normalized:!1,stride:i,offset:0},{name:"a_color",size:3,type:e.FLOAT,normalized:!1,stride:i,offset:2*t}],{indicesPerPrimitive:6,basePrimitiveType:e.TRIANGLES}),this.InitializeUniforms()}ResizeView(e){this.viewDimension=[e.Width,e.Height],this.shader.SetUniform2fv("u_resolution",this.viewDimension)}Camera(e){this.camera=[...e],this.shader.SetUniform3fv("u_cam",this.camera)}InitializeUniforms(){this.shader.SetUniform3fv("u_cam",this.camera),this.shader.SetUniform2fv("u_resolution",this.viewDimension)}}(function(e){e[e["Width"]=0]="Width",e[e["Height"]=1]="Height"})(pe||(pe={}));class be{gl;engineName;static EventBus=new q(W);bodies;camera=[0,0,1];fieldDimension={X:0,Y:0,Width:1e3,Height:1e3};resolution=[800,600];bodiesCount=100;bodyRadius=15;bodyColorConfig={default:[.392,.867,.09],collide:[1,0,0],selected:[0,0,1]};border;collisionEngine;collisionEngineFactory;selectedBodies=[];engineRenderer;bodiesRenderer;obstaclesRenderer;IsEngineRendererEnabled=!1;isSimulationPaused=!1;interactionTool;resizeViewBehavior=e=>this.CenterCamera(e);pointerWorld={X:0,Y:0};constructor(e,t){this.gl=e,this.engineName=t,this.collisionEngineFactory=new x({"quad-tree":()=>[new X(0,0,this.fieldDimension.Width,this.fieldDimension.Height),this.engineRenderer=new H(this.gl)]}),this.bodiesRenderer=new de(this.gl),this.obstaclesRenderer=new me(this.gl),this.collisionEngine=this.collisionEngineFactory.Create(t),this.border=new T(e,this.fieldDimension),this.interactionTool=new J(this.gl,this),this.Setup(),window["app"]=this}Dispose(){delete window["app"],be.EventBus.Reset()}SwitchCollisionEngine(e){this.engineName=e,this.collisionEngine.Reset(),this.collisionEngine=this.collisionEngineFactory.Create(e),this.engineRenderer.Camera(this.camera),this.engineRenderer.ResizeView(this.resolution),this.bodies.forEach((e=>this.collisionEngine.Add(e)))}SelectBody(e,t){const i=this.ScreenToWorld(e,t);return this.RestoreSelectedBodiesState(),this.SelectBodiesAndStoreState({X:i.X,Y:i.Y,Width:1,Height:1}),!0}SelectBodies(e){return this.RestoreSelectedBodiesState(),this.SelectBodiesAndStoreState(e),!0}SelectBodiesAndStoreState(e){this.selectedBodies=this.bodies.filter((t=>t.IsOverlap(e))).map((e=>({target:e,color:e.Color})));const t=this.bodyColorConfig.selected;this.selectedBodies.forEach((e=>e.target.Color={R:t[0],G:t[1],B:t[2]}))}RestoreSelectedBodiesState(){this.selectedBodies.forEach((e=>e.target.Color=e.color))}ResizeView(e){this.resizeViewBehavior(e)}CenterCamera(e){this.Camera={X:(e.Width-this.fieldDimension.Width)/2,Y:-(e.Height-this.fieldDimension.Height)/2},this.ResizeViewDefault(e),this.resizeViewBehavior=e=>this.ResizeViewDefault(e)}ResizeViewDefault(e){this.resolution[pe.Width]=e.Width,this.resolution[pe.Height]=e.Height,be.EventBus.Publish(W.ResizeView,e),this.bodiesRenderer.ResizeView(e),this.obstaclesRenderer.ResizeView(e),this.border.ResizeView(e),this.engineRenderer.ResizeView(this.resolution)}ResizeField(e){this.IsDimensionShrink(e)&&this.bodies.forEach((t=>{const i={X:0,Y:0,Width:e.Width,Height:e.Height};t.IsInside(i)||t.MoveInto(i)})),this.fieldDimension={X:0,Y:0,...e},this.border.Dimension(this.fieldDimension),this.SwitchCollisionEngine(this.engineName)}OnMouseMove(e){this.pointerWorld=this.ScreenToWorld(e.offsetX,e.offsetY),this.interactionTool.OnMouseMove(e)}OnMouseDown(e){e.button===V.Left&&(e.shiftKey?this.SwitchInteractionTool(N.Selection):this.SwitchInteractionTool(N.Pan)),this.interactionTool.OnMouseDown(e)}OnMouseUp(e){this.interactionTool.OnMouseUp(e),e.button===V.Left&&this.interactionTool instanceof re&&this.SwitchInteractionTool(N.Pan)}OnKeyDown(e){this.interactionTool.OnKeyDown(e)}OnWheel(e){this.interactionTool.OnWheel(e)}OnTouchMove(e){this.interactionTool.OnTouchMove(e)}OnTouchStart(e){this.interactionTool.OnTouchStart(e)}OnTouchEnd(e){this.interactionTool.OnTouchEnd(e)}ScreenToWorld(e,t){const i=this.resolution[0]/2,s=this.resolution[1]/2,n=this.camera[2],o=(e-i)/n+i-this.camera[0],r=(this.resolution[1]-t-s)/n+s+this.camera[1];return{X:o,Y:r}}get Camera(){return{X:this.camera[ie.X],Y:this.camera[ie.Y],Zoom:this.camera[ie.Zoom]}}set Camera(e){void 0!==e.X&&(this.camera[ie.X]=e.X),void 0!==e.Y&&(this.camera[ie.Y]=e.Y),void 0!==e.Zoom&&(this.camera[ie.Zoom]=e.Zoom),be.EventBus.Publish(W.CameraMove,this.Camera),this.bodiesRenderer.Camera(this.camera),this.obstaclesRenderer.Camera(this.camera),this.border.Camera(this.camera),this.engineRenderer.Camera(this.camera)}get BodiesCount(){return this.bodiesCount}set BodiesCount(e){this.bodiesCount=e,this.BuildBodies()}get BodiesRadius(){return this.bodyRadius}set BodiesRadius(e){this.bodyRadius=e,this.bodiesRenderer.Radius(e),this.UpdateRadiusForBodies()}get ViewDimension(){return{Width:this.resolution[pe.Width],Height:this.resolution[pe.Height]}}get FieldBoundary(){return this.fieldDimension}get Pause(){return this.isSimulationPaused}set Pause(e){this.isSimulationPaused=e,be.EventBus.Publish(W.TogglePause,e)}Draw(e){this.gl.clear(this.gl.COLOR_BUFFER_BIT),null!==this.collisionEngine&&(this.UpdateBodies(e),this.obstaclesRenderer.Draw(),this.bodiesRenderer.Draw(),this.border.Draw(),this.IsEngineRendererEnabled&&this.collisionEngine.Draw(e)),this.interactionTool.Draw(e)}UpdateBodies(e){this.isSimulationPaused||(this.collisionEngine.ForEachCollided(((t,i)=>t.CheckCollision(i,e))),this.bodies.forEach((t=>t.Move(this.fieldDimension,e))),this.collisionEngine.RecalculateBuckets())}BuildBodies(){const e=de.ComponentsPerIndex;this.bodies=[];const t=[()=>ae(0,this.fieldDimension.Width),()=>ae(0,this.fieldDimension.Height),()=>this.bodyColorConfig.default[0],()=>this.bodyColorConfig.default[1],()=>this.bodyColorConfig.default[2]],i=Array.from({length:this.bodiesCount*e},((i,s)=>t[s%e]()));this.bodiesRenderer.UploadAttributes(i),this.collisionEngine.Reset();for(let r=0;r<this.bodiesCount;++r){const e=new g(this.bodiesRenderer.PrimitiveAttributes(r),this.bodyRadius,{X:ae(-100,100),Y:ae(-100,100)});this.bodies.push(e),this.collisionEngine.Add(e)}const s={Center:{X:this.fieldDimension.Width/2,Y:this.fieldDimension.Height/2},Dimension:{Width:400,Height:200},Angle:ae(0,2*Math.PI)},n=y.ColorRectangle(s,[.8,.8,.8]);this.obstaclesRenderer.UploadAttributes(n);const o=new v(this.obstaclesRenderer.PrimitiveAttributes(0),s);this.bodies.push(o),this.collisionEngine.Add(o)}UpdateRadiusForBodies(){this.bodies.forEach((e=>e instanceof g&&(e.Radius=this.bodyRadius)))}Setup(){this.engineRenderer.Camera(this.camera),this.engineRenderer.ResizeView(this.resolution),this.gl.disable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}IsDimensionShrink(e){return e.Width<this.fieldDimension.Width||e.Height<this.fieldDimension.Height}SwitchInteractionTool(e){if(null!==this.interactionTool){if(e===this.interactionTool.Type)return;this.interactionTool.Dispose()}const t=[()=>new J(this.gl,this),()=>new re(this.gl,this)];this.interactionTool=t[e]()}}var ve=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("aside",{class:{minimized:e.isMinimized}},[t("button",{staticClass:"w-8 h-8 absolute block p-0 -right-8 top-0 cursor-pointer rounded-r bg-inherit",on:{click:e.ToggleMinimize}},[e.isMinimized?t("span",[e._v(e._s(e.appState.fps))]):t("fa-icon",{attrs:{icon:"minus"}})],1),t("div",{staticClass:"absolute text-xs"},[t("span",[e._v("FPS: "+e._s(e.appState.fps))])]),t("h3",{staticClass:"text-center"},[e._v("Collision")]),t("my-help-popup"),t("fieldset",{staticClass:"border border-y-slate-200 border-x-transparent p-2"},[t("legend",[e._v("Detection engine")]),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.appState.engine,expression:"appState.engine"}],attrs:{id:"QuadTree",type:"radio",name:"detectionEngine",value:"quad-tree"},domProps:{checked:e._q(e.appState.engine,"quad-tree")},on:{change:function(t){return e.$set(e.appState,"engine","quad-tree")}}}),t("label",{attrs:{for:"QuadTree"}},[e._v("Quad tree")])]),t("div",[t("input",{directives:[{name:"model",rawName:"v-model",value:e.appState.engine,expression:"appState.engine"}],attrs:{id:"BruteForce",type:"radio",name:"detectionEngine",value:"brute-force"},domProps:{checked:e._q(e.appState.engine,"brute-force")},on:{change:function(t){return e.$set(e.appState,"engine","brute-force")}}}),t("label",{attrs:{for:"BruteForce"}},[e._v("Brute-force")])])]),t("my-tabs",{staticClass:"mb-2",model:{value:e.settingsTab,callback:function(t){e.settingsTab=t},expression:"settingsTab"}},[t("my-tab",{attrs:{tabid:e.Tab.Bodies}},[e._v("Bodies")]),t("my-tab",{attrs:{tabid:e.Tab.Boundary}},[e._v("Boundary")]),t("my-tab",{attrs:{tabid:e.Tab.Engine}},[e._v("Engine")])],1),e.IsBodiesTab?t("my-bodies-settings",{model:{value:e.appState.bodies,callback:function(t){e.$set(e.appState,"bodies",t)},expression:"appState.bodies"}}):e.IsBoundaryTab?t("my-boundary-settings",{model:{value:e.appState.boundary,callback:function(t){e.$set(e.appState,"boundary",t)},expression:"appState.boundary"}}):e.IsEngineTab?t("div",[t("label",{staticClass:"mr-2",attrs:{for:"showEngineInternals"}},[e._v("Show engine internals")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.appState.showEngineInternals,expression:"appState.showEngineInternals"}],staticClass:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",attrs:{id:"showEngineInternals",type:"checkbox",min:"1",max:"500"},domProps:{checked:Array.isArray(e.appState.showEngineInternals)?e._i(e.appState.showEngineInternals,null)>-1:e.appState.showEngineInternals},on:{change:function(t){var i=e.appState.showEngineInternals,s=t.target,n=!!s.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);s.checked?r<0&&e.$set(e.appState,"showEngineInternals",i.concat([o])):r>-1&&e.$set(e.appState,"showEngineInternals",i.slice(0,r).concat(i.slice(r+1)))}else e.$set(e.appState,"showEngineInternals",n)}}})]):e._e(),t("div",{staticClass:"flex justify-between"},[t("button",{on:{click:e.TogglePause}},[t("fa-icon",{attrs:{icon:e.togglePauseIcon}})],1),t("button",{attrs:{disabled:!e.CanApplySettings()},on:{click:e.ApplySettings}},[t("fa-icon",{attrs:{icon:"save"}})],1)])],1)},Ce=[],Re=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("div",[t("span",{staticClass:"mr-2",class:{"caption-validation-error":e.IsInvalidBodiesCount(e.bodies.count.value)}},[e._v("Bodies")]),t("input",{class:{invalid:e.IsInvalidBodiesCount(e.bodies.count.value)},attrs:{type:"number",min:"2",max:"1000000"},domProps:{value:e.bodies.count.value},on:{input:e.UpdateCount}})]),t("div",{staticClass:"mt-1"},[t("span",{staticClass:"mr-2",class:{"caption-validation-error":e.IsInvalidBodiesRadius(e.bodies.radius.value)}},[e._v("Radius")]),t("input",{class:{invalid:e.IsInvalidBodiesRadius(e.bodies.radius.value)},attrs:{type:"number",min:"1",max:"500"},domProps:{value:e.bodies.radius.value},on:{input:e.UpdateRadius}})])])},we=[];let ye=class extends r.w3{bodies;UpdateBoundary(e){}UpdateCount(e){const t=Number.parseInt(e.target.value);this.bodies.count.value=t,this.bodies.count.isValid=!this.IsInvalidBodiesCount(t)}UpdateRadius(e){const t=Number.parseInt(e.target.value);this.bodies.radius.value=t,this.bodies.radius.isValid=!this.IsInvalidBodiesRadius(t)}IsInvalidBodiesCount(e){return e<2||e>1e6}IsInvalidBodiesRadius(e){return e<1||e>500}};(0,o.gn)([(0,r.Hn)("update",{required:!0,type:Object})],ye.prototype,"bodies",void 0),(0,o.gn)([(0,r.y1)("update")],ye.prototype,"UpdateBoundary",null),ye=(0,o.gn)([r.wA],ye);var Ae=ye,Se=Ae,Be=i(736),Ye=(0,Be.Z)(Se,Re,we,!1,null,"664861e8",null),Ie=Ye.exports,Te=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("div",[t("span",{staticClass:"inline-block mr-2 w-12",class:{"caption-validation-error":e.IsInvalid(e.boundary.width.value)}},[e._v("Width")]),t("input",{class:{invalid:e.IsInvalid(e.boundary.width.value)},attrs:{type:"number",min:"10",max:"1000000"},domProps:{value:e.boundary.width.value},on:{input:e.UpdateWidth}})]),t("div",{staticClass:"mt-1"},[t("span",{staticClass:"inline-block mr-2 w-12",class:{"caption-validation-error":e.IsInvalid(e.boundary.height.value)}},[e._v("Height")]),t("input",{class:{invalid:e.IsInvalid(e.boundary.height.value)},attrs:{type:"number",min:"10",max:"1000000"},domProps:{value:e.boundary.height.value},on:{input:e.UpdateHeight}})])])},Ee=[];let Xe=class extends r.w3{boundary;UpdateBoundary(e){}UpdateWidth(e){const t=Number.parseInt(e.target.value);this.boundary.width.value=t,this.boundary.width.isValid=!this.IsInvalid(t)}UpdateHeight(e){const t=Number.parseInt(e.target.value);this.boundary.height.value=t,this.boundary.height.isValid=!this.IsInvalid(t)}IsInvalid(e){return e<10||e>1e5}};(0,o.gn)([(0,r.Hn)("update",{required:!0,type:Object})],Xe.prototype,"boundary",void 0),(0,o.gn)([(0,r.y1)("update")],Xe.prototype,"UpdateBoundary",null),Xe=(0,o.gn)([r.wA],Xe);var _e=Xe,Pe=_e,De=(0,Be.Z)(Pe,Te,Ee,!1,null,"4c28363e",null),xe=De.exports,We=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("fa-icon",{staticClass:"panel-help-trigger",attrs:{icon:"question-circle"}}),t("div",{staticClass:"panel-help-content"},[t("ul",[t("li",[t("fa-icon",{attrs:{icon:"mouse"}}),e._v("  "),t("span",{staticClass:"accent"},[e._v("LMB")]),e._v(" - select body ")],1),t("li",[t("fa-icon",{attrs:{icon:"mouse"}}),e._v("  "),t("span",{staticClass:"accent"},[e._v("LMB")]),e._v(" + "),t("span",{staticClass:"accent"},[e._v("SHIFT")]),e._v(" - select bodies in a rectangular region ")],1),t("li",[t("fa-icon",{attrs:{icon:"keyboard"}}),e._v("  "),t("span",{staticClass:"accent"},[e._v("SPACE")]),e._v(" - pause & resume simulation ")],1)])])],1)},Ne=[];let Oe=class extends r.w3{};Oe=(0,o.gn)([r.wA],Oe);var Me=Oe,Fe=Me,Le=(0,Be.Z)(Fe,We,Ne,!1,null,"4ab3fb2c",null),Ve=Le.exports,Ue=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"mx-2 first:mx-0 last:mr-0 cursor-pointer",class:{["active-tab"]:e.isActive},on:{click:e.SelectTab}},[e._t("default")],2)},ze=[];let He=class extends r.w3{tabid;isActive=!1;SelectTab(){this.Parent.UpdateActiveTab(this.tabid)}get Parent(){return this.$parent}};(0,o.gn)([(0,r.fI)({required:!0})],He.prototype,"tabid",void 0),He=(0,o.gn)([r.wA],He);var ke=He,Ge=ke,Ze=(0,Be.Z)(Ge,Ue,ze,!1,null,"ef8c96e4",null),je=Ze.exports,qe=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"flex"},[e._t("default")],2)},$e=[];let Ke=class extends r.w3{activeTab;UpdateActiveTab(e){}ActiveTabChanged(e,t){this.SyncActiveTab(t)}mounted(){this.SyncActiveTab(Number.POSITIVE_INFINITY)}SyncActiveTab(e){const t=this.FindTab(e);t&&(t.isActive=!1);const i=this.FindTab(this.activeTab);i&&(i.isActive=!0)}FindTab(e){return this.Tabs.find((t=>t.tabid===e))??null}get Tabs(){return this.$children}};(0,o.gn)([(0,r.Hn)("tabId",{required:!0,type:Number})],Ke.prototype,"activeTab",void 0),(0,o.gn)([(0,r.y1)("tabId")],Ke.prototype,"UpdateActiveTab",null),(0,o.gn)([(0,r.RL)("activeTab")],Ke.prototype,"ActiveTabChanged",null),Ke=(0,o.gn)([r.wA],Ke);var Qe,Je=Ke,et=Je,tt=(0,Be.Z)(et,qe,$e,!1,null,"0da3f717",null),it=tt.exports;(function(e){e[e["Bodies"]=0]="Bodies",e[e["Boundary"]=1]="Boundary",e[e["Engine"]=2]="Engine"})(Qe||(Qe={}));let st=class extends r.w3{Tab=Qe;appState;UpdateModelState(e){}app;settingsTab=Qe.Bodies;togglePauseIcons=["pause","play"];togglePauseIcon=this.togglePauseIcons[0];isMinimized=!1;CollisionEngineChange(e,t){this.app.SwitchCollisionEngine(e)}ShowEngineInternalsChange(e,t){this.app.IsEngineRendererEnabled=e}mounted(){be.EventBus.Subscribe(W.TogglePause,(e=>this.togglePauseIcon=this.togglePauseIcons[+e]))}ToggleMinimize(){this.isMinimized=!this.isMinimized}ApplySettings(){(this.IsFieldBoundaryWidthDiffer()||this.IsFieldBoundaryHeightDiffer())&&this.app.ResizeField({Width:this.appState.boundary.width.value,Height:this.appState.boundary.height.value}),this.IsBodiesCountDiffer()&&(this.app.BodiesCount=this.appState.bodies.count.value),this.IsBodiesRadiusDiffer()&&(this.app.BodiesRadius=this.appState.bodies.radius.value),this.$forceUpdate()}TogglePause(){this.app.Pause=!this.app.Pause,this.togglePauseIcon=this.togglePauseIcons[+this.app.Pause]}get IsBodiesTab(){return this.settingsTab===Qe.Bodies}get IsBoundaryTab(){return this.settingsTab===Qe.Boundary}get IsEngineTab(){return this.settingsTab===Qe.Engine}CanApplySettings(){return this.appState.boundary.width.isValid&&this.appState.boundary.height.isValid&&this.appState.bodies.count.isValid&&this.appState.bodies.radius.isValid&&this.IsSettingsDiffer()}IsSettingsDiffer(){return this.IsFieldBoundaryWidthDiffer()||this.IsFieldBoundaryHeightDiffer()||this.IsBodiesCountDiffer()||this.IsBodiesRadiusDiffer()}IsFieldBoundaryWidthDiffer(){return this.app.FieldBoundary.Width!==this.appState.boundary.width.value}IsFieldBoundaryHeightDiffer(){return this.app.FieldBoundary.Height!==this.appState.boundary.height.value}IsBodiesCountDiffer(){return this.app.BodiesCount!==this.appState.bodies.count.value}IsBodiesRadiusDiffer(){return this.app.BodiesRadius!==this.appState.bodies.radius.value}};(0,o.gn)([(0,r.Hn)("updateAppState")],st.prototype,"appState",void 0),(0,o.gn)([(0,r.y1)("updateAppState")],st.prototype,"UpdateModelState",null),(0,o.gn)([(0,r.fI)()],st.prototype,"app",void 0),(0,o.gn)([(0,r.RL)("appState.engine")],st.prototype,"CollisionEngineChange",null),(0,o.gn)([(0,r.RL)("appState.showEngineInternals")],st.prototype,"ShowEngineInternalsChange",null),st=(0,o.gn)([(0,r.wA)({components:{MyBodiesSettings:Ie,MyBoundarySettings:xe,MyHelpPopup:Ve,MyTabs:it,MyTab:je}})],st);var nt=st,ot=nt,rt=(0,Be.Z)(ot,ve,Ce,!1,null,"4b0e2b98",null),at=rt.exports,ht=i(615);let lt=class extends r.w3{width=800;height=600;state={engine:"quad-tree",bodies:{count:{value:1e4,isValid:!0},radius:{value:2,isValid:!0}},boundary:{width:{value:1e3,isValid:!0},height:{value:1e3,isValid:!0}},showEngineInternals:!1,fps:0};drawCallCounter=0;drawCallCounterStart=Date.now();app;isUnmounted;isAppInitialized=!1;async mounted(){this.isUnmounted=!1,window.addEventListener("resize",this.OnResize),this.lastDrawCall=Date.now(),window.requestAnimationFrame((()=>{this.Draw(Date.now()-this.lastDrawCall)}))}beforeDestroy(){this.isUnmounted=!0,window.removeEventListener("resize",this.OnResize),this.app.Dispose()}OnContextReady(e){this.app=new be(e,this.state.engine),this.app.BodiesCount=this.state.bodies.count.value,this.app.BodiesRadius=this.state.bodies.radius.value,this.app.ResizeField({Width:this.state.boundary.width.value,Height:this.state.boundary.height.value}),this.OnResize(),this.isAppInitialized=!0}lastDrawCall=0;Draw(e){this.isUnmounted||(this.TrackFps(),this.app.Draw(e),window.requestAnimationFrame((()=>{const e=Date.now()-this.lastDrawCall;this.lastDrawCall=Date.now(),this.Draw(e)})),++this.drawCallCounter)}TrackFps(){const e=Date.now()-this.drawCallCounterStart;e>=1e3&&(this.state.fps=Math.round(this.drawCallCounter*(e/1e3)),this.drawCallCounterStart=Date.now(),this.drawCallCounter=0)}OnWheel(e){this.app.OnWheel(e)}OnMouseMove(e){this.app.OnMouseMove(e)}OnMouseDown(e){this.app.OnMouseDown(e)}OnMouseUp(e){this.app.OnMouseUp(e)}OnKeyDown(e){this.app.OnKeyDown(e)}OnTouchMove(e){this.app.OnTouchMove(e)}OnTouchStart(e){this.app.OnTouchStart(e)}OnTouchEnd(e){this.app.OnTouchEnd(e)}OnResize(){this.width=window.innerWidth,this.height=window.innerHeight,this.app.ResizeView({Width:this.width,Height:this.height})}};lt=(0,o.gn)([(0,r.wA)({components:{MyAsidePanel:at,Viewport:ht.Z}})],lt);var ct=lt,dt=ct,ut=(0,Be.Z)(dt,s,n,!1,null,"ddd80148",null),pt=ut.exports},615:function(e,t,i){i.d(t,{Z:function(){return u}});var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("canvas",{ref:"canvas",style:{width:e.Width,height:e.Height}})},n=[],o=i(655),r=i(195);let a=class extends r.w3{width;height;preserveDrawingBuffer;canvas;ContextReady(e){}context=null;get Width(){return this.width+"px"??"100%"}get Height(){return this.height+"px"??"100%"}async mounted(){this.context=this.canvas.getContext("webgl2",{preserveDrawingBuffer:this.preserveDrawingBuffer}),null!==this.context?(this.UpdateViewport(),this.context.enable(this.context.CULL_FACE),this.context.enable(this.context.DEPTH_TEST),this.ContextReady(this.context)):console.error("Can't initialize webgl2 context")}OnWidth(){this.UpdateViewport()}OnHeight(){this.UpdateViewport()}UpdateViewport(){this.canvas.width=this.width,this.canvas.height=this.height,this.context?.viewport(0,0,this.width,this.height)}};(0,o.gn)([(0,r.fI)()],a.prototype,"width",void 0),(0,o.gn)([(0,r.fI)()],a.prototype,"height",void 0),(0,o.gn)([(0,r.fI)({default:!1})],a.prototype,"preserveDrawingBuffer",void 0),(0,o.gn)([(0,r.Rl)()],a.prototype,"canvas",void 0),(0,o.gn)([(0,r.y1)("context-ready")],a.prototype,"ContextReady",null),(0,o.gn)([(0,r.RL)("width")],a.prototype,"OnWidth",null),(0,o.gn)([(0,r.RL)("height")],a.prototype,"OnHeight",null),a=(0,o.gn)([r.wA],a);var h=a,l=h,c=i(736),d=(0,c.Z)(l,s,n,!1,null,"13fb0e92",null),u=d.exports},695:function(e,t,i){function s(e){throw new Error(e)}i.d(t,{s:function(){return n}});class n{gl;uniformCache=new Map;instance;constructor(e){if(this.gl=e,!e)throw new Error("Invalid webgl2 context");this.instance=e.createProgram()??s("Can't create shader program")}Attach(e,t){const i=this.gl.createShader(e);if(null===i)throw new Error("Failed to create shader");if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){const e=new Error(this.gl.getShaderInfoLog(i)??"Failed to compile shader");throw this.gl.deleteShader(i),e}this.gl.attachShader(this.instance,i)}async AttachFromUrl(e,t){this.Attach(e,await(await fetch(t)).text())}Link(){if(this.gl.linkProgram(this.instance),!this.gl.getProgramParameter(this.instance,this.gl.LINK_STATUS)){const e=new Error(this.gl.getProgramParameter(this.instance,this.gl.LINK_STATUS)??"Failed to link shader");throw this.gl.deleteProgram(this.instance),e}}Use(){this.gl.useProgram(this.instance)}SetUniform3fv(e,t){this.gl.uniform3fv(this.GetUniformLocation(e),t)}SetUniform2fv(e,t){this.gl.uniform2fv(this.GetUniformLocation(e),t)}SetUniform4fv(e,t){this.gl.uniform4fv(this.GetUniformLocation(e),t)}SetUniform1f(e,t){this.gl.uniform1f(this.GetUniformLocation(e),t)}SetUniform1i(e,t){this.gl.uniform1i(this.GetUniformLocation(e),t)}SetUniform2iv(e,t){this.gl.uniform2iv(this.GetUniformLocation(e),t)}GetAttributeLocation(e){this.Use();const t=this.gl.getAttribLocation(this.instance,e);if(-1===t)throw new Error(`Failed to locate attribute '${e}'`);return t}GetUniformLocation(e){this.Use();let t=this.uniformCache.get(e)??null;if(null===t){if(t=this.gl.getUniformLocation(this.instance,e),null===t)throw new Error(`Failed to locate uniform '${e}'`);this.uniformCache.set(e,t)}return t}}}}]);
//# sourceMappingURL=collision.c8f9dda8.js.map